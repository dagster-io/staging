
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>dagster_airflow.factory &#8212; Dagster</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
 
<link rel="stylesheet" href="../../_static/custom.css" type="text/css" />


<meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
    <div class="documentwrapper">
        <div class="bodywrapper">
            <div class="related top">
                &nbsp;
<nav id="rellinks">
    <ul>
        <li>
            <a href="/" title="Home">Home</a>
        </li>
    </ul>
</nav>
            </div>
            

            

            <div class="body" role="main">
                
  <h1>Source code for dagster_airflow.factory</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">from</span> <span class="nn">airflow</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="nn">airflow.operators</span> <span class="kn">import</span> <span class="n">BaseOperator</span>
<span class="kn">from</span> <span class="nn">dagster</span> <span class="kn">import</span> <span class="n">check</span><span class="p">,</span> <span class="n">seven</span>
<span class="kn">from</span> <span class="nn">dagster.core.definitions.reconstructable</span> <span class="kn">import</span> <span class="n">ReconstructableRepository</span>
<span class="kn">from</span> <span class="nn">dagster.core.execution.api</span> <span class="kn">import</span> <span class="n">create_execution_plan</span>
<span class="kn">from</span> <span class="nn">dagster.core.instance</span> <span class="kn">import</span> <span class="n">DagsterInstance</span>
<span class="kn">from</span> <span class="nn">dagster.core.instance.ref</span> <span class="kn">import</span> <span class="n">InstanceRef</span>
<span class="kn">from</span> <span class="nn">dagster.core.snap</span> <span class="kn">import</span> <span class="n">ExecutionPlanSnapshot</span><span class="p">,</span> <span class="n">PipelineSnapshot</span><span class="p">,</span> <span class="n">snapshot_from_execution_plan</span>
<span class="kn">from</span> <span class="nn">dagster_airflow.operators.util</span> <span class="kn">import</span> <span class="n">check_storage_specified</span>

<span class="kn">from</span> <span class="nn">.compile</span> <span class="kn">import</span> <span class="n">coalesce_execution_steps</span>
<span class="kn">from</span> <span class="nn">.operators.docker_operator</span> <span class="kn">import</span> <span class="n">DagsterDockerOperator</span>
<span class="kn">from</span> <span class="nn">.operators.python_operator</span> <span class="kn">import</span> <span class="n">DagsterPythonOperator</span>

<span class="n">DEFAULT_ARGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;depends_on_past&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;airflow@example.com&quot;</span><span class="p">],</span>
    <span class="s2">&quot;email_on_failure&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;email_on_retry&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="s2">&quot;airflow&quot;</span><span class="p">,</span>
    <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;retry_delay&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Airflow DAG names are not allowed to be longer than 250 chars</span>
<span class="n">AIRFLOW_MAX_DAG_NAME_LEN</span> <span class="o">=</span> <span class="mi">250</span>


<span class="k">def</span> <span class="nf">_make_dag_description</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;&quot;Editable scaffolding autogenerated by dagster-airflow from pipeline </span><span class="si">{pipeline_name}</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_rename_for_airflow</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Modify pipeline name for Airflow to meet constraints on DAG names:</span>
<span class="sd">    https://github.com/apache/airflow/blob/1.10.3/airflow/utils/helpers.py#L52-L63</span>

<span class="sd">    Here, we just substitute underscores for illegal characters to avoid imposing Airflow&#39;s</span>
<span class="sd">    constraints on our naming schemes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^\w\-\.]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)[:</span><span class="n">AIRFLOW_MAX_DAG_NAME_LEN</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">DagsterOperatorInvocationArgs</span><span class="p">(</span>
    <span class="n">namedtuple</span><span class="p">(</span>
        <span class="s2">&quot;DagsterOperatorInvocationArgs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;recon_repo pipeline_name run_config mode step_keys instance_ref pipeline_snapshot &quot;</span>
        <span class="s2">&quot;execution_plan_snapshot parent_pipeline_snapshot&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">recon_repo</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">run_config</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">,</span>
        <span class="n">step_keys</span><span class="p">,</span>
        <span class="n">instance_ref</span><span class="p">,</span>
        <span class="n">pipeline_snapshot</span><span class="p">,</span>
        <span class="n">execution_plan_snapshot</span><span class="p">,</span>
        <span class="n">parent_pipeline_snapshot</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DagsterOperatorInvocationArgs</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">recon_repo</span><span class="o">=</span><span class="n">recon_repo</span><span class="p">,</span>
            <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
            <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">step_keys</span><span class="o">=</span><span class="n">step_keys</span><span class="p">,</span>
            <span class="n">instance_ref</span><span class="o">=</span><span class="n">instance_ref</span><span class="p">,</span>
            <span class="n">pipeline_snapshot</span><span class="o">=</span><span class="n">pipeline_snapshot</span><span class="p">,</span>
            <span class="n">execution_plan_snapshot</span><span class="o">=</span><span class="n">execution_plan_snapshot</span><span class="p">,</span>
            <span class="n">parent_pipeline_snapshot</span><span class="o">=</span><span class="n">parent_pipeline_snapshot</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">DagsterOperatorParameters</span><span class="p">(</span>
    <span class="n">namedtuple</span><span class="p">(</span>
        <span class="s2">&quot;_DagsterOperatorParameters&quot;</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="s2">&quot;recon_repo pipeline_name run_config &quot;</span>
            <span class="s2">&quot;mode task_id step_keys dag instance_ref op_kwargs pipeline_snapshot &quot;</span>
            <span class="s2">&quot;execution_plan_snapshot parent_pipeline_snapshot&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">,</span>
        <span class="n">recon_repo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">step_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">instance_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pipeline_snapshot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">execution_plan_snapshot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_pipeline_snapshot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">check_storage_specified</span><span class="p">(</span><span class="n">run_config</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DagsterOperatorParameters</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">recon_repo</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_inst_param</span><span class="p">(</span><span class="n">recon_repo</span><span class="p">,</span> <span class="s2">&quot;recon_repo&quot;</span><span class="p">,</span> <span class="n">ReconstructableRepository</span><span class="p">),</span>
            <span class="n">pipeline_name</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">,</span> <span class="s2">&quot;pipeline_name&quot;</span><span class="p">),</span>
            <span class="n">run_config</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">run_config</span><span class="p">,</span> <span class="s2">&quot;run_config&quot;</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">),</span>
            <span class="n">task_id</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="s2">&quot;task_id&quot;</span><span class="p">),</span>
            <span class="n">step_keys</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_list_param</span><span class="p">(</span><span class="n">step_keys</span><span class="p">,</span> <span class="s2">&quot;step_keys&quot;</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">dag</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_inst_param</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="s2">&quot;dag&quot;</span><span class="p">,</span> <span class="n">DAG</span><span class="p">),</span>
            <span class="n">instance_ref</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_inst_param</span><span class="p">(</span><span class="n">instance_ref</span><span class="p">,</span> <span class="s2">&quot;instance_ref&quot;</span><span class="p">,</span> <span class="n">InstanceRef</span><span class="p">),</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">op_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s2">&quot;op_kwargs&quot;</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">pipeline_snapshot</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">inst_param</span><span class="p">(</span>
                <span class="n">pipeline_snapshot</span><span class="p">,</span> <span class="s2">&quot;pipeline_snapshot&quot;</span><span class="p">,</span> <span class="n">PipelineSnapshot</span>
            <span class="p">),</span>
            <span class="n">execution_plan_snapshot</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">inst_param</span><span class="p">(</span>
                <span class="n">execution_plan_snapshot</span><span class="p">,</span> <span class="s2">&quot;execution_plan_snapshot&quot;</span><span class="p">,</span> <span class="n">ExecutionPlanSnapshot</span>
            <span class="p">),</span>
            <span class="n">parent_pipeline_snapshot</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">opt_inst_param</span><span class="p">(</span>
                <span class="n">parent_pipeline_snapshot</span><span class="p">,</span> <span class="s2">&quot;parent_pipeline_snapshot&quot;</span><span class="p">,</span> <span class="n">PipelineSnapshot</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">invocation_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DagsterOperatorInvocationArgs</span><span class="p">(</span>
            <span class="n">recon_repo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recon_repo</span><span class="p">,</span>
            <span class="n">pipeline_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_name</span><span class="p">,</span>
            <span class="n">run_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_config</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">step_keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step_keys</span><span class="p">,</span>
            <span class="n">instance_ref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_ref</span><span class="p">,</span>
            <span class="n">pipeline_snapshot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_snapshot</span><span class="p">,</span>
            <span class="n">execution_plan_snapshot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_plan_snapshot</span><span class="p">,</span>
            <span class="n">parent_pipeline_snapshot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_pipeline_snapshot</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">_make_airflow_dag</span><span class="p">(</span>
    <span class="n">recon_repo</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">op_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">operator</span><span class="o">=</span><span class="n">DagsterPythonOperator</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">check</span><span class="o">.</span><span class="n">inst_param</span><span class="p">(</span><span class="n">recon_repo</span><span class="p">,</span> <span class="s2">&quot;recon_repo&quot;</span><span class="p">,</span> <span class="n">ReconstructableRepository</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">,</span> <span class="s2">&quot;pipeline_name&quot;</span><span class="p">)</span>
    <span class="n">run_config</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">run_config</span><span class="p">,</span> <span class="s2">&quot;run_config&quot;</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span>
    <span class="c1"># Default to use the (persistent) system temp directory rather than a TemporaryDirectory,</span>
    <span class="c1"># which would not be consistent between Airflow task invocations.</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">check</span><span class="o">.</span><span class="n">inst_param</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">,</span> <span class="n">DagsterInstance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instance</span>
        <span class="k">else</span> <span class="n">DagsterInstance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fallback_storage</span><span class="o">=</span><span class="n">seven</span><span class="o">.</span><span class="n">get_system_temp_directory</span><span class="p">())</span>
    <span class="p">)</span>

    <span class="c1"># Only used for Airflow; internally we continue to use pipeline.name</span>
    <span class="n">dag_id</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="s2">&quot;dag_id&quot;</span><span class="p">,</span> <span class="n">_rename_for_airflow</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">))</span>

    <span class="n">dag_description</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span>
        <span class="n">dag_description</span><span class="p">,</span> <span class="s2">&quot;dag_description&quot;</span><span class="p">,</span> <span class="n">_make_dag_description</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">subclass_param</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="n">BaseOperator</span><span class="p">)</span>

    <span class="n">dag_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;default_args&quot;</span><span class="p">:</span> <span class="n">DEFAULT_ARGS</span><span class="p">},</span>
        <span class="o">**</span><span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">dag_kwargs</span><span class="p">,</span> <span class="s2">&quot;dag_kwargs&quot;</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">op_kwargs</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">op_kwargs</span><span class="p">,</span> <span class="s2">&quot;op_kwargs&quot;</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="n">dag_id</span><span class="o">=</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">dag_description</span><span class="p">,</span> <span class="o">**</span><span class="n">dag_kwargs</span><span class="p">)</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">recon_repo</span><span class="o">.</span><span class="n">get_definition</span><span class="p">()</span><span class="o">.</span><span class="n">get_pipeline</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_default_mode_name</span><span class="p">()</span>

    <span class="n">execution_plan</span> <span class="o">=</span> <span class="n">create_execution_plan</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">run_config</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">coalesced_plan</span> <span class="o">=</span> <span class="n">coalesce_execution_steps</span><span class="p">(</span><span class="n">execution_plan</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">solid_handle</span><span class="p">,</span> <span class="n">solid_steps</span> <span class="ow">in</span> <span class="n">coalesced_plan</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">step_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">step</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">solid_steps</span><span class="p">]</span>

        <span class="n">operator_parameters</span> <span class="o">=</span> <span class="n">DagsterOperatorParameters</span><span class="p">(</span>
            <span class="n">recon_repo</span><span class="o">=</span><span class="n">recon_repo</span><span class="p">,</span>
            <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
            <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">task_id</span><span class="o">=</span><span class="n">solid_handle</span><span class="p">,</span>
            <span class="n">step_keys</span><span class="o">=</span><span class="n">step_keys</span><span class="p">,</span>
            <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">,</span>
            <span class="n">instance_ref</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">get_ref</span><span class="p">(),</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="n">op_kwargs</span><span class="p">,</span>
            <span class="n">pipeline_snapshot</span><span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">get_pipeline_snapshot</span><span class="p">(),</span>
            <span class="n">execution_plan_snapshot</span><span class="o">=</span><span class="n">snapshot_from_execution_plan</span><span class="p">(</span>
                <span class="n">execution_plan</span><span class="p">,</span> <span class="n">pipeline_snapshot_id</span><span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">get_pipeline_snapshot_id</span><span class="p">()</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">operator</span><span class="p">(</span><span class="n">operator_parameters</span><span class="p">)</span>

        <span class="n">tasks</span><span class="p">[</span><span class="n">solid_handle</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span>

        <span class="k">for</span> <span class="n">solid_step</span> <span class="ow">in</span> <span class="n">solid_steps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">step_input</span> <span class="ow">in</span> <span class="n">solid_step</span><span class="o">.</span><span class="n">step_inputs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">step_input</span><span class="o">.</span><span class="n">dependency_keys</span><span class="p">:</span>
                    <span class="n">prev_solid_handle</span> <span class="o">=</span> <span class="n">execution_plan</span><span class="o">.</span><span class="n">get_step_by_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">solid_handle</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">solid_handle</span> <span class="o">!=</span> <span class="n">prev_solid_handle</span><span class="p">:</span>
                        <span class="n">tasks</span><span class="p">[</span><span class="n">prev_solid_handle</span><span class="p">]</span><span class="o">.</span><span class="n">set_downstream</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="p">[</span><span class="n">tasks</span><span class="p">[</span><span class="n">solid_handle</span><span class="p">]</span> <span class="k">for</span> <span class="n">solid_handle</span> <span class="ow">in</span> <span class="n">coalesced_plan</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>


<div class="viewcode-block" id="make_airflow_dag"><a class="viewcode-back" href="../../sections/api/apidocs/libraries/dagster_airflow.html#dagster_airflow.make_airflow_dag">[docs]</a><span class="k">def</span> <span class="nf">make_airflow_dag</span><span class="p">(</span>
    <span class="n">module_name</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">op_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct an Airflow DAG corresponding to a given Dagster pipeline.</span>

<span class="sd">    Tasks in the resulting DAG will execute the Dagster logic they encapsulate as a Python</span>
<span class="sd">    callable, run by an underlying :py:class:`PythonOperator &lt;airflow:PythonOperator&gt;`. As a</span>
<span class="sd">    consequence, both dagster, any Python dependencies required by your solid logic, and the module</span>
<span class="sd">    containing your pipeline definition must be available in the Python environment within which</span>
<span class="sd">    your Airflow tasks execute. If you cannot install requirements into this environment, or you</span>
<span class="sd">    are looking for a containerized solution to provide better isolation, see instead</span>
<span class="sd">    :py:func:`make_airflow_dag_containerized`.</span>

<span class="sd">    This function should be invoked in an Airflow DAG definition file, such as that created by an</span>
<span class="sd">    invocation of the dagster-airflow scaffold CLI tool.</span>

<span class="sd">    Args:</span>
<span class="sd">        module_name (str): The name of the importable module in which the pipeline definition can be</span>
<span class="sd">            found.</span>
<span class="sd">        pipeline_name (str): The name of the pipeline definition.</span>
<span class="sd">        run_config (Optional[dict]): The environment config, if any, with which to compile</span>
<span class="sd">            the pipeline to an execution plan, as a Python dict.</span>
<span class="sd">        mode (Optional[str]): The mode in which to execute the pipeline.</span>
<span class="sd">        instance (Optional[DagsterInstance]): The Dagster instance to use to execute the pipeline.</span>
<span class="sd">        dag_id (Optional[str]): The id to use for the compiled Airflow DAG (passed through to</span>
<span class="sd">            :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;`).</span>
<span class="sd">        dag_description (Optional[str]): The description to use for the compiled Airflow DAG</span>
<span class="sd">            (passed through to :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;`)</span>
<span class="sd">        dag_kwargs (Optional[dict]): Any additional kwargs to pass to the Airflow</span>
<span class="sd">            :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;` constructor, including ``default_args``.</span>
<span class="sd">        op_kwargs (Optional[dict]): Any additional kwargs to pass to the underlying Airflow</span>
<span class="sd">            operator (a subclass of</span>
<span class="sd">            :py:class:`PythonOperator &lt;airflow:airflow.operators.python_operator.PythonOperator&gt;`).</span>

<span class="sd">    Returns:</span>
<span class="sd">        (airflow.models.DAG, List[airflow.models.BaseOperator]): The generated Airflow DAG, and a</span>
<span class="sd">        list of its constituent tasks.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="s2">&quot;module_name&quot;</span><span class="p">)</span>

    <span class="n">recon_repo</span> <span class="o">=</span> <span class="n">ReconstructableRepository</span><span class="o">.</span><span class="n">for_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">pipeline_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_make_airflow_dag</span><span class="p">(</span>
        <span class="n">recon_repo</span><span class="o">=</span><span class="n">recon_repo</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
        <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="o">=</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="n">dag_description</span><span class="o">=</span><span class="n">dag_description</span><span class="p">,</span>
        <span class="n">dag_kwargs</span><span class="o">=</span><span class="n">dag_kwargs</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="n">op_kwargs</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="make_airflow_dag_for_operator"><a class="viewcode-back" href="../../sections/api/apidocs/libraries/dagster_airflow.html#dagster_airflow.make_airflow_dag_for_operator">[docs]</a><span class="k">def</span> <span class="nf">make_airflow_dag_for_operator</span><span class="p">(</span>
    <span class="n">recon_repo</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="p">,</span>
    <span class="n">operator</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">op_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct an Airflow DAG corresponding to a given Dagster pipeline and custom operator.</span>

<span class="sd">    `Custom operator template &lt;https://github.com/dagster-io/dagster/blob/master/python_modules/dagster-test/dagster_test/dagster_airflow/custom_operator.py&gt;`_</span>

<span class="sd">    Tasks in the resulting DAG will execute the Dagster logic they encapsulate run by the given</span>
<span class="sd">    Operator :py:class:`BaseOperator &lt;airflow.models.BaseOperator&gt;`. If you</span>
<span class="sd">    are looking for a containerized solution to provide better isolation, see instead</span>
<span class="sd">    :py:func:`make_airflow_dag_containerized`.</span>

<span class="sd">    This function should be invoked in an Airflow DAG definition file, such as that created by an</span>
<span class="sd">    invocation of the dagster-airflow scaffold CLI tool.</span>

<span class="sd">    Args:</span>
<span class="sd">        recon_repo (:class:`dagster.ReconstructableRepository`): reference to a Dagster RepositoryDefinition</span>
<span class="sd">            that can be reconstructed in another process</span>
<span class="sd">        pipeline_name (str): The name of the pipeline definition.</span>
<span class="sd">        operator (type): The operator to use. Must be a class that inherits from</span>
<span class="sd">            :py:class:`BaseOperator &lt;airflow.models.BaseOperator&gt;`</span>
<span class="sd">        run_config (Optional[dict]): The environment config, if any, with which to compile</span>
<span class="sd">            the pipeline to an execution plan, as a Python dict.</span>
<span class="sd">        mode (Optional[str]): The mode in which to execute the pipeline.</span>
<span class="sd">        instance (Optional[DagsterInstance]): The Dagster instance to use to execute the pipeline.</span>
<span class="sd">        dag_id (Optional[str]): The id to use for the compiled Airflow DAG (passed through to</span>
<span class="sd">            :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;`).</span>
<span class="sd">        dag_description (Optional[str]): The description to use for the compiled Airflow DAG</span>
<span class="sd">            (passed through to :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;`)</span>
<span class="sd">        dag_kwargs (Optional[dict]): Any additional kwargs to pass to the Airflow</span>
<span class="sd">            :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;` constructor, including ``default_args``.</span>
<span class="sd">        op_kwargs (Optional[dict]): Any additional kwargs to pass to the underlying Airflow</span>
<span class="sd">            operator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (airflow.models.DAG, List[airflow.models.BaseOperator]): The generated Airflow DAG, and a</span>
<span class="sd">        list of its constituent tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span><span class="o">.</span><span class="n">subclass_param</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="n">BaseOperator</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_make_airflow_dag</span><span class="p">(</span>
        <span class="n">recon_repo</span><span class="o">=</span><span class="n">recon_repo</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="o">=</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="n">dag_description</span><span class="o">=</span><span class="n">dag_description</span><span class="p">,</span>
        <span class="n">dag_kwargs</span><span class="o">=</span><span class="n">dag_kwargs</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="n">op_kwargs</span><span class="p">,</span>
        <span class="n">operator</span><span class="o">=</span><span class="n">operator</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">make_airflow_dag_for_recon_repo</span><span class="p">(</span>
    <span class="n">recon_repo</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">op_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">return</span> <span class="n">_make_airflow_dag</span><span class="p">(</span>
        <span class="n">recon_repo</span><span class="o">=</span><span class="n">recon_repo</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="o">=</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="n">dag_description</span><span class="o">=</span><span class="n">dag_description</span><span class="p">,</span>
        <span class="n">dag_kwargs</span><span class="o">=</span><span class="n">dag_kwargs</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="n">op_kwargs</span><span class="p">,</span>
    <span class="p">)</span>


<div class="viewcode-block" id="make_airflow_dag_containerized"><a class="viewcode-back" href="../../sections/api/apidocs/libraries/dagster_airflow.html#dagster_airflow.make_airflow_dag_containerized">[docs]</a><span class="k">def</span> <span class="nf">make_airflow_dag_containerized</span><span class="p">(</span>
    <span class="n">module_name</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="p">,</span>
    <span class="n">image</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">op_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct a containerized Airflow DAG corresponding to a given Dagster pipeline.</span>

<span class="sd">    Tasks in the resulting DAG will execute the Dagster logic they encapsulate by calling the</span>
<span class="sd">    dagster-graphql API exposed by a container run using a subclass of</span>
<span class="sd">    :py:class:`DockerOperator &lt;airflow:airflow.operators.docker_operator.DockerOperator&gt;`. As a</span>
<span class="sd">    consequence, both dagster, any Python dependencies required by your solid logic, and the module</span>
<span class="sd">    containing your pipeline definition must be available in the container spun up by this operator.</span>
<span class="sd">    Typically you&#39;ll want to install these requirements onto the image you&#39;re using.</span>

<span class="sd">    This function should be invoked in an Airflow DAG definition file, such as that created by an</span>
<span class="sd">    invocation of the dagster-airflow scaffold CLI tool.</span>

<span class="sd">    Args:</span>
<span class="sd">        module_name (str): The name of the importable module in which the pipeline definition can be</span>
<span class="sd">            found.</span>
<span class="sd">        pipeline_name (str): The name of the pipeline definition.</span>
<span class="sd">        image (str): The name of the Docker image to use for execution (passed through to</span>
<span class="sd">            :py:class:`DockerOperator &lt;airflow:airflow.operators.docker_operator.DockerOperator&gt;`).</span>
<span class="sd">        run_config (Optional[dict]): The environment config, if any, with which to compile</span>
<span class="sd">            the pipeline to an execution plan, as a Python dict.</span>
<span class="sd">        mode (Optional[str]): The mode in which to execute the pipeline.</span>
<span class="sd">        dag_id (Optional[str]): The id to use for the compiled Airflow DAG (passed through to</span>
<span class="sd">            :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;`).</span>
<span class="sd">        dag_description (Optional[str]): The description to use for the compiled Airflow DAG</span>
<span class="sd">            (passed through to :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;`)</span>
<span class="sd">        dag_kwargs (Optional[dict]): Any additional kwargs to pass to the Airflow</span>
<span class="sd">            :py:class:`DAG &lt;airflow:airflow.models.DAG&gt;` constructor, including ``default_args``.</span>
<span class="sd">        op_kwargs (Optional[dict]): Any additional kwargs to pass to the underlying Airflow</span>
<span class="sd">            operator (a subclass of</span>
<span class="sd">            :py:class:`DockerOperator &lt;airflow:airflow.operators.docker_operator.DockerOperator&gt;`).</span>

<span class="sd">    Returns:</span>
<span class="sd">        (airflow.models.DAG, List[airflow.models.BaseOperator]): The generated Airflow DAG, and a</span>
<span class="sd">        list of its constituent tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="s2">&quot;module_name&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">,</span> <span class="s2">&quot;pipeline_name&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">run_config</span><span class="p">,</span> <span class="s2">&quot;run_config&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="s2">&quot;dag_id&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">dag_description</span><span class="p">,</span> <span class="s2">&quot;dag_description&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">dag_kwargs</span><span class="p">,</span> <span class="s2">&quot;dag_kwargs&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">op_kwargs</span><span class="p">,</span> <span class="s2">&quot;op_kwargs&quot;</span><span class="p">)</span>

    <span class="n">recon_repo</span> <span class="o">=</span> <span class="n">ReconstructableRepository</span><span class="o">.</span><span class="n">for_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">pipeline_name</span><span class="p">)</span>

    <span class="n">op_kwargs</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">op_kwargs</span><span class="p">,</span> <span class="s2">&quot;op_kwargs&quot;</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">op_kwargs</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">return</span> <span class="n">_make_airflow_dag</span><span class="p">(</span>
        <span class="n">recon_repo</span><span class="o">=</span><span class="n">recon_repo</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="o">=</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="n">dag_description</span><span class="o">=</span><span class="n">dag_description</span><span class="p">,</span>
        <span class="n">dag_kwargs</span><span class="o">=</span><span class="n">dag_kwargs</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="n">op_kwargs</span><span class="p">,</span>
        <span class="n">operator</span><span class="o">=</span><span class="n">DagsterDockerOperator</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">make_airflow_dag_containerized_for_recon_repo</span><span class="p">(</span>
    <span class="n">recon_repo</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="p">,</span>
    <span class="n">image</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dag_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">op_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">check</span><span class="o">.</span><span class="n">inst_param</span><span class="p">(</span><span class="n">recon_repo</span><span class="p">,</span> <span class="s2">&quot;recon_repo&quot;</span><span class="p">,</span> <span class="n">ReconstructableRepository</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">pipeline_name</span><span class="p">,</span> <span class="s2">&quot;pipeline_name&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">run_config</span><span class="p">,</span> <span class="s2">&quot;run_config&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="s2">&quot;dag_id&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_str_param</span><span class="p">(</span><span class="n">dag_description</span><span class="p">,</span> <span class="s2">&quot;dag_description&quot;</span><span class="p">)</span>
    <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">dag_kwargs</span><span class="p">,</span> <span class="s2">&quot;dag_kwargs&quot;</span><span class="p">)</span>
    <span class="n">op_kwargs</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">opt_dict_param</span><span class="p">(</span><span class="n">op_kwargs</span><span class="p">,</span> <span class="s2">&quot;op_kwargs&quot;</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">op_kwargs</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>

    <span class="k">return</span> <span class="n">_make_airflow_dag</span><span class="p">(</span>
        <span class="n">recon_repo</span><span class="o">=</span><span class="n">recon_repo</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="o">=</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="n">dag_description</span><span class="o">=</span><span class="n">dag_description</span><span class="p">,</span>
        <span class="n">dag_kwargs</span><span class="o">=</span><span class="n">dag_kwargs</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="n">op_kwargs</span><span class="p">,</span>
        <span class="n">operator</span><span class="o">=</span><span class="n">DagsterDockerOperator</span><span class="p">,</span>
        <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>

            </div>
            <div class="related bottom">
                &nbsp;
<nav id="rellinks">
    <ul>
        <li>
            <a href="/" title="Home">Home</a>
        </li>
    </ul>
</nav>
            </div>
            
        </div>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3><a href="../../index.html">Dagster</a></h3>

<div id="searchbox" style="display: none" role="search">
  <h2 id="searchlabel">Search</h2>
  <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
  </div>
</div>
<script type="text/javascript">
  $("#searchbox").show(0);
</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


  </body>
</html>