
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>dagster_dbt.rpc.resources &#8212; Dagster</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 
<link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />


<meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
    <div class="documentwrapper">
        <div class="bodywrapper">
            <div class="related top">
                &nbsp;
<nav id="rellinks">
    <ul>
        <li>
            <a href="/" title="Home">Home</a>
        </li>
    </ul>
</nav>
            </div>
            

            

            <div class="body" role="main">
                
  <h1>Source code for dagster_dbt.rpc.resources</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">standard_b64encode</span> <span class="k">as</span> <span class="n">b64</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">dagster</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">IntSource</span><span class="p">,</span> <span class="n">RetryRequested</span><span class="p">,</span> <span class="n">StringSource</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">resource</span>

<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">is_fatal_code</span>


<div class="viewcode-block" id="DbtRpcClient"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient">[docs]</a><span class="k">class</span> <span class="nc">DbtRpcClient</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A client for a dbt RPC server.</span>

<span class="sd">    If you are need a dbt RPC server as a Dagster resource, we recommend that you use</span>
<span class="sd">    :func:`dbt_rpc_resource &lt;dagster_dbt.dbt_rpc_resource&gt;`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8580</span><span class="p">,</span>
        <span class="n">jsonrpc_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor</span>

<span class="sd">        Args:</span>
<span class="sd">            host (str): The IP address of the host of the dbt RPC server. Default is ``&quot;0.0.0.0&quot;``.</span>
<span class="sd">            port (int): The port of the dbt RPC server. Default is ``8580``.</span>
<span class="sd">            jsonrpc_version (str): The JSON-RPC version to send in RPC requests.</span>
<span class="sd">                Default is ``&quot;2.0&quot;``.</span>
<span class="sd">            logger (Optional[Any]): A property for injecting a logger dependency.</span>
<span class="sd">                Default is ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="o">.</span><span class="n">int_param</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="o">.</span><span class="n">str_param</span><span class="p">(</span><span class="n">jsonrpc_version</span><span class="p">,</span> <span class="s2">&quot;jsonrpc_version&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jsonrpc_version</span> <span class="o">=</span> <span class="n">jsonrpc_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_construct_user_agent</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A helper method to construct a standard User-Agent string to be used in HTTP request</span>
<span class="sd">        headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The constructed User-Agent value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="s2">&quot;dagster/dbt-rpc-client&quot;</span>
        <span class="n">python_version</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Python/</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">micro</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">system_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">user_agent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">python_version</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">system_info</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">user_agent</span>

    <span class="k">def</span> <span class="nf">_construct_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Constructs a standard set of headers for HTTP requests.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, str]: The HTTP request headers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">default_headers</span><span class="p">()</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_user_agent</span><span class="p">()</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/json&quot;</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/json&quot;</span>
        <span class="k">return</span> <span class="n">headers</span>

    <span class="k">def</span> <span class="nf">_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructs and sends a POST request to the dbt RPC server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_headers</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_fatal_code</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RetryRequested</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">seconds_to_wait</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">_default_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Constructs a standard HTTP request body, to be sent to a dbt RPC server.</span>

<span class="sd">        Args:</span>
<span class="sd">            method (str): a dbt RPC method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: the constructed HTTP request body.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsonrpc_version</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">()),</span>
            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_selection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">select</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">models</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;models&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">select</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;select&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">select</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">exclude</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">params</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">host</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;str: The IP address of the host of the dbt RPC server.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_host</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">port</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;int: The port of the dbt RPC server.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_port</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">jsonrpc_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;str: The JSON-RPC version to send in RPC requests.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jsonrpc_version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Optional[Any]: A property for injecting a logger dependency.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;str: The URL for sending dbt RPC requests.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">/jsonrpc&quot;</span>

<div class="viewcode-block" id="DbtRpcClient.status"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.status">[docs]</a>    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``status`` to the dbt RPC server, and returns the</span>
<span class="sd">        response. For more details, see the dbt docs for the RPC method `status</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#status&gt;`_.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.poll"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.poll">[docs]</a>    <span class="k">def</span> <span class="nf">poll</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">request_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">logs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">logs_start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``poll`` to the dbt RPC server, and returns the response.</span>
<span class="sd">        For more details, see the dbt docs for the RPC method `poll</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#poll&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            request_token (str): the token to poll responses for.</span>
<span class="sd">            logs (bool): Whether logs should be returned in the response. Defaults to ``False``.</span>
<span class="sd">            logs_start (int): The zero-indexed log line to fetch logs from. Defaults to ``0``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;poll&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;request_token&quot;</span><span class="p">:</span> <span class="n">request_token</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">:</span> <span class="n">logs</span><span class="p">,</span> <span class="s2">&quot;logs_start&quot;</span><span class="p">:</span> <span class="n">logs_start</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.ps"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.ps">[docs]</a>    <span class="k">def</span> <span class="nf">ps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">completed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``ps`` to the dbt RPC server, and returns the response.</span>
<span class="sd">        For more details, see the dbt docs for the RPC method `ps</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#ps&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            compelted (bool): If ``True``, then also return completed tasks. Defaults to ``False``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ps&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="n">completed</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.kill"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.kill">[docs]</a>    <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``kill`` to the dbt RPC server, and returns the response.</span>
<span class="sd">        For more details, see the dbt docs for the RPC method `kill</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#kill&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            task_id (str): the ID of the task to terminate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;kill&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.cli"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.cli">[docs]</a>    <span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cli</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with CLI syntax to the dbt RPC server, and returns the response.</span>
<span class="sd">        For more details, see the dbt docs for `running CLI commands via RPC</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#running-a-task-with-cli-syntax&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            cli (str): a dbt command in CLI syntax.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;cli_args&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cli&quot;</span><span class="p">:</span> <span class="n">cli</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.compile"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``compile`` to the dbt RPC server, and returns the</span>
<span class="sd">        response. For more details, see the dbt docs for `compiling projects via RPC</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#compile-a-project&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            models (List[str], optional): the models to include in compilation.</span>
<span class="sd">            exclude (List[str]), optional): the models to exclude from compilation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;compile&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.run"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``run`` to the dbt RPC server, and returns the response.</span>
<span class="sd">        For more details, see the dbt docs for the RPC method `run</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#run-models&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            models (List[str], optional): the models to include in the run.</span>
<span class="sd">            exclude (List[str]), optional): the models to exclude from the run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;run&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.snapshot"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.snapshot">[docs]</a>    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">select</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``snapshot`` to the dbt RPC server, and returns the</span>
<span class="sd">        response. For more details, see the dbt docs for the command `snapshot</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/snapshot&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            select (List[str], optional): the snapshots to include in the run.</span>
<span class="sd">            exclude (List[str], optional): the snapshots to exclude from the run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;snapshot&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.test"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.test">[docs]</a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``test`` to the dbt RPC server, and returns the response.</span>
<span class="sd">        For more details, see the dbt docs for the RPC method `test</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#run-test&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            models (List[str], optional): the models to include in testing.</span>
<span class="sd">            exclude (List[str], optional): the models to exclude from testing.</span>
<span class="sd">            data (bool, optional): If ``True`` (default), then run data tests.</span>
<span class="sd">            schema (bool, optional): If ``True`` (default), then run schema tests.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="p">}</span>

        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.seed"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.seed">[docs]</a>    <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``seed`` to the dbt RPC server, and returns the response.</span>
<span class="sd">        For more details, see the dbt docs for the RPC method `seed</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#run-seed&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            show (bool, optional): If ``True``, then show a sample of the seeded data in the</span>
<span class="sd">                response. Defaults to ``False``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;seed&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;show&quot;</span><span class="p">:</span> <span class="n">show</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.generate_docs"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.generate_docs">[docs]</a>    <span class="k">def</span> <span class="nf">generate_docs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">compile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># pylint: disable=redefined-builtin # TODO</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``docs.generate`` to the dbt RPC server, and returns the</span>
<span class="sd">        response. For more details, see the dbt docs for the RPC method `docs.generate</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc/#generate-docs&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            models (List[str], optional): the models to include in docs generation.</span>
<span class="sd">            exclude (List[str], optional): the models to exclude from docs generation.</span>
<span class="sd">            compile (bool, optional): If ``True`` (default), then compile the project before</span>
<span class="sd">                generating docs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;docs.generate&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;compile&quot;</span><span class="p">:</span> <span class="nb">compile</span><span class="p">}</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.run_operation"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.run_operation">[docs]</a>    <span class="k">def</span> <span class="nf">run_operation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">macro</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``run-operation`` to the dbt RPC server, and returns the</span>
<span class="sd">        response. For more details, see the dbt docs for the command `run-operation</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/run-operation&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            macro (str): the dbt macro to invoke.</span>
<span class="sd">            args (Dict[str, Any], optional): the keyword arguments to be supplied to the macro.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;run-operation&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;macro&quot;</span><span class="p">:</span> <span class="n">macro</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.snapshot_freshness"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.snapshot_freshness">[docs]</a>    <span class="k">def</span> <span class="nf">snapshot_freshness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">select</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``snapshot-freshness`` to the dbt RPC server, and returns</span>
<span class="sd">        the response. For more details, see the dbt docs for the command `source snapshot-freshness</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/source#dbt-source-snapshot-freshness&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            select (List[str], optional): the models to include in calculating snapshot freshness.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;snapshot-freshness&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;task_tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.compile_sql"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.compile_sql">[docs]</a>    <span class="k">def</span> <span class="nf">compile_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``compile_sql`` to the dbt RPC server, and returns the</span>
<span class="sd">        response. For more details, see the dbt docs for `compiling SQL via RPC</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc#compiling-a-query&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            sql (str): the SQL to compile in base-64 encoding.</span>
<span class="sd">            name (str): a name for the compiled SQL.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;compile_sql&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sql&quot;</span><span class="p">:</span> <span class="n">b64</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>

<div class="viewcode-block" id="DbtRpcClient.run_sql"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.DbtRpcClient.run_sql">[docs]</a>    <span class="k">def</span> <span class="nf">run_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sends a request with the method ``run_sql`` to the dbt RPC server, and returns the</span>
<span class="sd">        response. For more details, see the dbt docs for `running SQL via RPC</span>
<span class="sd">        &lt;https://docs.getdbt.com/reference/commands/rpc#executing-a-query&gt;`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            sql (str): the SQL to run in base-64 encoding.</span>
<span class="sd">            name (str): a name for the compiled SQL.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response: the HTTP response from the dbt RPC server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;run_sql&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sql&quot;</span><span class="p">:</span> <span class="n">b64</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="dbt_rpc_resource"><a class="viewcode-back" href="../../../sections/api/apidocs/libraries/dagster_dbt.html#dagster_dbt.dbt_rpc_resource">[docs]</a><span class="nd">@resource</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A resource representing a dbt RPC client.&quot;</span><span class="p">,</span>
    <span class="n">config_schema</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">Field</span><span class="p">(</span><span class="n">StringSource</span><span class="p">),</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">Field</span><span class="p">(</span><span class="n">IntSource</span><span class="p">,</span> <span class="n">is_required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">8580</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">dbt_rpc_resource</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DbtRpcClient</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This resource defines a dbt RPC client.</span>

<span class="sd">    To configure this resource, we recommend using the `configured</span>
<span class="sd">    &lt;https://docs.dagster.io/overview/configuration#configured&gt;`_ method.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        custom_dbt_rpc_resource = dbt_rpc_resource.configured({&quot;host&quot;: &quot;80.80.80.80&quot;,&quot;port&quot;: 8080,})</span>

<span class="sd">        @pipeline(mode_defs=[ModeDefinition(resource_defs={&quot;dbt_rpc&quot;: custom_dbt_rpc_resource})])</span>
<span class="sd">        def dbt_rpc_pipeline():</span>
<span class="sd">            # Run solids with `required_resource_keys={&quot;dbt_rpc&quot;, ...}`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DbtRpcClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">resource_config</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">],</span> <span class="n">port</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">resource_config</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span></div>


<span class="n">local_dbt_rpc_resource</span> <span class="o">=</span> <span class="n">dbt_rpc_resource</span><span class="o">.</span><span class="n">configured</span><span class="p">({</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">8580</span><span class="p">})</span>
<span class="n">local_dbt_rpc_resource</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;This resource defines a dbt RPC client for an RPC server running</span>
<span class="s2">on 0.0.0.0:8580.&quot;&quot;&quot;</span>
</pre></div>

            </div>
            <div class="related bottom">
                &nbsp;
<nav id="rellinks">
    <ul>
        <li>
            <a href="/" title="Home">Home</a>
        </li>
    </ul>
</nav>
            </div>
            
        </div>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3><a href="../../../index.html">Dagster</a></h3>

<div id="searchbox" style="display: none" role="search">
  <h2 id="searchlabel">Search</h2>
  <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
  </div>
</div>
<script type="text/javascript">
  $("#searchbox").show(0);
</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


  </body>
</html>