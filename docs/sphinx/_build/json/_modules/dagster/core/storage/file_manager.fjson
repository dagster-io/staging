{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "dagster.core.storage.file_manager", "body": "<h1>Source code for dagster.core.storage.file_manager</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">io</span>\n<span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"kn\">import</span> <span class=\"nn\">shutil</span>\n<span class=\"kn\">import</span> <span class=\"nn\">uuid</span>\n<span class=\"kn\">from</span> <span class=\"nn\">abc</span> <span class=\"kn\">import</span> <span class=\"n\">ABCMeta</span><span class=\"p\">,</span> <span class=\"n\">abstractmethod</span><span class=\"p\">,</span> <span class=\"n\">abstractproperty</span>\n<span class=\"kn\">from</span> <span class=\"nn\">contextlib</span> <span class=\"kn\">import</span> <span class=\"n\">contextmanager</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">six</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.config</span> <span class=\"kn\">import</span> <span class=\"n\">Field</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.config.source</span> <span class=\"kn\">import</span> <span class=\"n\">StringSource</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions.resource</span> <span class=\"kn\">import</span> <span class=\"n\">resource</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.instance</span> <span class=\"kn\">import</span> <span class=\"n\">DagsterInstance</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.types.decorator</span> <span class=\"kn\">import</span> <span class=\"n\">usable_as_dagster_type</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils</span> <span class=\"kn\">import</span> <span class=\"n\">mkdir_p</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.temp_file_manager</span> <span class=\"kn\">import</span> <span class=\"n\">TempfileManager</span>\n\n\n<span class=\"c1\"># pylint: disable=no-init</span>\n<div class=\"viewcode-block\" id=\"FileHandle\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/types/#dagster.core.storage.file_manager.FileHandle\">[docs]</a><span class=\"nd\">@usable_as_dagster_type</span>\n<span class=\"k\">class</span> <span class=\"nc\">FileHandle</span><span class=\"p\">(</span><span class=\"n\">six</span><span class=\"o\">.</span><span class=\"n\">with_metaclass</span><span class=\"p\">(</span><span class=\"n\">ABCMeta</span><span class=\"p\">)):</span>\n    <span class=\"sd\">&quot;&quot;&quot;A file handle is a reference to a file.</span>\n\n<span class=\"sd\">    Files can be be resident in the local file system, an object store, or any arbitrary place</span>\n<span class=\"sd\">    where a file can be stored.</span>\n\n<span class=\"sd\">    This exists to handle the very common case where you wish to write a computation that reads,</span>\n<span class=\"sd\">    transforms, and writes files, but where the same code can work in local development as well</span>\n<span class=\"sd\">    as in a cluster where the files would be stored in globally available object store such as s3.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"nd\">@abstractproperty</span>\n    <span class=\"k\">def</span> <span class=\"nf\">path_desc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot; This is a properly to return a *representation* of the path for</span>\n<span class=\"sd\">        diplay purposes. Should not be used in a programatically meaningful</span>\n<span class=\"sd\">        way beyond display&quot;&quot;&quot;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></div>\n\n\n<div class=\"viewcode-block\" id=\"LocalFileHandle\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/types/#dagster.core.storage.file_manager.LocalFileHandle\">[docs]</a><span class=\"nd\">@usable_as_dagster_type</span>\n<span class=\"k\">class</span> <span class=\"nc\">LocalFileHandle</span><span class=\"p\">(</span><span class=\"n\">FileHandle</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_path</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s2\">&quot;path&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">path</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_path</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">path_desc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_path</span></div>\n\n\n<div class=\"viewcode-block\" id=\"FileManager\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.FileManager\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">FileManager</span><span class=\"p\">(</span><span class=\"n\">six</span><span class=\"o\">.</span><span class=\"n\">with_metaclass</span><span class=\"p\">(</span><span class=\"n\">ABCMeta</span><span class=\"p\">)):</span>  <span class=\"c1\"># pylint: disable=no-init</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    The base class for all file managers in dagster. The file manager is a user-facing</span>\n<span class=\"sd\">    abstraction that allows a Dagster user to pass files in between solids, and the file</span>\n<span class=\"sd\">    manager is responsible for marshalling those files to and from the nodes where</span>\n<span class=\"sd\">    the actual Dagster computation occur.</span>\n\n<span class=\"sd\">    If the user does their file manipulations using this abstraction, it is straightforward to write</span>\n<span class=\"sd\">    a pipeline that executes both:</span>\n\n<span class=\"sd\">        (a) in a local development environment with no external dependencies, where files are</span>\n<span class=\"sd\">            available directly on the filesystem and</span>\n<span class=\"sd\">        (b) in a cluster environment where those files would need to be on a distributed filesystem</span>\n<span class=\"sd\">            (e.g. hdfs) or an object store (s3).</span>\n\n<span class=\"sd\">    The business logic remains constant and a new implementation of the file manager is swapped out</span>\n<span class=\"sd\">    based on the system storage specified by the operator.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n<div class=\"viewcode-block\" id=\"FileManager.copy_handle_to_local_temp\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.FileManager.copy_handle_to_local_temp\">[docs]</a>    <span class=\"nd\">@abstractmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">copy_handle_to_local_temp</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_handle</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Take a file handle and make it available as a local temp file. Returns a path.</span>\n\n<span class=\"sd\">        In an implementation like an ``S3FileManager``, this would download the file from s3</span>\n<span class=\"sd\">        to local filesystem, to files created (typically) by the python tempfile module.</span>\n\n<span class=\"sd\">        These temp files are *not* guaranteed to be able across solid boundaries. For</span>\n<span class=\"sd\">        files that must work across solid boundaries, use the read, read_data, write, and</span>\n<span class=\"sd\">        write_data methods on this class.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            file_handle (FileHandle): The file handle to make available as a local temp file.</span>\n\n<span class=\"sd\">        Returns:</span>\n<span class=\"sd\">            str: Path to the temp file.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"FileManager.delete_local_temp\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.FileManager.delete_local_temp\">[docs]</a>    <span class=\"nd\">@abstractmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">delete_local_temp</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Delete all the local temporary files created by ``copy_handle_to_local_temp``. This should</span>\n<span class=\"sd\">        typically only be called by framework implementors.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"FileManager.read\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.FileManager.read\">[docs]</a>    <span class=\"nd\">@abstractmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">read</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_handle</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s2\">&quot;rb&quot;</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Return a file-like stream for the file handle. Defaults to binary mode read.</span>\n<span class=\"sd\">        This may incur an expensive network call for file managers backed by object stores</span>\n<span class=\"sd\">        such as s3.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            file_handle (FileHandle): The file handle to make available as a stream.</span>\n<span class=\"sd\">            mode (str): The mode in which to open the file. Default: ``&#39;rb&#39;``.</span>\n\n<span class=\"sd\">        Returns:</span>\n<span class=\"sd\">            Union[IOBytes, IOString]: A file-like stream.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"FileManager.read_data\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.FileManager.read_data\">[docs]</a>    <span class=\"nd\">@abstractmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">read_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_handle</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Return the bytes for a given file handle. This may incur an expensive network</span>\n<span class=\"sd\">        call for file managers backed by object stores such as s3.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            file_handle (FileHandle): The file handle for which to return bytes.</span>\n\n<span class=\"sd\">        Returns:</span>\n<span class=\"sd\">            bytes: Bytes for a given file handle.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"FileManager.write\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.FileManager.write\">[docs]</a>    <span class=\"nd\">@abstractmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_obj</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s2\">&quot;wb&quot;</span><span class=\"p\">,</span> <span class=\"n\">ext</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Write the bytes contained within the given ``file_obj`` into the file manager.</span>\n<span class=\"sd\">        This returns a :py:class:`~dagster.FileHandle` corresponding to the newly created file.</span>\n\n<span class=\"sd\">        File managers typically return a subclass of :py:class:`~dagster.FileHandle` appropriate for</span>\n<span class=\"sd\">        their implementation: e.g., a</span>\n<span class=\"sd\">        :py:class:`~dagster.core.storage.file_manager.LocalFileManager` returns a</span>\n<span class=\"sd\">        :py:class:`~dagster.LocalFileHandle`, an :py:class:`~dagster_aws.S3FileManager` returns an</span>\n<span class=\"sd\">        :py:class:`~dagster_aws.S3FileHandle`, and so forth.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            file_obj (Union[IOBytes, IOString]): A file-like object.</span>\n<span class=\"sd\">            mode (Optional[str]): The mode in which to write the file into storage. Default: ``&#39;wb&#39;``.</span>\n<span class=\"sd\">            ext (Optional[str]): For file managers that support file extensions, the extension with</span>\n<span class=\"sd\">                which to write the file. Default: ``None``.</span>\n\n<span class=\"sd\">        Returns:</span>\n<span class=\"sd\">            FileHandle: A handle to the newly created file.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"FileManager.write_data\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.FileManager.write_data\">[docs]</a>    <span class=\"nd\">@abstractmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">write_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">ext</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Write raw bytes into storage.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            data (bytes): The bytes to write into storage.</span>\n<span class=\"sd\">            ext (Optional[str]): For file managers that support file extensions, the extension with</span>\n<span class=\"sd\">                which to write the file. Default: ``None``.</span>\n\n<span class=\"sd\">        Returns:</span>\n<span class=\"sd\">            FileHandle: A handle to the newly created file.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></div></div>\n\n\n<span class=\"nd\">@resource</span><span class=\"p\">(</span><span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;base_dir&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">,</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"s2\">&quot;.&quot;</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)})</span>\n<span class=\"k\">def</span> <span class=\"nf\">local_file_manager</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">LocalFileManager</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;base_dir&quot;</span><span class=\"p\">])</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">check_file_like_obj</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">):</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">obj</span> <span class=\"ow\">and</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"s2\">&quot;read&quot;</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"s2\">&quot;write&quot;</span><span class=\"p\">))</span>\n\n\n<div class=\"viewcode-block\" id=\"LocalFileManager\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.core.storage.file_manager.LocalFileManager\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">LocalFileManager</span><span class=\"p\">(</span><span class=\"n\">FileManager</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">base_dir</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">base_dir</span> <span class=\"o\">=</span> <span class=\"n\">base_dir</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_base_dir_ensured</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_temp_file_manager</span> <span class=\"o\">=</span> <span class=\"n\">TempfileManager</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">for_instance</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">run_id</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">,</span> <span class=\"n\">DagsterInstance</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">LocalFileManager</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">file_manager_directory</span><span class=\"p\">(</span><span class=\"n\">run_id</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">ensure_base_dir_exists</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_base_dir_ensured</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span>\n\n        <span class=\"n\">mkdir_p</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">base_dir</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_base_dir_ensured</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">copy_handle_to_local_temp</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_handle</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">file_handle</span><span class=\"p\">,</span> <span class=\"s2\">&quot;file_handle&quot;</span><span class=\"p\">,</span> <span class=\"n\">FileHandle</span><span class=\"p\">)</span>\n        <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"n\">file_handle</span><span class=\"p\">,</span> <span class=\"s2\">&quot;rb&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">handle_obj</span><span class=\"p\">:</span>\n            <span class=\"n\">temp_file_obj</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_temp_file_manager</span><span class=\"o\">.</span><span class=\"n\">tempfile</span><span class=\"p\">()</span>\n            <span class=\"n\">temp_file_obj</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">handle_obj</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">())</span>\n            <span class=\"n\">temp_name</span> <span class=\"o\">=</span> <span class=\"n\">temp_file_obj</span><span class=\"o\">.</span><span class=\"n\">name</span>\n            <span class=\"n\">temp_file_obj</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">()</span>\n            <span class=\"k\">return</span> <span class=\"n\">temp_name</span>\n\n    <span class=\"nd\">@contextmanager</span>\n    <span class=\"k\">def</span> <span class=\"nf\">read</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_handle</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s2\">&quot;rb&quot;</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">file_handle</span><span class=\"p\">,</span> <span class=\"s2\">&quot;file_handle&quot;</span><span class=\"p\">,</span> <span class=\"n\">LocalFileHandle</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"s2\">&quot;mode&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">param_invariant</span><span class=\"p\">(</span><span class=\"n\">mode</span> <span class=\"ow\">in</span> <span class=\"p\">{</span><span class=\"s2\">&quot;r&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;rb&quot;</span><span class=\"p\">},</span> <span class=\"s2\">&quot;mode&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">file_handle</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file_obj</span><span class=\"p\">:</span>\n            <span class=\"k\">yield</span> <span class=\"n\">file_obj</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">read_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_handle</span><span class=\"p\">):</span>\n        <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"n\">file_handle</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s2\">&quot;rb&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file_obj</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">file_obj</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">write_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">ext</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"s2\">&quot;data&quot;</span><span class=\"p\">,</span> <span class=\"nb\">bytes</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">io</span><span class=\"o\">.</span><span class=\"n\">BytesIO</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">),</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s2\">&quot;wb&quot;</span><span class=\"p\">,</span> <span class=\"n\">ext</span><span class=\"o\">=</span><span class=\"n\">ext</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">file_obj</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"s2\">&quot;wb&quot;</span><span class=\"p\">,</span> <span class=\"n\">ext</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">check_file_like_obj</span><span class=\"p\">(</span><span class=\"n\">file_obj</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">ext</span><span class=\"p\">,</span> <span class=\"s2\">&quot;ext&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ensure_base_dir_exists</span><span class=\"p\">()</span>\n\n        <span class=\"n\">dest_file_path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">base_dir</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">uuid</span><span class=\"o\">.</span><span class=\"n\">uuid4</span><span class=\"p\">())</span> <span class=\"o\">+</span> <span class=\"p\">((</span><span class=\"s2\">&quot;.&quot;</span> <span class=\"o\">+</span> <span class=\"n\">ext</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">ext</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">dest_file_path</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">dest_file_obj</span><span class=\"p\">:</span>\n            <span class=\"n\">shutil</span><span class=\"o\">.</span><span class=\"n\">copyfileobj</span><span class=\"p\">(</span><span class=\"n\">file_obj</span><span class=\"p\">,</span> <span class=\"n\">dest_file_obj</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">LocalFileHandle</span><span class=\"p\">(</span><span class=\"n\">dest_file_path</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">delete_local_temp</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_temp_file_manager</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">()</span></div>\n</pre></div>", "current_page_name": "_modules/dagster/core/storage/file_manager", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}