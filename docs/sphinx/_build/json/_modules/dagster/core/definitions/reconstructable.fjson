{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "dagster.core.definitions.reconstructable", "body": "<h1>Source code for dagster.core.definitions.reconstructable</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">inspect</span>\n<span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n<span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span><span class=\"p\">,</span> <span class=\"n\">seven</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.code_pointer</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">CodePointer</span><span class=\"p\">,</span>\n    <span class=\"n\">CustomPointer</span><span class=\"p\">,</span>\n    <span class=\"n\">FileCodePointer</span><span class=\"p\">,</span>\n    <span class=\"n\">ModuleCodePointer</span><span class=\"p\">,</span>\n    <span class=\"n\">get_python_file_from_target</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.errors</span> <span class=\"kn\">import</span> <span class=\"n\">DagsterInvalidSubsetError</span><span class=\"p\">,</span> <span class=\"n\">DagsterInvariantViolationError</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.origin</span> <span class=\"kn\">import</span> <span class=\"n\">PipelinePythonOrigin</span><span class=\"p\">,</span> <span class=\"n\">RepositoryPythonOrigin</span><span class=\"p\">,</span> <span class=\"n\">SchedulePythonOrigin</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.selector</span> <span class=\"kn\">import</span> <span class=\"n\">parse_solid_selection</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.serdes</span> <span class=\"kn\">import</span> <span class=\"n\">pack_value</span><span class=\"p\">,</span> <span class=\"n\">unpack_value</span><span class=\"p\">,</span> <span class=\"n\">whitelist_for_serdes</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.seven</span> <span class=\"kn\">import</span> <span class=\"n\">lru_cache</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.backcompat</span> <span class=\"kn\">import</span> <span class=\"n\">experimental</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.pipeline_base</span> <span class=\"kn\">import</span> <span class=\"n\">IPipeline</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">get_ephemeral_repository_name</span><span class=\"p\">(</span><span class=\"n\">pipeline_name</span><span class=\"p\">):</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_name&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"s2\">&quot;__repository__</span><span class=\"si\">{pipeline_name}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">pipeline_name</span><span class=\"o\">=</span><span class=\"n\">pipeline_name</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@whitelist_for_serdes</span>\n<span class=\"k\">class</span> <span class=\"nc\">ReconstructableRepository</span><span class=\"p\">(</span>\n    <span class=\"n\">namedtuple</span><span class=\"p\">(</span><span class=\"s2\">&quot;_ReconstructableRepository&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pointer container_image&quot;</span><span class=\"p\">)</span>\n<span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__new__</span><span class=\"p\">(</span>\n        <span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">pointer</span><span class=\"p\">,</span> <span class=\"n\">container_image</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">ReconstructableRepository</span><span class=\"p\">,</span> <span class=\"bp\">cls</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__new__</span><span class=\"p\">(</span>\n            <span class=\"bp\">cls</span><span class=\"p\">,</span>\n            <span class=\"n\">pointer</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pointer&quot;</span><span class=\"p\">,</span> <span class=\"n\">CodePointer</span><span class=\"p\">),</span>\n            <span class=\"n\">container_image</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">container_image</span><span class=\"p\">,</span> <span class=\"s2\">&quot;container_image&quot;</span><span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"nd\">@lru_cache</span><span class=\"p\">(</span><span class=\"n\">maxsize</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">get_definition</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">repository_def_from_pointer</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pointer</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_reconstructable_pipeline</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_reconstructable_schedule</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">ReconstructableSchedule</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@classmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">for_file</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">,</span> <span class=\"n\">working_directory</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">container_image</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">working_directory</span><span class=\"p\">:</span>\n            <span class=\"n\">working_directory</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"bp\">cls</span><span class=\"p\">(</span><span class=\"n\">FileCodePointer</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">,</span> <span class=\"n\">working_directory</span><span class=\"p\">),</span> <span class=\"n\">container_image</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@classmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">for_module</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">,</span> <span class=\"n\">container_image</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">cls</span><span class=\"p\">(</span><span class=\"n\">ModuleCodePointer</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">),</span> <span class=\"n\">container_image</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_cli_args</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pointer</span><span class=\"o\">.</span><span class=\"n\">get_cli_args</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@classmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">from_legacy_repository_yaml</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">file_path</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">file_path</span><span class=\"p\">,</span> <span class=\"s2\">&quot;file_path&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">absolute_file_path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">abspath</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">expanduser</span><span class=\"p\">(</span><span class=\"n\">file_path</span><span class=\"p\">))</span>\n        <span class=\"k\">return</span> <span class=\"bp\">cls</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"o\">=</span><span class=\"n\">CodePointer</span><span class=\"o\">.</span><span class=\"n\">from_legacy_repository_yaml</span><span class=\"p\">(</span><span class=\"n\">absolute_file_path</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_python_origin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">RepositoryPythonOrigin</span><span class=\"p\">(</span>\n            <span class=\"n\">executable_path</span><span class=\"o\">=</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">executable</span><span class=\"p\">,</span>\n            <span class=\"n\">code_pointer</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pointer</span><span class=\"p\">,</span>\n            <span class=\"n\">container_image</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">container_image</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_python_origin_id</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_python_origin</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get_id</span><span class=\"p\">()</span>\n\n\n<span class=\"nd\">@whitelist_for_serdes</span>\n<span class=\"k\">class</span> <span class=\"nc\">ReconstructablePipeline</span><span class=\"p\">(</span>\n    <span class=\"n\">namedtuple</span><span class=\"p\">(</span>\n        <span class=\"s2\">&quot;_ReconstructablePipeline&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;repository pipeline_name solid_selection_str solids_to_execute&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">),</span>\n    <span class=\"n\">IPipeline</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__new__</span><span class=\"p\">(</span>\n        <span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">repository</span><span class=\"p\">,</span> <span class=\"n\">pipeline_name</span><span class=\"p\">,</span> <span class=\"n\">solid_selection_str</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_set_param</span><span class=\"p\">(</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span> <span class=\"s2\">&quot;solids_to_execute&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">ReconstructablePipeline</span><span class=\"p\">,</span> <span class=\"bp\">cls</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__new__</span><span class=\"p\">(</span>\n            <span class=\"bp\">cls</span><span class=\"p\">,</span>\n            <span class=\"n\">repository</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">repository</span><span class=\"p\">,</span> <span class=\"s2\">&quot;repository&quot;</span><span class=\"p\">,</span> <span class=\"n\">ReconstructableRepository</span><span class=\"p\">),</span>\n            <span class=\"n\">pipeline_name</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_name&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">solid_selection_str</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">solid_selection_str</span><span class=\"p\">,</span> <span class=\"s2\">&quot;solid_selection_str&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">solid_selection</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">seven</span><span class=\"o\">.</span><span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">loads</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">solid_selection_str</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">solid_selection_str</span> <span class=\"k\">else</span> <span class=\"kc\">None</span>\n\n    <span class=\"nd\">@lru_cache</span><span class=\"p\">(</span><span class=\"n\">maxsize</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">get_definition</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span>\n            <span class=\"o\">.</span><span class=\"n\">get_pipeline</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_name</span><span class=\"p\">)</span>\n            <span class=\"o\">.</span><span class=\"n\">get_pipeline_subset_def</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_resolve_solid_selection</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">solid_selection</span><span class=\"p\">):</span>\n        <span class=\"c1\"># resolve a list of solid selection queries to a frozenset of qualified solid names</span>\n        <span class=\"c1\"># e.g. [&#39;foo_solid+&#39;] to {&#39;foo_solid&#39;, &#39;bar_solid&#39;}</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">list_param</span><span class=\"p\">(</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span> <span class=\"s2\">&quot;solid_selection&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n        <span class=\"n\">solids_to_execute</span> <span class=\"o\">=</span> <span class=\"n\">parse_solid_selection</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">(),</span> <span class=\"n\">solid_selection</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">solids_to_execute</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">DagsterInvalidSubsetError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;No qualified solids to execute found for solid_selection=</span><span class=\"si\">{requested}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">requested</span><span class=\"o\">=</span><span class=\"n\">solid_selection</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">solids_to_execute</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_reconstructable_repository</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_subset_for_execution</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">solids_to_execute</span><span class=\"p\">,</span> <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">solids_to_execute</span><span class=\"p\">:</span>\n            <span class=\"n\">pipe</span> <span class=\"o\">=</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"p\">(</span>\n                <span class=\"n\">repository</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"p\">,</span>\n                <span class=\"n\">pipeline_name</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_name</span><span class=\"p\">,</span>\n                <span class=\"n\">solid_selection_str</span><span class=\"o\">=</span><span class=\"n\">seven</span><span class=\"o\">.</span><span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span><span class=\"n\">solid_selection</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">solid_selection</span> <span class=\"k\">else</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n                <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"nb\">frozenset</span><span class=\"p\">(</span><span class=\"n\">solids_to_execute</span><span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">pipe</span> <span class=\"o\">=</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"p\">(</span>\n                <span class=\"n\">repository</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"p\">,</span> <span class=\"n\">pipeline_name</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"n\">pipe</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span>  <span class=\"c1\"># verify the subset is correct</span>\n        <span class=\"k\">return</span> <span class=\"n\">pipe</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">subset_for_execution</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">solid_selection</span><span class=\"p\">):</span>\n        <span class=\"c1\"># take a list of solid queries and resolve the queries to names of solids to execute</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_list_param</span><span class=\"p\">(</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span> <span class=\"s2\">&quot;solid_selection&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n        <span class=\"n\">solids_to_execute</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_resolve_solid_selection</span><span class=\"p\">(</span><span class=\"n\">solid_selection</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">solid_selection</span> <span class=\"k\">else</span> <span class=\"kc\">None</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_subset_for_execution</span><span class=\"p\">(</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span> <span class=\"n\">solid_selection</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">subset_for_execution_from_existing_pipeline</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">solids_to_execute</span><span class=\"p\">):</span>\n        <span class=\"c1\"># take a frozenset of resolved solid names from an existing pipeline</span>\n        <span class=\"c1\"># so there&#39;s no need to parse the selection</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_set_param</span><span class=\"p\">(</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span> <span class=\"s2\">&quot;solids_to_execute&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_subset_for_execution</span><span class=\"p\">(</span><span class=\"n\">solids_to_execute</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">describe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"s1\">&#39;&quot;</span><span class=\"si\">{name}</span><span class=\"s1\">&quot; in repository (</span><span class=\"si\">{repo}</span><span class=\"s1\">)&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n            <span class=\"n\">repo</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"o\">.</span><span class=\"n\">pointer</span><span class=\"o\">.</span><span class=\"n\">describe</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_name</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">for_file</span><span class=\"p\">(</span><span class=\"n\">python_file</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">bootstrap_standalone_recon_pipeline</span><span class=\"p\">(</span>\n            <span class=\"n\">FileCodePointer</span><span class=\"p\">(</span><span class=\"n\">python_file</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">,</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">())</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">for_module</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">bootstrap_standalone_recon_pipeline</span><span class=\"p\">(</span><span class=\"n\">ModuleCodePointer</span><span class=\"p\">(</span><span class=\"n\">module</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">to_dict</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">pack_value</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">from_dict</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">dict_param</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"s2\">&quot;val&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"n\">inst</span> <span class=\"o\">=</span> <span class=\"n\">unpack_value</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n            <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">inst</span><span class=\"p\">,</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;Deserialized object is not instance of ReconstructablePipeline, got </span><span class=\"si\">{type}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">inst</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_python_origin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">PipelinePythonOrigin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_name</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"o\">.</span><span class=\"n\">get_python_origin</span><span class=\"p\">())</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_python_origin_id</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_python_origin</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get_id</span><span class=\"p\">()</span>\n\n\n<span class=\"nd\">@whitelist_for_serdes</span>\n<span class=\"k\">class</span> <span class=\"nc\">ReconstructableSchedule</span><span class=\"p\">(</span><span class=\"n\">namedtuple</span><span class=\"p\">(</span><span class=\"s2\">&quot;_ReconstructableSchedule&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;repository schedule_name&quot;</span><span class=\"p\">,)):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__new__</span><span class=\"p\">(</span>\n        <span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">repository</span><span class=\"p\">,</span> <span class=\"n\">schedule_name</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">ReconstructableSchedule</span><span class=\"p\">,</span> <span class=\"bp\">cls</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__new__</span><span class=\"p\">(</span>\n            <span class=\"bp\">cls</span><span class=\"p\">,</span>\n            <span class=\"n\">repository</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">repository</span><span class=\"p\">,</span> <span class=\"s2\">&quot;repository&quot;</span><span class=\"p\">,</span> <span class=\"n\">ReconstructableRepository</span><span class=\"p\">),</span>\n            <span class=\"n\">schedule_name</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">schedule_name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;schedule_name&quot;</span><span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_python_origin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">SchedulePythonOrigin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">schedule_name</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"o\">.</span><span class=\"n\">get_python_origin</span><span class=\"p\">())</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_python_origin_id</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_python_origin</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get_id</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@lru_cache</span><span class=\"p\">(</span><span class=\"n\">maxsize</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">get_definition</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get_schedule_def</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">schedule_name</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"reconstructable\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/execution/#dagster.reconstructable\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">reconstructable</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Create a ReconstructablePipeline from a function that returns a PipelineDefinition, or a</span>\n<span class=\"sd\">    function decorated with :py:func:`@pipeline &lt;dagster.pipeline&gt;`</span>\n\n<span class=\"sd\">    When your pipeline must cross process boundaries, e.g., for execution on multiple nodes or</span>\n<span class=\"sd\">    in different systems (like dagstermill), Dagster must know how to reconstruct the pipeline</span>\n<span class=\"sd\">    on the other side of the process boundary.</span>\n\n<span class=\"sd\">    This function implements a very conservative strategy for reconstructing pipelines, so that</span>\n<span class=\"sd\">    its behavior is easy to predict, but as a consequence it is not able to reconstruct certain</span>\n<span class=\"sd\">    kinds of pipelines, such as those defined by lambdas, in nested scopes (e.g., dynamically</span>\n<span class=\"sd\">    within a method call), or in interactive environments such as the Python REPL or Jupyter</span>\n<span class=\"sd\">    notebooks.</span>\n\n<span class=\"sd\">    If you need to reconstruct pipelines constructed in these ways, you should use</span>\n<span class=\"sd\">    :py:func:`build_reconstructable_pipeline` instead, which allows you to specify your own</span>\n<span class=\"sd\">    strategy for reconstructing a pipeline.</span>\n\n<span class=\"sd\">    Examples:</span>\n\n<span class=\"sd\">    .. code-block:: python</span>\n\n<span class=\"sd\">        from dagster import PipelineDefinition, pipeline, reconstructable</span>\n\n<span class=\"sd\">        @pipeline</span>\n<span class=\"sd\">        def foo_pipeline():</span>\n<span class=\"sd\">            ...</span>\n\n<span class=\"sd\">        reconstructable_foo_pipeline = reconstructable(foo_pipeline)</span>\n\n\n<span class=\"sd\">        def make_bar_pipeline():</span>\n<span class=\"sd\">            return PipelineDefinition(...)</span>\n\n<span class=\"sd\">        reconstructable_bar_pipeline = reconstructable(bar_pipeline)</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineDefinition</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">seven</span><span class=\"o\">.</span><span class=\"n\">is_function_or_decorator_instance_of</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;Reconstructable target should be a function or definition produced &quot;</span>\n            <span class=\"s2\">&quot;by a decorated function, got </span><span class=\"si\">{type}</span><span class=\"s2\">.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)),</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">seven</span><span class=\"o\">.</span><span class=\"n\">is_lambda</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;Reconstructable target can not be a lambda. Use a function or &quot;</span>\n            <span class=\"s2\">&quot;decorated function defined at module scope instead, or use &quot;</span>\n            <span class=\"s2\">&quot;build_reconstructable_pipeline.&quot;</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">seven</span><span class=\"o\">.</span><span class=\"n\">qualname_differs</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s1\">&#39;Reconstructable target &quot;</span><span class=\"si\">{target.__name__}</span><span class=\"s1\">&quot; has a different &#39;</span>\n            <span class=\"s1\">&#39;__qualname__ &quot;</span><span class=\"si\">{target.__qualname__}</span><span class=\"s1\">&quot; indicating it is not &#39;</span>\n            <span class=\"s2\">&quot;defined at module scope. Use a function or decorated function &quot;</span>\n            <span class=\"s2\">&quot;defined at module scope instead, or use build_reconstructable_pipeline.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">target</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"s2\">&quot;__module__&quot;</span><span class=\"p\">)</span>\n            <span class=\"ow\">and</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"s2\">&quot;__name__&quot;</span><span class=\"p\">)</span>\n            <span class=\"ow\">and</span> <span class=\"n\">inspect</span><span class=\"o\">.</span><span class=\"n\">getmodule</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__name__</span> <span class=\"o\">!=</span> <span class=\"s2\">&quot;__main__&quot;</span>\n        <span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"o\">.</span><span class=\"n\">for_module</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"o\">.</span><span class=\"vm\">__module__</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span><span class=\"p\">:</span>  <span class=\"c1\"># pylint: disable=bare-except</span>\n        <span class=\"k\">pass</span>\n\n    <span class=\"n\">python_file</span> <span class=\"o\">=</span> <span class=\"n\">get_python_file_from_target</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">python_file</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;reconstructable() can not reconstruct pipelines defined in interactive environments &quot;</span>\n            <span class=\"s2\">&quot;like &lt;stdin&gt;, IPython, or Jupyter notebooks. &quot;</span>\n            <span class=\"s2\">&quot;Use a pipeline defined in a module or file instead, or &quot;</span>\n            <span class=\"s2\">&quot;use build_reconstructable_pipeline.&quot;</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">pointer</span> <span class=\"o\">=</span> <span class=\"n\">FileCodePointer</span><span class=\"p\">(</span>\n        <span class=\"n\">python_file</span><span class=\"o\">=</span><span class=\"n\">python_file</span><span class=\"p\">,</span> <span class=\"n\">fn_name</span><span class=\"o\">=</span><span class=\"n\">target</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">,</span> <span class=\"n\">working_directory</span><span class=\"o\">=</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">bootstrap_standalone_recon_pipeline</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@experimental</span>\n<span class=\"k\">def</span> <span class=\"nf\">build_reconstructable_pipeline</span><span class=\"p\">(</span>\n    <span class=\"n\">reconstructor_module_name</span><span class=\"p\">,</span>\n    <span class=\"n\">reconstructor_function_name</span><span class=\"p\">,</span>\n    <span class=\"n\">reconstructable_args</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">reconstructable_kwargs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Create a ReconstructablePipeline.</span>\n\n<span class=\"sd\">    When your pipeline must cross process boundaries, e.g., for execution on multiple nodes or</span>\n<span class=\"sd\">    in different systems (like dagstermill), Dagster must know how to reconstruct the pipeline</span>\n<span class=\"sd\">    on the other side of the process boundary.</span>\n\n<span class=\"sd\">    This function allows you to use the strategy of your choice for reconstructing pipelines, so</span>\n<span class=\"sd\">    that you can reconstruct certain kinds of pipelines that are not supported by</span>\n<span class=\"sd\">    :py:func:`reconstructable`, such as those defined by lambdas, in nested scopes (e.g.,</span>\n<span class=\"sd\">    dynamically within a method call), or in interactive environments such as the Python REPL or</span>\n<span class=\"sd\">    Jupyter notebooks.</span>\n\n<span class=\"sd\">    If you need to reconstruct pipelines constructed in these ways, use this function instead of</span>\n<span class=\"sd\">    :py:func:`reconstructable`.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        reconstructor_module_name (str): The name of the module containing the function to use to</span>\n<span class=\"sd\">            reconstruct the pipeline.</span>\n<span class=\"sd\">        reconstructor_function_name (str): The name of the function to use to reconstruct the</span>\n<span class=\"sd\">            pipeline.</span>\n<span class=\"sd\">        reconstructable_args (Tuple): Args to the function to use to reconstruct the pipeline.</span>\n<span class=\"sd\">            Values of the tuple must be JSON serializable.</span>\n<span class=\"sd\">        reconstructable_kwargs (Dict[str, Any]): Kwargs to the function to use to reconstruct the</span>\n<span class=\"sd\">            pipeline. Values of the dict must be JSON serializable.</span>\n\n<span class=\"sd\">    Examples:</span>\n\n<span class=\"sd\">    .. code-block:: python</span>\n\n<span class=\"sd\">        # module: mymodule</span>\n\n<span class=\"sd\">        from dagster import PipelineDefinition, pipeline, build_reconstructable_pipeline</span>\n\n<span class=\"sd\">        class PipelineFactory(object):</span>\n<span class=\"sd\">            def make_pipeline(*args, **kwargs):</span>\n\n<span class=\"sd\">                @pipeline</span>\n<span class=\"sd\">                def _pipeline(...):</span>\n<span class=\"sd\">                    ...</span>\n\n<span class=\"sd\">                return _pipeline</span>\n\n<span class=\"sd\">        def reconstruct_pipeline(*args):</span>\n<span class=\"sd\">            factory = PipelineFactory()</span>\n<span class=\"sd\">            return factory.make_pipeline(*args)</span>\n\n<span class=\"sd\">        factory = PipelineFactory()</span>\n\n<span class=\"sd\">        foo_pipeline_args = (...,...)</span>\n\n<span class=\"sd\">        foo_pipeline_kwargs = {...:...}</span>\n\n<span class=\"sd\">        foo_pipeline = factory.make_pipeline(*foo_pipeline_args, **foo_pipeline_kwargs)</span>\n\n<span class=\"sd\">        reconstructable_foo_pipeline = build_reconstructable_pipeline(</span>\n<span class=\"sd\">            &#39;mymodule&#39;,</span>\n<span class=\"sd\">            &#39;reconstruct_pipeline&#39;,</span>\n<span class=\"sd\">            foo_pipeline_args,</span>\n<span class=\"sd\">            foo_pipeline_kwargs,</span>\n<span class=\"sd\">        )</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">reconstructor_module_name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;reconstructor_module_name&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">reconstructor_function_name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;reconstructor_function_name&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"n\">reconstructable_args</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_tuple_param</span><span class=\"p\">(</span><span class=\"n\">reconstructable_args</span><span class=\"p\">,</span> <span class=\"s2\">&quot;reconstructable_args&quot;</span><span class=\"p\">))</span>\n    <span class=\"n\">reconstructable_kwargs</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span>\n        <span class=\"p\">(</span>\n            <span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">]</span>\n            <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span>\n                <span class=\"n\">reconstructable_kwargs</span><span class=\"p\">,</span> <span class=\"s2\">&quot;reconstructable_kwargs&quot;</span><span class=\"p\">,</span> <span class=\"n\">key_type</span><span class=\"o\">=</span><span class=\"nb\">str</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"n\">reconstructor_pointer</span> <span class=\"o\">=</span> <span class=\"n\">ModuleCodePointer</span><span class=\"p\">(</span>\n        <span class=\"n\">reconstructor_module_name</span><span class=\"p\">,</span> <span class=\"n\">reconstructor_function_name</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"n\">pointer</span> <span class=\"o\">=</span> <span class=\"n\">CustomPointer</span><span class=\"p\">(</span><span class=\"n\">reconstructor_pointer</span><span class=\"p\">,</span> <span class=\"n\">reconstructable_args</span><span class=\"p\">,</span> <span class=\"n\">reconstructable_kwargs</span><span class=\"p\">)</span>\n\n    <span class=\"n\">pipeline_def</span> <span class=\"o\">=</span> <span class=\"n\">pipeline_def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"p\">(</span>\n        <span class=\"n\">repository</span><span class=\"o\">=</span><span class=\"n\">ReconstructableRepository</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">),</span>  <span class=\"c1\"># creates ephemeral repo</span>\n        <span class=\"n\">pipeline_name</span><span class=\"o\">=</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">bootstrap_standalone_recon_pipeline</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">):</span>\n    <span class=\"c1\"># So this actually straps the the pipeline for the sole</span>\n    <span class=\"c1\"># purpose of getting the pipeline name. If we changed ReconstructablePipeline</span>\n    <span class=\"c1\"># to get the pipeline on demand in order to get name, we could avoid this.</span>\n    <span class=\"n\">pipeline_def</span> <span class=\"o\">=</span> <span class=\"n\">pipeline_def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"p\">(</span>\n        <span class=\"n\">repository</span><span class=\"o\">=</span><span class=\"n\">ReconstructableRepository</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">),</span>  <span class=\"c1\"># creates ephemeral repo</span>\n        <span class=\"n\">pipeline_name</span><span class=\"o\">=</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_check_is_loadable</span><span class=\"p\">(</span><span class=\"n\">definition</span><span class=\"p\">):</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">.pipeline</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineDefinition</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">.repository</span> <span class=\"kn\">import</span> <span class=\"n\">RepositoryDefinition</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">definition</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">PipelineDefinition</span><span class=\"p\">,</span> <span class=\"n\">RepositoryDefinition</span><span class=\"p\">)):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Loadable attributes must be either a PipelineDefinition or a &quot;</span>\n                <span class=\"s2\">&quot;RepositoryDefinition. Got </span><span class=\"si\">{definition}</span><span class=\"s2\">.&quot;</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">definition</span><span class=\"o\">=</span><span class=\"nb\">repr</span><span class=\"p\">(</span><span class=\"n\">definition</span><span class=\"p\">))</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">definition</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">load_def_in_module</span><span class=\"p\">(</span><span class=\"n\">module_name</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">CodePointer</span><span class=\"o\">.</span><span class=\"n\">from_module</span><span class=\"p\">(</span><span class=\"n\">module_name</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">))</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">load_def_in_package</span><span class=\"p\">(</span><span class=\"n\">package_name</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">CodePointer</span><span class=\"o\">.</span><span class=\"n\">from_python_package</span><span class=\"p\">(</span><span class=\"n\">package_name</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">))</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">load_def_in_python_file</span><span class=\"p\">(</span><span class=\"n\">python_file</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">,</span> <span class=\"n\">working_directory</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">CodePointer</span><span class=\"o\">.</span><span class=\"n\">from_python_file</span><span class=\"p\">(</span><span class=\"n\">python_file</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">,</span> <span class=\"n\">working_directory</span><span class=\"p\">))</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">):</span>\n    <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">pointer</span><span class=\"o\">.</span><span class=\"n\">load_target</span><span class=\"p\">()</span>\n\n    <span class=\"kn\">from</span> <span class=\"nn\">.pipeline</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineDefinition</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">.repository</span> <span class=\"kn\">import</span> <span class=\"n\">RepositoryDefinition</span>\n\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">PipelineDefinition</span><span class=\"p\">,</span> <span class=\"n\">RepositoryDefinition</span><span class=\"p\">))</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">_check_is_loadable</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># if its a function invoke it - otherwise we are pointing to a</span>\n    <span class=\"c1\"># artifact in module scope, likely decorator output</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">seven</span><span class=\"o\">.</span><span class=\"n\">get_args</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;Error invoking function at </span><span class=\"si\">{target}</span><span class=\"s2\"> with no arguments. &quot;</span>\n            <span class=\"s2\">&quot;Reconstructable target must be callable with no arguments&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">pointer</span><span class=\"o\">.</span><span class=\"n\">describe</span><span class=\"p\">()</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">_check_is_loadable</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">())</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">pipeline_def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">):</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">.pipeline</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineDefinition</span>\n\n    <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">target</span>\n\n    <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n        <span class=\"s2\">&quot;CodePointer (</span><span class=\"si\">{str}</span><span class=\"s2\">) must resolve to a PipelineDefinition. &quot;</span>\n        <span class=\"s2\">&quot;Received a </span><span class=\"si\">{type}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"o\">=</span><span class=\"n\">pointer</span><span class=\"o\">.</span><span class=\"n\">describe</span><span class=\"p\">(),</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">))</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">repository_def_from_target_def</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">):</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">.pipeline</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineDefinition</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">.repository</span> <span class=\"kn\">import</span> <span class=\"n\">RepositoryData</span><span class=\"p\">,</span> <span class=\"n\">RepositoryDefinition</span>\n\n    <span class=\"c1\"># special case - we can wrap a single pipeline in a repository</span>\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">):</span>\n        <span class=\"c1\"># consider including pipeline name in generated repo name</span>\n        <span class=\"k\">return</span> <span class=\"n\">RepositoryDefinition</span><span class=\"p\">(</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">get_ephemeral_repository_name</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">),</span>\n            <span class=\"n\">repository_data</span><span class=\"o\">=</span><span class=\"n\">RepositoryData</span><span class=\"o\">.</span><span class=\"n\">from_list</span><span class=\"p\">([</span><span class=\"n\">target</span><span class=\"p\">]),</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">RepositoryDefinition</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">target</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">repository_def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">):</span>\n    <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">def_from_pointer</span><span class=\"p\">(</span><span class=\"n\">pointer</span><span class=\"p\">)</span>\n    <span class=\"n\">repo_def</span> <span class=\"o\">=</span> <span class=\"n\">repository_def_from_target_def</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">repo_def</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;CodePointer (</span><span class=\"si\">{str}</span><span class=\"s2\">) must resolve to a &quot;</span>\n            <span class=\"s2\">&quot;RepositoryDefinition or a PipelineDefinition. &quot;</span>\n            <span class=\"s2\">&quot;Received a </span><span class=\"si\">{type}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"o\">=</span><span class=\"n\">pointer</span><span class=\"o\">.</span><span class=\"n\">describe</span><span class=\"p\">(),</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">))</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">repo_def</span>\n</pre></div>", "current_page_name": "_modules/dagster/core/definitions/reconstructable", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}