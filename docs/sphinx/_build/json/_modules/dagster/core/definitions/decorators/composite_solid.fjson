{"parents": [{"link": "../../../../../", "title": "Module code"}], "title": "dagster.core.definitions.decorators.composite_solid", "body": "<h1>Source code for dagster.core.definitions.decorators.composite_solid</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">functools</span> <span class=\"kn\">import</span> <span class=\"n\">update_wrapper</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">..composition</span> <span class=\"kn\">import</span> <span class=\"n\">do_composition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..input</span> <span class=\"kn\">import</span> <span class=\"n\">InputDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..output</span> <span class=\"kn\">import</span> <span class=\"n\">OutputDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..solid</span> <span class=\"kn\">import</span> <span class=\"n\">CompositeSolidDefinition</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">_CompositeSolid</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">config_fn</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">input_defs</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_nullable_list_param</span><span class=\"p\">(</span><span class=\"n\">input_defs</span><span class=\"p\">,</span> <span class=\"s2\">&quot;input_defs&quot;</span><span class=\"p\">,</span> <span class=\"n\">InputDefinition</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_defs</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_nullable_list_param</span><span class=\"p\">(</span><span class=\"n\">output_defs</span><span class=\"p\">,</span> <span class=\"s2\">&quot;output&quot;</span><span class=\"p\">,</span> <span class=\"n\">OutputDefinition</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">description</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"s2\">&quot;description&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span>\n            <span class=\"n\">config_schema</span><span class=\"p\">,</span> <span class=\"s2\">&quot;config_schema&quot;</span>\n        <span class=\"p\">)</span>  <span class=\"c1\"># don&#39;t want to assign dict below if config is None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">config_schema</span> <span class=\"o\">=</span> <span class=\"n\">config_schema</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">config_fn</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_callable_param</span><span class=\"p\">(</span><span class=\"n\">config_fn</span><span class=\"p\">,</span> <span class=\"s2\">&quot;config_fn&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">callable_param</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"s2\">&quot;fn&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">fn</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n\n        <span class=\"p\">(</span>\n            <span class=\"n\">input_mappings</span><span class=\"p\">,</span>\n            <span class=\"n\">output_mappings</span><span class=\"p\">,</span>\n            <span class=\"n\">dependencies</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_defs</span><span class=\"p\">,</span>\n            <span class=\"n\">config_mapping</span><span class=\"p\">,</span>\n            <span class=\"n\">positional_inputs</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">do_composition</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;@composite_solid&quot;</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">fn</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">input_defs</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_defs</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">config_schema</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">config_fn</span><span class=\"p\">,</span>\n            <span class=\"n\">ignore_output_from_composition_fn</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">composite_def</span> <span class=\"o\">=</span> <span class=\"n\">CompositeSolidDefinition</span><span class=\"p\">(</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">input_mappings</span><span class=\"o\">=</span><span class=\"n\">input_mappings</span><span class=\"p\">,</span>\n            <span class=\"n\">output_mappings</span><span class=\"o\">=</span><span class=\"n\">output_mappings</span><span class=\"p\">,</span>\n            <span class=\"n\">dependencies</span><span class=\"o\">=</span><span class=\"n\">dependencies</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_defs</span><span class=\"o\">=</span><span class=\"n\">solid_defs</span><span class=\"p\">,</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">description</span><span class=\"p\">,</span>\n            <span class=\"n\">config_mapping</span><span class=\"o\">=</span><span class=\"n\">config_mapping</span><span class=\"p\">,</span>\n            <span class=\"n\">positional_inputs</span><span class=\"o\">=</span><span class=\"n\">positional_inputs</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">update_wrapper</span><span class=\"p\">(</span><span class=\"n\">composite_def</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">composite_def</span>\n\n\n<div class=\"viewcode-block\" id=\"composite_solid\"><a class=\"viewcode-back\" href=\"../../../../../../sections/api/apidocs/solids/#dagster.composite_solid\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">composite_solid</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">config_fn</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Create a composite solid with the specified parameters from the decorated composition</span>\n<span class=\"sd\">    function.</span>\n\n<span class=\"sd\">    Using this decorator allows you to build up the dependency graph of the composite by writing a</span>\n<span class=\"sd\">    function that invokes solids and passes the output to other solids. This is similar to the use</span>\n<span class=\"sd\">    of the :py:func:`@pipeline &lt;pipeline&gt;` decorator, with the additional ability to remap inputs,</span>\n<span class=\"sd\">    outputs, and config across the composite boundary.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (Optional[str]): Name for the new composite solid. Must be unique within any</span>\n<span class=\"sd\">            :py:class:`PipelineDefinition` using the solid.</span>\n<span class=\"sd\">        description (Optional[str]): Human-readable description of the new composite solid.</span>\n<span class=\"sd\">        input_defs (Optional[List[InputDefinition]]): Input definitions for the composite solid.</span>\n<span class=\"sd\">            If not provided explicitly, these will be inferred from typehints.</span>\n\n<span class=\"sd\">            Uses of these inputs in the body of the decorated composition function will be used to</span>\n<span class=\"sd\">            infer the appropriate set of :py:class:`InputMappings &lt;InputMapping&gt;` passed to the</span>\n<span class=\"sd\">            underlying :py:class:`CompositeSolidDefinition`.</span>\n<span class=\"sd\">        output_defs (Optional[List[OutputDefinition]]): Output definitions for the composite solid.</span>\n<span class=\"sd\">            If not provided explicitly, these will be inferred from typehints.</span>\n\n<span class=\"sd\">            Uses of these outputs in the body of the decorated composition function, as well as the</span>\n<span class=\"sd\">            return value of the decorated function, will be used to infer the appropriate set of</span>\n<span class=\"sd\">            :py:class:`OutputMappings &lt;OutputMapping&gt;` for the underlying</span>\n<span class=\"sd\">            :py:class:`CompositeSolidDefinition`.</span>\n\n<span class=\"sd\">            To map multiple outputs, return a dictionary from the composition function.</span>\n<span class=\"sd\">        config_schema (Optional[ConfigSchema]): The schema for the config. Must be combined with the</span>\n<span class=\"sd\">            `config_fn` argument in order to transform this config into the config for the contained</span>\n<span class=\"sd\">            solids.</span>\n<span class=\"sd\">        config_fn (Callable[[dict], dict]): By specifying a config mapping</span>\n<span class=\"sd\">            function, you can override the configuration for the child solids contained within this</span>\n<span class=\"sd\">            composite solid.</span>\n\n<span class=\"sd\">            Config mappings require the configuration field to be specified as ``config_schema``, which</span>\n<span class=\"sd\">            will be exposed as the configuration field for the composite solid, as well as a</span>\n<span class=\"sd\">            configuration mapping function, ``config_fn``, which maps the config provided to the</span>\n<span class=\"sd\">            composite solid to the config that will be provided to the child solids.</span>\n\n<span class=\"sd\">    Examples:</span>\n\n<span class=\"sd\">        .. code-block:: python</span>\n\n<span class=\"sd\">            @lambda_solid</span>\n<span class=\"sd\">            def add_one(num: int) -&gt; int:</span>\n<span class=\"sd\">                return num + 1</span>\n\n<span class=\"sd\">            @composite_solid</span>\n<span class=\"sd\">            def add_two(num: int) -&gt; int:</span>\n<span class=\"sd\">                adder_1 = add_one.alias(&#39;adder_1&#39;)</span>\n<span class=\"sd\">                adder_2 = add_one.alias(&#39;adder_2&#39;)</span>\n\n<span class=\"sd\">                return adder_2(adder_1(num))</span>\n\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">input_defs</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">output_defs</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">description</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">config_schema</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">config_fn</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">_CompositeSolid</span><span class=\"p\">()(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">_CompositeSolid</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n        <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"n\">input_defs</span><span class=\"p\">,</span>\n        <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"n\">output_defs</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">description</span><span class=\"p\">,</span>\n        <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">config_schema</span><span class=\"p\">,</span>\n        <span class=\"n\">config_fn</span><span class=\"o\">=</span><span class=\"n\">config_fn</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span></div>\n</pre></div>", "current_page_name": "_modules/dagster/core/definitions/decorators/composite_solid", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}