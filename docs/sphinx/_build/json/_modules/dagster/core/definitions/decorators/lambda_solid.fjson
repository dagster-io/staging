{"parents": [{"link": "../../../../../", "title": "Module code"}], "title": "dagster.core.definitions.decorators.lambda_solid", "body": "<h1>Source code for dagster.core.definitions.decorators.lambda_solid</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">functools</span> <span class=\"kn\">import</span> <span class=\"n\">update_wrapper</span><span class=\"p\">,</span> <span class=\"n\">wraps</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.types.dagster_type</span> <span class=\"kn\">import</span> <span class=\"n\">DagsterTypeKind</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">..events</span> <span class=\"kn\">import</span> <span class=\"n\">Output</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..inference</span> <span class=\"kn\">import</span> <span class=\"n\">infer_input_definitions_for_lambda_solid</span><span class=\"p\">,</span> <span class=\"n\">infer_output_definitions</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..input</span> <span class=\"kn\">import</span> <span class=\"n\">InputDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..output</span> <span class=\"kn\">import</span> <span class=\"n\">OutputDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..solid</span> <span class=\"kn\">import</span> <span class=\"n\">SolidDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.solid</span> <span class=\"kn\">import</span> <span class=\"n\">validate_solid_fn</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">_LambdaSolid</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">output_def</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">input_defs</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_nullable_list_param</span><span class=\"p\">(</span><span class=\"n\">input_defs</span><span class=\"p\">,</span> <span class=\"s2\">&quot;input_defs&quot;</span><span class=\"p\">,</span> <span class=\"n\">InputDefinition</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_def</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_inst_param</span><span class=\"p\">(</span><span class=\"n\">output_def</span><span class=\"p\">,</span> <span class=\"s2\">&quot;output_def&quot;</span><span class=\"p\">,</span> <span class=\"n\">OutputDefinition</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">description</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"s2\">&quot;description&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">callable_param</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"s2\">&quot;fn&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">fn</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n\n        <span class=\"n\">input_defs</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">input_defs</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">input_defs</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n            <span class=\"k\">else</span> <span class=\"n\">infer_input_definitions_for_lambda_solid</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">output_def</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_def</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_def</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n            <span class=\"k\">else</span> <span class=\"n\">infer_output_definitions</span><span class=\"p\">(</span><span class=\"s2\">&quot;@lambda_solid&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">positional_inputs</span> <span class=\"o\">=</span> <span class=\"n\">validate_solid_fn</span><span class=\"p\">(</span><span class=\"s2\">&quot;@lambda_solid&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"n\">input_defs</span><span class=\"p\">)</span>\n        <span class=\"n\">compute_fn</span> <span class=\"o\">=</span> <span class=\"n\">_create_lambda_solid_compute_wrapper</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"n\">input_defs</span><span class=\"p\">,</span> <span class=\"n\">output_def</span><span class=\"p\">)</span>\n\n        <span class=\"n\">solid_def</span> <span class=\"o\">=</span> <span class=\"n\">SolidDefinition</span><span class=\"p\">(</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"n\">input_defs</span><span class=\"p\">,</span>\n            <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">output_def</span><span class=\"p\">],</span>\n            <span class=\"n\">compute_fn</span><span class=\"o\">=</span><span class=\"n\">compute_fn</span><span class=\"p\">,</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">description</span><span class=\"p\">,</span>\n            <span class=\"n\">positional_inputs</span><span class=\"o\">=</span><span class=\"n\">positional_inputs</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">update_wrapper</span><span class=\"p\">(</span><span class=\"n\">solid_def</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">solid_def</span>\n\n\n<div class=\"viewcode-block\" id=\"lambda_solid\"><a class=\"viewcode-back\" href=\"../../../../../../sections/api/apidocs/solids/#dagster.lambda_solid\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">lambda_solid</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">output_def</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Create a simple solid from the decorated function.</span>\n\n<span class=\"sd\">    This shortcut allows the creation of simple solids that do not require</span>\n<span class=\"sd\">    configuration and whose implementations do not require a</span>\n<span class=\"sd\">    :py:class:`context &lt;SystemComputeExecutionContext&gt;`.</span>\n\n<span class=\"sd\">    Lambda solids take any number of inputs and produce a single output.</span>\n\n<span class=\"sd\">    Inputs can be defined using :class:`InputDefinition` and passed to the ``input_defs`` argument</span>\n<span class=\"sd\">    of this decorator, or inferred from the type signature of the decorated function.</span>\n\n<span class=\"sd\">    The single output can be defined using :class:`OutputDefinition` and passed as the</span>\n<span class=\"sd\">    ``output_def`` argument of this decorator, or its type can be inferred from the type signature</span>\n<span class=\"sd\">    of the decorated function.</span>\n\n<span class=\"sd\">    The body of the decorated function should return a single value, which will be yielded as the</span>\n<span class=\"sd\">    solid&#39;s output.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (str): Name of solid.</span>\n<span class=\"sd\">        description (str): Solid description.</span>\n<span class=\"sd\">        input_defs (List[InputDefinition]): List of input_defs.</span>\n<span class=\"sd\">        output_def (OutputDefinition): The output of the solid. Defaults to</span>\n<span class=\"sd\">            :class:`OutputDefinition() &lt;OutputDefinition&gt;`.</span>\n\n<span class=\"sd\">    Examples:</span>\n\n<span class=\"sd\">    .. code-block:: python</span>\n\n<span class=\"sd\">        @lambda_solid</span>\n<span class=\"sd\">        def hello_world():</span>\n<span class=\"sd\">            return &#39;hello&#39;</span>\n\n<span class=\"sd\">        @lambda_solid(</span>\n<span class=\"sd\">            input_defs=[InputDefinition(name=&#39;foo&#39;, str)],</span>\n<span class=\"sd\">            output_def=OutputDefinition(str)</span>\n<span class=\"sd\">        )</span>\n<span class=\"sd\">        def hello_world(foo):</span>\n<span class=\"sd\">            # explicitly type and name inputs and outputs</span>\n<span class=\"sd\">            return foo</span>\n\n<span class=\"sd\">        @lambda_solid</span>\n<span class=\"sd\">        def hello_world(foo: str) -&gt; str:</span>\n<span class=\"sd\">            # same as above inferred from signature</span>\n<span class=\"sd\">            return foo</span>\n\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">input_defs</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">description</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">_LambdaSolid</span><span class=\"p\">(</span><span class=\"n\">output_def</span><span class=\"o\">=</span><span class=\"n\">output_def</span><span class=\"p\">)(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">_LambdaSolid</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"n\">input_defs</span><span class=\"p\">,</span> <span class=\"n\">output_def</span><span class=\"o\">=</span><span class=\"n\">output_def</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">description</span>\n    <span class=\"p\">)</span></div>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_create_lambda_solid_compute_wrapper</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"n\">input_defs</span><span class=\"p\">,</span> <span class=\"n\">output_def</span><span class=\"p\">):</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">callable_param</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"s2\">&quot;fn&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">list_param</span><span class=\"p\">(</span><span class=\"n\">input_defs</span><span class=\"p\">,</span> <span class=\"s2\">&quot;input_defs&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"n\">InputDefinition</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">output_def</span><span class=\"p\">,</span> <span class=\"s2\">&quot;output_def&quot;</span><span class=\"p\">,</span> <span class=\"n\">OutputDefinition</span><span class=\"p\">)</span>\n\n    <span class=\"n\">input_names</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n        <span class=\"n\">input_def</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"k\">for</span> <span class=\"n\">input_def</span> <span class=\"ow\">in</span> <span class=\"n\">input_defs</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">input_def</span><span class=\"o\">.</span><span class=\"n\">dagster_type</span><span class=\"o\">.</span><span class=\"n\">kind</span> <span class=\"o\">==</span> <span class=\"n\">DagsterTypeKind</span><span class=\"o\">.</span><span class=\"n\">NOTHING</span>\n    <span class=\"p\">]</span>\n\n    <span class=\"nd\">@wraps</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">compute</span><span class=\"p\">(</span><span class=\"n\">_context</span><span class=\"p\">,</span> <span class=\"n\">input_defs</span><span class=\"p\">):</span>\n        <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n        <span class=\"k\">for</span> <span class=\"n\">input_name</span> <span class=\"ow\">in</span> <span class=\"n\">input_names</span><span class=\"p\">:</span>\n            <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"n\">input_name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">input_defs</span><span class=\"p\">[</span><span class=\"n\">input_name</span><span class=\"p\">]</span>\n\n        <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">fn</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n        <span class=\"k\">yield</span> <span class=\"n\">Output</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">result</span><span class=\"p\">,</span> <span class=\"n\">output_name</span><span class=\"o\">=</span><span class=\"n\">output_def</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">compute</span>\n</pre></div>", "current_page_name": "_modules/dagster/core/definitions/decorators/lambda_solid", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}