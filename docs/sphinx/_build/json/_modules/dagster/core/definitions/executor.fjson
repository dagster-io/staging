{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "dagster.core.definitions.executor", "body": "<h1>Source code for dagster.core.definitions.executor</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">functools</span> <span class=\"kn\">import</span> <span class=\"n\">update_wrapper</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.builtins</span> <span class=\"kn\">import</span> <span class=\"n\">Int</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.config.field</span> <span class=\"kn\">import</span> <span class=\"n\">Field</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.config.field_utils</span> <span class=\"kn\">import</span> <span class=\"n\">check_user_facing_opt_config_param</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions.config_mappable</span> <span class=\"kn\">import</span> <span class=\"n\">ConfiguredMixin</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions.reconstructable</span> <span class=\"kn\">import</span> <span class=\"n\">ReconstructablePipeline</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.errors</span> <span class=\"kn\">import</span> <span class=\"n\">DagsterUnmetExecutorRequirementsError</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.execution.retries</span> <span class=\"kn\">import</span> <span class=\"n\">Retries</span><span class=\"p\">,</span> <span class=\"n\">get_retries_config</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.backcompat</span> <span class=\"kn\">import</span> <span class=\"n\">rename_warning</span>\n\n\n<div class=\"viewcode-block\" id=\"ExecutorDefinition\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.ExecutorDefinition\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ExecutorDefinition</span><span class=\"p\">(</span><span class=\"n\">ConfiguredMixin</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (Optional[str]): The name of the executor.</span>\n<span class=\"sd\">        config_schema (Optional[ConfigSchema]): The schema for the config. Configuration data</span>\n<span class=\"sd\">            available in `init_context.executor_config`.</span>\n<span class=\"sd\">        executor_creation_fn(Optional[Callable]): Should accept an :py:class:`InitExecutorContext`</span>\n<span class=\"sd\">            and return an instance of :py:class:`Executor`</span>\n<span class=\"sd\">        required_resource_keys (Optional[Set[str]]): Keys for the resources required by the</span>\n<span class=\"sd\">            executor.</span>\n<span class=\"sd\">        _configured_config_mapping_fn: This argument is for internal use only. Users should not</span>\n<span class=\"sd\">            specify this field. To preconfigure a resource, use the :py:func:`configured` API.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">name</span><span class=\"p\">,</span>\n        <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">executor_creation_fn</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">_configured_config_mapping_fn</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_name</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_config_schema</span> <span class=\"o\">=</span> <span class=\"n\">check_user_facing_opt_config_param</span><span class=\"p\">(</span><span class=\"n\">config_schema</span><span class=\"p\">,</span> <span class=\"s2\">&quot;config_schema&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_executor_creation_fn</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_callable_param</span><span class=\"p\">(</span>\n            <span class=\"n\">executor_creation_fn</span><span class=\"p\">,</span> <span class=\"s2\">&quot;executor_creation_fn&quot;</span>\n        <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_required_resource_keys</span> <span class=\"o\">=</span> <span class=\"nb\">frozenset</span><span class=\"p\">(</span>\n            <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_set_param</span><span class=\"p\">(</span><span class=\"n\">required_resource_keys</span><span class=\"p\">,</span> <span class=\"s2\">&quot;required_resource_keys&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_description</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"s2\">&quot;description&quot;</span><span class=\"p\">)</span>\n        <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">ExecutorDefinition</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">_configured_config_mapping_fn</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">name</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_name</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">description</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_description</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">config_field</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">rename_warning</span><span class=\"p\">(</span><span class=\"s2\">&quot;config_schema&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;config_field&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;0.9.0&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_config_schema</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">config_schema</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_config_schema</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">executor_creation_fn</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_executor_creation_fn</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">required_resource_keys</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_required_resource_keys</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">copy_for_configured</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"n\">wrapped_config_mapping_fn</span><span class=\"p\">,</span> <span class=\"n\">config_schema</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">ExecutorDefinition</span><span class=\"p\">(</span>\n            <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">config_schema</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">executor_creation_fn</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">executor_creation_fn</span><span class=\"p\">,</span>\n            <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">required_resource_keys</span><span class=\"p\">,</span>\n            <span class=\"n\">_configured_config_mapping_fn</span><span class=\"o\">=</span><span class=\"n\">wrapped_config_mapping_fn</span><span class=\"p\">,</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">description</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">description</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"executor\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/internals/#dagster.executor\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">executor</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Define an executor.</span>\n\n<span class=\"sd\">    The decorated function should accept an :py:class:`InitExecutorContext` and return an instance</span>\n<span class=\"sd\">    of :py:class:`Executor`.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (Optional[str]): The name of the executor.</span>\n<span class=\"sd\">        config_schema (Optional[ConfigSchema]): The schema for the config. Configuration data available in</span>\n<span class=\"sd\">            `init_context.executor_config`.</span>\n<span class=\"sd\">        required_resource_keys (Optional[Set[str]]): Keys for the resources required by the</span>\n<span class=\"sd\">            executor.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">config_schema</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span><span class=\"n\">required_resource_keys</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">_ExecutorDecoratorCallable</span><span class=\"p\">()(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">_ExecutorDecoratorCallable</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">config_schema</span><span class=\"p\">,</span> <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"n\">required_resource_keys</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span></div>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">_ExecutorDecoratorCallable</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">config_schema</span> <span class=\"o\">=</span> <span class=\"n\">config_schema</span>  <span class=\"c1\"># type check in definition</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">required_resource_keys</span> <span class=\"o\">=</span> <span class=\"n\">required_resource_keys</span>  <span class=\"c1\"># type check in definition</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fn</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">callable_param</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"s2\">&quot;fn&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">fn</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n\n        <span class=\"n\">executor_def</span> <span class=\"o\">=</span> <span class=\"n\">ExecutorDefinition</span><span class=\"p\">(</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">config_schema</span><span class=\"p\">,</span>\n            <span class=\"n\">executor_creation_fn</span><span class=\"o\">=</span><span class=\"n\">fn</span><span class=\"p\">,</span>\n            <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">required_resource_keys</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">update_wrapper</span><span class=\"p\">(</span><span class=\"n\">executor_def</span><span class=\"p\">,</span> <span class=\"n\">wrapped</span><span class=\"o\">=</span><span class=\"n\">fn</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">executor_def</span>\n\n\n<div class=\"viewcode-block\" id=\"in_process_executor\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/execution/#dagster.in_process_executor\">[docs]</a><span class=\"nd\">@executor</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;in_process&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"p\">{</span>\n        <span class=\"s2\">&quot;retries&quot;</span><span class=\"p\">:</span> <span class=\"n\">get_retries_config</span><span class=\"p\">(),</span>\n        <span class=\"s2\">&quot;marker_to_close&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n    <span class=\"p\">},</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">in_process_executor</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;The default in-process executor.</span>\n\n<span class=\"sd\">    In most Dagster environments, this will be the default executor. It is available by default on</span>\n<span class=\"sd\">    any :py:class:`ModeDefinition` that does not provide custom executors. To select it explicitly,</span>\n<span class=\"sd\">    include the following top-level fragment in config:</span>\n\n<span class=\"sd\">    .. code-block:: yaml</span>\n\n<span class=\"sd\">        execution:</span>\n<span class=\"sd\">          in_process:</span>\n\n<span class=\"sd\">    Execution priority can be configured using the ``dagster/priority`` tag via solid metadata,</span>\n<span class=\"sd\">    where the higher the number the higher the priority. 0 is the default and both positive</span>\n<span class=\"sd\">    and negative numbers can be used.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.executor.init</span> <span class=\"kn\">import</span> <span class=\"n\">InitExecutorContext</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.executor.in_process</span> <span class=\"kn\">import</span> <span class=\"n\">InProcessExecutor</span>\n\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">,</span> <span class=\"s2\">&quot;init_context&quot;</span><span class=\"p\">,</span> <span class=\"n\">InitExecutorContext</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">InProcessExecutor</span><span class=\"p\">(</span>\n        <span class=\"c1\"># shouldn&#39;t need to .get() here - issue with defaults in config setup</span>\n        <span class=\"n\">retries</span><span class=\"o\">=</span><span class=\"n\">Retries</span><span class=\"o\">.</span><span class=\"n\">from_config</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">executor_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;retries&quot;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&quot;enabled&quot;</span><span class=\"p\">:</span> <span class=\"p\">{}})),</span>\n        <span class=\"n\">marker_to_close</span><span class=\"o\">=</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">executor_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;marker_to_close&quot;</span><span class=\"p\">),</span>\n    <span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"multiprocess_executor\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/execution/#dagster.multiprocess_executor\">[docs]</a><span class=\"nd\">@executor</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;multiprocess&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"p\">{</span>\n        <span class=\"s2\">&quot;max_concurrent&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">Int</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">),</span>\n        <span class=\"s2\">&quot;retries&quot;</span><span class=\"p\">:</span> <span class=\"n\">get_retries_config</span><span class=\"p\">(),</span>\n    <span class=\"p\">},</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">multiprocess_executor</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;The default multiprocess executor.</span>\n\n<span class=\"sd\">    This simple multiprocess executor is available by default on any :py:class:`ModeDefinition`</span>\n<span class=\"sd\">    that does not provide custom executors. To select the multiprocess executor, include a fragment</span>\n<span class=\"sd\">    such as the following in your config:</span>\n\n<span class=\"sd\">    .. code-block:: yaml</span>\n\n<span class=\"sd\">        execution:</span>\n<span class=\"sd\">          multiprocess:</span>\n<span class=\"sd\">            config:</span>\n<span class=\"sd\">              max_concurrent: 4</span>\n\n<span class=\"sd\">    The ``max_concurrent`` arg is optional and tells the execution engine how many processes may run</span>\n<span class=\"sd\">    concurrently. By default, or if you set ``max_concurrent`` to be 0, this is the return value of</span>\n<span class=\"sd\">    :py:func:`python:multiprocessing.cpu_count`.</span>\n\n<span class=\"sd\">    Execution priority can be configured using the ``dagster/priority`` tag via solid metadata,</span>\n<span class=\"sd\">    where the higher the number the higher the priority. 0 is the default and both positive</span>\n<span class=\"sd\">    and negative numbers can be used.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.executor.init</span> <span class=\"kn\">import</span> <span class=\"n\">InitExecutorContext</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.executor.multiprocess</span> <span class=\"kn\">import</span> <span class=\"n\">MultiprocessExecutor</span>\n\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">,</span> <span class=\"s2\">&quot;init_context&quot;</span><span class=\"p\">,</span> <span class=\"n\">InitExecutorContext</span><span class=\"p\">)</span>\n\n    <span class=\"n\">check_cross_process_constraints</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">MultiprocessExecutor</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"o\">=</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">pipeline</span><span class=\"p\">,</span>\n        <span class=\"n\">max_concurrent</span><span class=\"o\">=</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">executor_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;max_concurrent&quot;</span><span class=\"p\">],</span>\n        <span class=\"n\">retries</span><span class=\"o\">=</span><span class=\"n\">Retries</span><span class=\"o\">.</span><span class=\"n\">from_config</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">executor_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;retries&quot;</span><span class=\"p\">]),</span>\n    <span class=\"p\">)</span></div>\n\n\n<span class=\"n\">default_executors</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">in_process_executor</span><span class=\"p\">,</span> <span class=\"n\">multiprocess_executor</span><span class=\"p\">]</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">check_cross_process_constraints</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">):</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.executor.init</span> <span class=\"kn\">import</span> <span class=\"n\">InitExecutorContext</span>\n\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">,</span> <span class=\"s2\">&quot;init_context&quot;</span><span class=\"p\">,</span> <span class=\"n\">InitExecutorContext</span><span class=\"p\">)</span>\n\n    <span class=\"n\">_check_intra_process_pipeline</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">pipeline</span><span class=\"p\">)</span>\n    <span class=\"n\">_check_non_ephemeral_instance</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n    <span class=\"n\">_check_persistent_storage_requirement</span><span class=\"p\">(</span>\n        <span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">intermediate_storage_def</span><span class=\"p\">,</span> <span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">system_storage_def</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_check_intra_process_pipeline</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">ReconstructablePipeline</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterUnmetExecutorRequirementsError</span><span class=\"p\">(</span>\n            <span class=\"s1\">&#39;You have attempted to use an executor that uses multiple processes with the pipeline &quot;</span><span class=\"si\">{name}</span><span class=\"s1\">&quot; &#39;</span>\n            <span class=\"s2\">&quot;that is not reconstructable. Pipelines must be loaded in a way that allows dagster to reconstruct &quot;</span>\n            <span class=\"s2\">&quot;them in a new process. This means: </span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n            <span class=\"s2\">&quot;  * using the file, module, or repository.yaml arguments of dagit/dagster-graphql/dagster</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span>\n            <span class=\"s2\">&quot;  * loading the pipeline through the reconstructable() function</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">name</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_check_persistent_storage_requirement</span><span class=\"p\">(</span><span class=\"n\">intermediate_storage_def</span><span class=\"p\">,</span> <span class=\"n\">system_storage_def</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">intermediate_storage_def</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">intermediate_storage_def</span><span class=\"o\">.</span><span class=\"n\">is_persistent</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">DagsterUnmetExecutorRequirementsError</span><span class=\"p\">(</span>\n                <span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;You have attempted to use an executor that uses multiple processes while using &quot;</span>\n                    <span class=\"s2\">&quot;intermediate storage </span><span class=\"si\">{storage_name}</span><span class=\"s2\"> which does not persist intermediates. &quot;</span>\n                    <span class=\"s2\">&quot;This means there would be no way to move data between different &quot;</span>\n                    <span class=\"s2\">&quot;processes. Please configure your pipeline in the storage config &quot;</span>\n                    <span class=\"s2\">&quot;section to use persistent system storage such as the filesystem.&quot;</span>\n                <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">storage_name</span><span class=\"o\">=</span><span class=\"n\">intermediate_storage_def</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"ow\">not</span> <span class=\"n\">system_storage_def</span><span class=\"o\">.</span><span class=\"n\">is_persistent</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterUnmetExecutorRequirementsError</span><span class=\"p\">(</span>\n            <span class=\"p\">(</span>\n                <span class=\"s2\">&quot;You have attempted to use an executor that uses multiple processes while using system &quot;</span>\n                <span class=\"s2\">&quot;storage </span><span class=\"si\">{storage_name}</span><span class=\"s2\"> which does not persist intermediates. &quot;</span>\n                <span class=\"s2\">&quot;This means there would be no way to move data between different &quot;</span>\n                <span class=\"s2\">&quot;processes. Please configure your pipeline in the storage config &quot;</span>\n                <span class=\"s2\">&quot;section to use persistent system storage such as the filesystem.&quot;</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">storage_name</span><span class=\"o\">=</span><span class=\"n\">system_storage_def</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_check_non_ephemeral_instance</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">is_ephemeral</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterUnmetExecutorRequirementsError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;You have attempted to use an executor that uses multiple processes with an &quot;</span>\n            <span class=\"s2\">&quot;ephemeral DagsterInstance. A non-ephemeral instance is needed to coordinate &quot;</span>\n            <span class=\"s2\">&quot;execution between multiple processes. You can configure your default instance &quot;</span>\n            <span class=\"s2\">&quot;via $DAGSTER_HOME or ensure a valid one is passed when invoking the python APIs.&quot;</span>\n        <span class=\"p\">)</span>\n</pre></div>", "current_page_name": "_modules/dagster/core/definitions/executor", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}