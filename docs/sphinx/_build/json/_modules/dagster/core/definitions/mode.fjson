{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "dagster.core.definitions.mode", "body": "<h1>Source code for dagster.core.definitions.mode</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">warnings</span>\n<span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions.executor</span> <span class=\"kn\">import</span> <span class=\"n\">ExecutorDefinition</span><span class=\"p\">,</span> <span class=\"n\">default_executors</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.loggers</span> <span class=\"kn\">import</span> <span class=\"n\">default_loggers</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.merger</span> <span class=\"kn\">import</span> <span class=\"n\">merge_dicts</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.logger</span> <span class=\"kn\">import</span> <span class=\"n\">LoggerDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.resource</span> <span class=\"kn\">import</span> <span class=\"n\">ResourceDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.utils</span> <span class=\"kn\">import</span> <span class=\"n\">check_valid_name</span>\n\n<span class=\"n\">DEFAULT_MODE_NAME</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;default&quot;</span>\n\n\n<div class=\"viewcode-block\" id=\"ModeDefinition\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/modes-resources/#dagster.ModeDefinition\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ModeDefinition</span><span class=\"p\">(</span>\n    <span class=\"n\">namedtuple</span><span class=\"p\">(</span>\n        <span class=\"s2\">&quot;_ModeDefinition&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;name resource_defs loggers system_storage_defs executor_defs description intermediate_storage_defs&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Define a mode in which a pipeline can operate.</span>\n\n<span class=\"sd\">    A mode provides pipelines with a set of resource implementations, loggers, system storages,</span>\n<span class=\"sd\">    and executors.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (Optional[str]): The name of the mode. Must be unique within the</span>\n<span class=\"sd\">            :py:class:`PipelineDefinition` to which the mode is attached. (default: &quot;default&quot;).</span>\n<span class=\"sd\">        resource_defs (Optional[Dict[str, ResourceDefinition]]): A dictionary of string resource</span>\n<span class=\"sd\">            keys to their implementations. Individual solids may require resources to be present by</span>\n<span class=\"sd\">            these keys.</span>\n<span class=\"sd\">        logger_defs (Optional[Dict[str, LoggerDefinition]]): A dictionary of string logger</span>\n<span class=\"sd\">            identifiers to their implementations.</span>\n<span class=\"sd\">        system_storage_defs (Optional[List[SystemStorageDefinition]]): The set of system storage</span>\n<span class=\"sd\">            options available when executing in this mode. By default, this will be the &#39;in_memory&#39;</span>\n<span class=\"sd\">            and &#39;filesystem&#39; system storages.</span>\n<span class=\"sd\">        executor_defs (Optional[List[ExecutorDefinition]]): The set of executors available when</span>\n<span class=\"sd\">            executing in this mode. By default, this will be the &#39;in_process&#39; and &#39;multiprocess&#39;</span>\n<span class=\"sd\">            executors (:py:data:`~dagster.default_executors`).</span>\n<span class=\"sd\">        description (Optional[str]): A human-readable description of the mode.</span>\n<span class=\"sd\">        intermediate_storage_defs (Optional[List[IntermediateStorageDefinition]]): The set of intermediate storage</span>\n<span class=\"sd\">            options available when executing in this mode. By default, this will be the &#39;in_memory&#39;</span>\n<span class=\"sd\">            and &#39;filesystem&#39; system storages.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__new__</span><span class=\"p\">(</span>\n        <span class=\"bp\">cls</span><span class=\"p\">,</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">resource_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">logger_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">system_storage_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">executor_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">intermediate_storage_defs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.storage.system_storage</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n            <span class=\"n\">default_system_storage_defs</span><span class=\"p\">,</span>\n            <span class=\"n\">default_intermediate_storage_defs</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"kn\">from</span> <span class=\"nn\">.system_storage</span> <span class=\"kn\">import</span> <span class=\"n\">SystemStorageDefinition</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">.intermediate_storage</span> <span class=\"kn\">import</span> <span class=\"n\">IntermediateStorageDefinition</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">system_storage_defs</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"n\">intermediate_storage_defs</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">warnings</span><span class=\"o\">.</span><span class=\"n\">warn</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;system_storage_defs are deprecated and will be removed in 0.10.0 &quot;</span>\n                <span class=\"s2\">&quot;and should be replaced with &quot;</span>\n                <span class=\"s2\">&quot;intermediate_storage_defs for intermediates and resource_defs for files&quot;</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span>\n            <span class=\"n\">resource_defs</span><span class=\"p\">,</span> <span class=\"s2\">&quot;resource_defs&quot;</span><span class=\"p\">,</span> <span class=\"n\">key_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">value_type</span><span class=\"o\">=</span><span class=\"n\">ResourceDefinition</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">resource_defs</span> <span class=\"ow\">and</span> <span class=\"s2\">&quot;asset_store&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">resource_defs</span><span class=\"p\">:</span>\n            <span class=\"n\">resource_defs_with_defaults</span> <span class=\"o\">=</span> <span class=\"n\">resource_defs</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"kn\">from</span> <span class=\"nn\">dagster.core.storage.asset_store</span> <span class=\"kn\">import</span> <span class=\"n\">mem_asset_store</span>\n\n            <span class=\"n\">resource_defs_with_defaults</span> <span class=\"o\">=</span> <span class=\"n\">merge_dicts</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;asset_store&quot;</span><span class=\"p\">:</span> <span class=\"n\">mem_asset_store</span><span class=\"p\">},</span> <span class=\"n\">resource_defs</span> <span class=\"ow\">or</span> <span class=\"p\">{}</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">ModeDefinition</span><span class=\"p\">,</span> <span class=\"bp\">cls</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__new__</span><span class=\"p\">(</span>\n            <span class=\"bp\">cls</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">check_valid_name</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"k\">else</span> <span class=\"n\">DEFAULT_MODE_NAME</span><span class=\"p\">,</span>\n            <span class=\"n\">resource_defs</span><span class=\"o\">=</span><span class=\"n\">resource_defs_with_defaults</span><span class=\"p\">,</span>\n            <span class=\"n\">loggers</span><span class=\"o\">=</span><span class=\"p\">(</span>\n                <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span>\n                    <span class=\"n\">logger_defs</span><span class=\"p\">,</span> <span class=\"s2\">&quot;logger_defs&quot;</span><span class=\"p\">,</span> <span class=\"n\">key_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">value_type</span><span class=\"o\">=</span><span class=\"n\">LoggerDefinition</span>\n                <span class=\"p\">)</span>\n                <span class=\"ow\">or</span> <span class=\"n\">default_loggers</span><span class=\"p\">()</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">system_storage_defs</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">list_param</span><span class=\"p\">(</span>\n                <span class=\"n\">system_storage_defs</span> <span class=\"k\">if</span> <span class=\"n\">system_storage_defs</span> <span class=\"k\">else</span> <span class=\"n\">default_system_storage_defs</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;system_storage_defs&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"n\">SystemStorageDefinition</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">intermediate_storage_defs</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">list_param</span><span class=\"p\">(</span>\n                <span class=\"n\">intermediate_storage_defs</span>\n                <span class=\"k\">if</span> <span class=\"n\">intermediate_storage_defs</span>\n                <span class=\"k\">else</span> <span class=\"n\">default_intermediate_storage_defs</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;intermediate_storage_defs&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"n\">IntermediateStorageDefinition</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">executor_defs</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">list_param</span><span class=\"p\">(</span>\n                <span class=\"n\">executor_defs</span> <span class=\"k\">if</span> <span class=\"n\">executor_defs</span> <span class=\"k\">else</span> <span class=\"n\">default_executors</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;executor_defs&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"n\">ExecutorDefinition</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"s2\">&quot;description&quot;</span><span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">resource_key_set</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">frozenset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">resource_defs</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">())</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_system_storage_def</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">system_storage_def</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">system_storage_defs</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">system_storage_def</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"n\">name</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">system_storage_def</span>\n\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">failed</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\"> storage definition not found&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_intermediate_storage_def</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">intermediate_storage_def</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">intermediate_storage_defs</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">intermediate_storage_def</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"n\">name</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">intermediate_storage_def</span>\n\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">failed</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\"> storage definition not found&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">))</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">from_resources</span><span class=\"p\">(</span><span class=\"n\">resources</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">dict_param</span><span class=\"p\">(</span><span class=\"n\">resources</span><span class=\"p\">,</span> <span class=\"s2\">&quot;resources&quot;</span><span class=\"p\">,</span> <span class=\"n\">key_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">ModeDefinition</span><span class=\"p\">(</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">resource_defs</span><span class=\"o\">=</span><span class=\"p\">{</span>\n                <span class=\"n\">resource_name</span><span class=\"p\">:</span> <span class=\"n\">ResourceDefinition</span><span class=\"o\">.</span><span class=\"n\">hardcoded_resource</span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"p\">)</span>\n                <span class=\"k\">for</span> <span class=\"n\">resource_name</span><span class=\"p\">,</span> <span class=\"n\">resource</span> <span class=\"ow\">in</span> <span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n            <span class=\"p\">},</span>\n        <span class=\"p\">)</span></div>\n</pre></div>", "current_page_name": "_modules/dagster/core/definitions/mode", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}