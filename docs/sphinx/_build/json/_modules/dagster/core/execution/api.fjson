{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "dagster.core.execution.api", "body": "<h1>Source code for dagster.core.execution.api</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n<span class=\"kn\">from</span> <span class=\"nn\">contextlib</span> <span class=\"kn\">import</span> <span class=\"n\">contextmanager</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions</span> <span class=\"kn\">import</span> <span class=\"n\">IPipeline</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">,</span> <span class=\"n\">SystemStorageData</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions.pipeline</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineSubsetDefinition</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.definitions.pipeline_base</span> <span class=\"kn\">import</span> <span class=\"n\">InMemoryPipeline</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.errors</span> <span class=\"kn\">import</span> <span class=\"n\">DagsterInvariantViolationError</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.events</span> <span class=\"kn\">import</span> <span class=\"n\">DagsterEvent</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.execution.context.system</span> <span class=\"kn\">import</span> <span class=\"n\">SystemPipelineExecutionContext</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.execution.plan.execute_plan</span> <span class=\"kn\">import</span> <span class=\"n\">inner_plan_execution_iterator</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.execution.plan.plan</span> <span class=\"kn\">import</span> <span class=\"n\">ExecutionPlan</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.execution.retries</span> <span class=\"kn\">import</span> <span class=\"n\">Retries</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.instance</span> <span class=\"kn\">import</span> <span class=\"n\">DagsterInstance</span><span class=\"p\">,</span> <span class=\"n\">is_memoized_run</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.selector</span> <span class=\"kn\">import</span> <span class=\"n\">parse_step_selection</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.storage.pipeline_run</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineRun</span><span class=\"p\">,</span> <span class=\"n\">PipelineRunStatus</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.system_config.objects</span> <span class=\"kn\">import</span> <span class=\"n\">EnvironmentConfig</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.telemetry</span> <span class=\"kn\">import</span> <span class=\"n\">log_repo_stats</span><span class=\"p\">,</span> <span class=\"n\">telemetry_wrapper</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.core.utils</span> <span class=\"kn\">import</span> <span class=\"n\">str_format_set</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils</span> <span class=\"kn\">import</span> <span class=\"n\">delay_interrupts</span><span class=\"p\">,</span> <span class=\"n\">merge_dicts</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.backcompat</span> <span class=\"kn\">import</span> <span class=\"n\">canonicalize_backcompat_args</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.error</span> <span class=\"kn\">import</span> <span class=\"n\">serializable_error_info_from_exc_info</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.context_creation_pipeline</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">ExecutionContextManager</span><span class=\"p\">,</span>\n    <span class=\"n\">PipelineExecutionContextManager</span><span class=\"p\">,</span>\n    <span class=\"n\">PlanExecutionContextManager</span><span class=\"p\">,</span>\n    <span class=\"n\">scoped_pipeline_context</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.results</span> <span class=\"kn\">import</span> <span class=\"n\">PipelineExecutionResult</span>\n\n<span class=\"c1\">## Brief guide to the execution APIs</span>\n<span class=\"c1\"># | function name               | operates over      | sync  | supports    | creates new PipelineRun |</span>\n<span class=\"c1\"># |                             |                    |       | reexecution | in instance             |</span>\n<span class=\"c1\"># | --------------------------- | ------------------ | ----- | ----------- | ----------------------- |</span>\n<span class=\"c1\"># | execute_pipeline_iterator   | IPipeline | async | no          | yes                     |</span>\n<span class=\"c1\"># | execute_pipeline            | IPipeline | sync  | no          | yes                     |</span>\n<span class=\"c1\"># | execute_run_iterator        | PipelineRun        | async | (1)         | no                      |</span>\n<span class=\"c1\"># | execute_run                 | PipelineRun        | sync  | (1)         | no                      |</span>\n<span class=\"c1\"># | execute_plan_iterator       | ExecutionPlan      | async | (2)         | no                      |</span>\n<span class=\"c1\"># | execute_plan                | ExecutionPlan      | sync  | (2)         | no                      |</span>\n<span class=\"c1\"># | reexecute_pipeline          | IPipeline | sync  | yes         | yes                     |</span>\n<span class=\"c1\"># | reexecute_pipeline_iterator | IPipeline | async | yes         | yes                     |</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># Notes on reexecution support:</span>\n<span class=\"c1\"># (1) The appropriate bits must be set on the PipelineRun passed to this function. Specifically,</span>\n<span class=\"c1\">#     parent_run_id and root_run_id must be set and consistent, and if a solids_to_execute or</span>\n<span class=\"c1\">#     step_keys_to_execute are set they must be consistent with the parent and root runs.</span>\n<span class=\"c1\"># (2) As for (1), but the ExecutionPlan passed must also agree in all relevant bits.</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">execute_run_iterator</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">):</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline&quot;</span><span class=\"p\">,</span> <span class=\"n\">IPipeline</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_run&quot;</span><span class=\"p\">,</span> <span class=\"n\">PipelineRun</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">,</span> <span class=\"n\">DagsterInstance</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">status</span> <span class=\"o\">==</span> <span class=\"n\">PipelineRunStatus</span><span class=\"o\">.</span><span class=\"n\">NOT_STARTED</span><span class=\"p\">,</span>\n        <span class=\"n\">desc</span><span class=\"o\">=</span><span class=\"s2\">&quot;Pipeline run </span><span class=\"si\">{}</span><span class=\"s2\"> (</span><span class=\"si\">{}</span><span class=\"s2\">) in state </span><span class=\"si\">{}</span><span class=\"s2\">, expected PipelineRunStatus.NOT_STARTED&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">pipeline_name</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_id</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">status</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">:</span>\n        <span class=\"n\">pipeline_def</span> <span class=\"o\">=</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">pipeline_def</span><span class=\"p\">,</span> <span class=\"n\">PipelineSubsetDefinition</span><span class=\"p\">):</span>\n            <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n                <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span> <span class=\"o\">==</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;Cannot execute PipelineRun with solids_to_execute </span><span class=\"si\">{solids_to_execute}</span><span class=\"s2\"> that conflicts &quot;</span>\n                <span class=\"s2\">&quot;with pipeline subset </span><span class=\"si\">{pipeline_solids_to_execute}</span><span class=\"s2\">.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">pipeline_solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">str_format_set</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">),</span>\n                    <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">str_format_set</span><span class=\"p\">(</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">),</span>\n                <span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"c1\"># when `execute_run_iterator` is directly called, the sub pipeline hasn&#39;t been created</span>\n            <span class=\"c1\"># note that when we receive the solids to execute via PipelineRun, it won&#39;t support</span>\n            <span class=\"c1\"># solid selection query syntax</span>\n            <span class=\"n\">pipeline</span> <span class=\"o\">=</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">subset_for_execution_from_existing_pipeline</span><span class=\"p\">(</span>\n                <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span>\n            <span class=\"p\">)</span>\n    <span class=\"n\">execution_plan</span> <span class=\"o\">=</span> <span class=\"n\">create_execution_plan</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n        <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n        <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n        <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">step_keys_to_execute</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"nb\">iter</span><span class=\"p\">(</span>\n        <span class=\"n\">_ExecuteRunWithPlanIterable</span><span class=\"p\">(</span>\n            <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n            <span class=\"n\">iterator</span><span class=\"o\">=</span><span class=\"n\">_pipeline_execution_iterator</span><span class=\"p\">,</span>\n            <span class=\"n\">execution_context_manager</span><span class=\"o\">=</span><span class=\"n\">PipelineExecutionContextManager</span><span class=\"p\">(</span>\n                <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n                <span class=\"n\">pipeline_run</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span>\n                <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">,</span>\n                <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n                <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">execute_run</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Executes an existing pipeline run synchronously.</span>\n\n<span class=\"sd\">    Synchronous version of execute_run_iterator.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        pipeline (IPipeline): The pipeline to execute.</span>\n<span class=\"sd\">        pipeline_run (PipelineRun): The run to execute</span>\n<span class=\"sd\">        instance (DagsterInstance): The instance in which the run has been created.</span>\n<span class=\"sd\">        raise_on_error (Optional[bool]): Whether or not to raise exceptions when they occur.</span>\n<span class=\"sd\">            Defaults to ``False``.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        PipelineExecutionResult: The result of the execution.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;execute_run requires an IPipeline but received a PipelineDefinition &quot;</span>\n            <span class=\"s2\">&quot;directly instead. To support hand-off to other processes provide a &quot;</span>\n            <span class=\"s2\">&quot;ReconstructablePipeline which can be done using reconstructable(). For in &quot;</span>\n            <span class=\"s2\">&quot;process only execution you can use InMemoryPipeline.&quot;</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline&quot;</span><span class=\"p\">,</span> <span class=\"n\">IPipeline</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_run&quot;</span><span class=\"p\">,</span> <span class=\"n\">PipelineRun</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">,</span> <span class=\"n\">DagsterInstance</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">status</span> <span class=\"o\">==</span> <span class=\"n\">PipelineRunStatus</span><span class=\"o\">.</span><span class=\"n\">NOT_STARTED</span><span class=\"p\">,</span>\n        <span class=\"n\">desc</span><span class=\"o\">=</span><span class=\"s2\">&quot;Pipeline run </span><span class=\"si\">{}</span><span class=\"s2\"> (</span><span class=\"si\">{}</span><span class=\"s2\">) in state </span><span class=\"si\">{}</span><span class=\"s2\">, expected PipelineRunStatus.NOT_STARTED&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">pipeline_name</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_id</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">status</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">pipeline_def</span> <span class=\"o\">=</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">pipeline_def</span><span class=\"p\">,</span> <span class=\"n\">PipelineSubsetDefinition</span><span class=\"p\">):</span>\n            <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n                <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span> <span class=\"o\">==</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;Cannot execute PipelineRun with solids_to_execute </span><span class=\"si\">{solids_to_execute}</span><span class=\"s2\"> that &quot;</span>\n                <span class=\"s2\">&quot;conflicts with pipeline subset </span><span class=\"si\">{pipeline_solids_to_execute}</span><span class=\"s2\">.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">pipeline_solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">str_format_set</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">),</span>\n                    <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">str_format_set</span><span class=\"p\">(</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">),</span>\n                <span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"c1\"># when `execute_run` is directly called, the sub pipeline hasn&#39;t been created</span>\n            <span class=\"c1\"># note that when we receive the solids to execute via PipelineRun, it won&#39;t support</span>\n            <span class=\"c1\"># solid selection query syntax</span>\n            <span class=\"n\">pipeline</span> <span class=\"o\">=</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">subset_for_execution_from_existing_pipeline</span><span class=\"p\">(</span>\n                <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span>\n            <span class=\"p\">)</span>\n\n    <span class=\"n\">execution_plan</span> <span class=\"o\">=</span> <span class=\"n\">create_execution_plan</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n        <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n        <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n        <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">step_keys_to_execute</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">is_memoized_run</span><span class=\"p\">(</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">tags</span><span class=\"p\">):</span>\n        <span class=\"n\">execution_plan</span> <span class=\"o\">=</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">resolve_memoized_execution_plan</span><span class=\"p\">(</span>\n            <span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">mode</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">_execute_run_iterable</span> <span class=\"o\">=</span> <span class=\"n\">_ExecuteRunWithPlanIterable</span><span class=\"p\">(</span>\n        <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n        <span class=\"n\">iterator</span><span class=\"o\">=</span><span class=\"n\">_pipeline_execution_iterator</span><span class=\"p\">,</span>\n        <span class=\"n\">execution_context_manager</span><span class=\"o\">=</span><span class=\"n\">PipelineExecutionContextManager</span><span class=\"p\">(</span>\n            <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n            <span class=\"n\">pipeline_run</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span>\n            <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"n\">raise_on_error</span><span class=\"p\">,</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">event_list</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">_execute_run_iterable</span><span class=\"p\">)</span>\n    <span class=\"n\">pipeline_context</span> <span class=\"o\">=</span> <span class=\"n\">_execute_run_iterable</span><span class=\"o\">.</span><span class=\"n\">pipeline_context</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">PipelineExecutionResult</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">(),</span>\n        <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_id</span><span class=\"p\">,</span>\n        <span class=\"n\">event_list</span><span class=\"p\">,</span>\n        <span class=\"k\">lambda</span><span class=\"p\">:</span> <span class=\"n\">scoped_pipeline_context</span><span class=\"p\">(</span>\n            <span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n            <span class=\"n\">pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">pipeline_run</span><span class=\"p\">,</span>\n            <span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"n\">intermediate_storage</span><span class=\"o\">=</span><span class=\"n\">pipeline_context</span><span class=\"o\">.</span><span class=\"n\">intermediate_storage</span><span class=\"p\">,</span>\n            <span class=\"n\">system_storage_data</span><span class=\"o\">=</span><span class=\"n\">SystemStorageData</span><span class=\"p\">(</span>\n                <span class=\"n\">intermediate_storage</span><span class=\"o\">=</span><span class=\"n\">pipeline_context</span><span class=\"o\">.</span><span class=\"n\">intermediate_storage</span><span class=\"p\">,</span>\n                <span class=\"n\">file_manager</span><span class=\"o\">=</span><span class=\"n\">pipeline_context</span><span class=\"o\">.</span><span class=\"n\">file_manager</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"execute_pipeline_iterator\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/execution/#dagster.execute_pipeline_iterator\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">execute_pipeline_iterator</span><span class=\"p\">(</span>\n    <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n    <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Execute a pipeline iteratively.</span>\n\n<span class=\"sd\">    Rather than package up the result of running a pipeline into a single object, like</span>\n<span class=\"sd\">    :py:func:`execute_pipeline`, this function yields the stream of events resulting from pipeline</span>\n<span class=\"sd\">    execution.</span>\n\n<span class=\"sd\">    This is intended to allow the caller to handle these events on a streaming basis in whatever</span>\n<span class=\"sd\">    way is appropriate.</span>\n\n<span class=\"sd\">    Parameters:</span>\n<span class=\"sd\">        pipeline (Union[IPipeline, PipelineDefinition]): The pipeline to execute.</span>\n<span class=\"sd\">        run_config (Optional[dict]): The environment configuration that parametrizes this run,</span>\n<span class=\"sd\">            as a dict.</span>\n<span class=\"sd\">        mode (Optional[str]): The name of the pipeline mode to use. You may not set both ``mode``</span>\n<span class=\"sd\">            and ``preset``.</span>\n<span class=\"sd\">        preset (Optional[str]): The name of the pipeline preset to use. You may not set both</span>\n<span class=\"sd\">            ``mode`` and ``preset``.</span>\n<span class=\"sd\">        tags (Optional[Dict[str, Any]]): Arbitrary key-value pairs that will be added to pipeline</span>\n<span class=\"sd\">            logs.</span>\n<span class=\"sd\">        solid_selection (Optional[List[str]]): A list of solid selection queries (including single</span>\n<span class=\"sd\">            solid names) to execute. For example:</span>\n<span class=\"sd\">            - [&#39;some_solid&#39;]: select &quot;some_solid&quot; itself.</span>\n<span class=\"sd\">            - [&#39;*some_solid&#39;]: select &quot;some_solid&quot; and all its ancestors (upstream dependencies).</span>\n<span class=\"sd\">            - [&#39;*some_solid+++&#39;]: select &quot;some_solid&quot;, all its ancestors, and its descendants</span>\n<span class=\"sd\">                (downstream dependencies) within 3 levels down.</span>\n<span class=\"sd\">            - [&#39;*some_solid&#39;, &#39;other_solid_a&#39;, &#39;other_solid_b+&#39;]: select &quot;some_solid&quot; and all its</span>\n<span class=\"sd\">                ancestors, &quot;other_solid_a&quot; itself, and &quot;other_solid_b&quot; and its direct child solids.</span>\n<span class=\"sd\">        instance (Optional[DagsterInstance]): The instance to execute against. If this is ``None``,</span>\n<span class=\"sd\">            an ephemeral instance will be used, and no artifacts will be persisted from the run.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">      Iterator[DagsterEvent]: The stream of events resulting from pipeline execution.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"k\">with</span> <span class=\"n\">_ephemeral_instance_if_missing</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">execute_instance</span><span class=\"p\">:</span>\n        <span class=\"p\">(</span>\n            <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n            <span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"n\">tags</span><span class=\"p\">,</span>\n            <span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">_check_execute_pipeline_args</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"p\">,</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">,</span>\n            <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">pipeline_run</span> <span class=\"o\">=</span> <span class=\"n\">execute_instance</span><span class=\"o\">.</span><span class=\"n\">create_run_for_pipeline</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline_def</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">(),</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n            <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n            <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">execute_run_iterator</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">execute_instance</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@contextmanager</span>\n<span class=\"k\">def</span> <span class=\"nf\">_ephemeral_instance_if_missing</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">instance</span><span class=\"p\">:</span>\n        <span class=\"k\">yield</span> <span class=\"n\">instance</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">with</span> <span class=\"n\">DagsterInstance</span><span class=\"o\">.</span><span class=\"n\">ephemeral</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">ephemeral_instance</span><span class=\"p\">:</span>\n            <span class=\"k\">yield</span> <span class=\"n\">ephemeral_instance</span>\n\n\n<div class=\"viewcode-block\" id=\"execute_pipeline\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/execution/#dagster.execute_pipeline\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">execute_pipeline</span><span class=\"p\">(</span>\n    <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n    <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Execute a pipeline synchronously.</span>\n\n<span class=\"sd\">    Users will typically call this API when testing pipeline execution, or running standalone</span>\n<span class=\"sd\">    scripts.</span>\n\n<span class=\"sd\">    Parameters:</span>\n<span class=\"sd\">        pipeline (Union[IPipeline, PipelineDefinition]): The pipeline to execute.</span>\n<span class=\"sd\">        run_config (Optional[dict]): The environment configuration that parametrizes this run,</span>\n<span class=\"sd\">            as a dict.</span>\n<span class=\"sd\">        mode (Optional[str]): The name of the pipeline mode to use. You may not set both ``mode``</span>\n<span class=\"sd\">            and ``preset``.</span>\n<span class=\"sd\">        preset (Optional[str]): The name of the pipeline preset to use. You may not set both</span>\n<span class=\"sd\">            ``mode`` and ``preset``.</span>\n<span class=\"sd\">        tags (Optional[Dict[str, Any]]): Arbitrary key-value pairs that will be added to pipeline</span>\n<span class=\"sd\">            logs.</span>\n<span class=\"sd\">        instance (Optional[DagsterInstance]): The instance to execute against. If this is ``None``,</span>\n<span class=\"sd\">            an ephemeral instance will be used, and no artifacts will be persisted from the run.</span>\n<span class=\"sd\">        raise_on_error (Optional[bool]): Whether or not to raise exceptions when they occur.</span>\n<span class=\"sd\">            Defaults to ``True``, since this is the most useful behavior in test.</span>\n<span class=\"sd\">        solid_selection (Optional[List[str]]): A list of solid selection queries (including single</span>\n<span class=\"sd\">            solid names) to execute. For example:</span>\n<span class=\"sd\">            - [&#39;some_solid&#39;]: select &quot;some_solid&quot; itself.</span>\n<span class=\"sd\">            - [&#39;*some_solid&#39;]: select &quot;some_solid&quot; and all its ancestors (upstream dependencies).</span>\n<span class=\"sd\">            - [&#39;*some_solid+++&#39;]: select &quot;some_solid&quot;, all its ancestors, and its descendants</span>\n<span class=\"sd\">                (downstream dependencies) within 3 levels down.</span>\n<span class=\"sd\">            - [&#39;*some_solid&#39;, &#39;other_solid_a&#39;, &#39;other_solid_b+&#39;]: select &quot;some_solid&quot; and all its</span>\n<span class=\"sd\">                ancestors, &quot;other_solid_a&quot; itself, and &quot;other_solid_b&quot; and its direct child solids.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">      :py:class:`PipelineExecutionResult`: The result of pipeline execution.</span>\n\n<span class=\"sd\">    For the asynchronous version, see :py:func:`execute_pipeline_iterator`.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"k\">with</span> <span class=\"n\">_ephemeral_instance_if_missing</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">execute_instance</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">_logged_execute_pipeline</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n            <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">execute_instance</span><span class=\"p\">,</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">,</span>\n            <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n            <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"n\">raise_on_error</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@telemetry_wrapper</span>\n<span class=\"k\">def</span> <span class=\"nf\">_logged_execute_pipeline</span><span class=\"p\">(</span>\n    <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n    <span class=\"n\">instance</span><span class=\"p\">,</span>\n    <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">,</span> <span class=\"n\">DagsterInstance</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n        <span class=\"n\">run_config</span><span class=\"p\">,</span>\n        <span class=\"n\">mode</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"p\">,</span>\n        <span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n        <span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">_check_execute_pipeline_args</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"p\">,</span>\n        <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n        <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n        <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n        <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"n\">log_repo_stats</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">pipeline</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">source</span><span class=\"o\">=</span><span class=\"s2\">&quot;execute_pipeline&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"n\">pipeline_run</span> <span class=\"o\">=</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">create_run_for_pipeline</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline_def</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">(),</span>\n        <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n        <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n        <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n        <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">execute_run</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"n\">raise_on_error</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"reexecute_pipeline\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/execution/#dagster.reexecute_pipeline\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">reexecute_pipeline</span><span class=\"p\">(</span>\n    <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n    <span class=\"n\">parent_run_id</span><span class=\"p\">,</span>\n    <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">step_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Reexecute an existing pipeline run.</span>\n\n<span class=\"sd\">    Users will typically call this API when testing pipeline reexecution, or running standalone</span>\n<span class=\"sd\">    scripts.</span>\n\n<span class=\"sd\">    Parameters:</span>\n<span class=\"sd\">        pipeline (Union[IPipeline, PipelineDefinition]): The pipeline to execute.</span>\n<span class=\"sd\">        parent_run_id (str): The id of the previous run to reexecute. The run must exist in the</span>\n<span class=\"sd\">            instance.</span>\n<span class=\"sd\">        run_config (Optional[dict]): The environment configuration that parametrizes this run,</span>\n<span class=\"sd\">            as a dict.</span>\n<span class=\"sd\">        step_selection (Optional[List[str]]): A list of step selection queries (including single</span>\n<span class=\"sd\">            step keys) to execute. For example:</span>\n<span class=\"sd\">            - [&#39;some_solid.compute&#39;]: select the execution step &quot;some_solid.compute&quot; itself.</span>\n<span class=\"sd\">            - [&#39;*some_solid.compute&#39;]: select the step &quot;some_solid.compute&quot; and all its ancestors</span>\n<span class=\"sd\">                (upstream dependencies).</span>\n<span class=\"sd\">            - [&#39;*some_solid.compute+++&#39;]: select the step &quot;some_solid.compute&quot;, all its ancestors,</span>\n<span class=\"sd\">                and its descendants (downstream dependencies) within 3 levels down.</span>\n<span class=\"sd\">            - [&#39;*some_solid.compute&#39;, &#39;other_solid_a.compute&#39;, &#39;other_solid_b.compute+&#39;]: select</span>\n<span class=\"sd\">                &quot;some_solid.compute&quot; and all its ancestors, &quot;other_solid_a.compute&quot; itself, and</span>\n<span class=\"sd\">                &quot;other_solid_b.compute&quot; and its direct child execution steps.</span>\n<span class=\"sd\">        mode (Optional[str]): The name of the pipeline mode to use. You may not set both ``mode``</span>\n<span class=\"sd\">            and ``preset``.</span>\n<span class=\"sd\">        preset (Optional[str]): The name of the pipeline preset to use. You may not set both</span>\n<span class=\"sd\">            ``mode`` and ``preset``.</span>\n<span class=\"sd\">        tags (Optional[Dict[str, Any]]): Arbitrary key-value pairs that will be added to pipeline</span>\n<span class=\"sd\">            logs.</span>\n<span class=\"sd\">        instance (Optional[DagsterInstance]): The instance to execute against. If this is ``None``,</span>\n<span class=\"sd\">            an ephemeral instance will be used, and no artifacts will be persisted from the run.</span>\n<span class=\"sd\">        raise_on_error (Optional[bool]): Whether or not to raise exceptions when they occur.</span>\n<span class=\"sd\">            Defaults to ``True``, since this is the most useful behavior in test.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">      :py:class:`PipelineExecutionResult`: The result of pipeline execution.</span>\n\n<span class=\"sd\">    For the asynchronous version, see :py:func:`reexecute_pipeline_iterator`.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"n\">step_selection</span> <span class=\"o\">=</span> <span class=\"n\">canonicalize_backcompat_args</span><span class=\"p\">(</span>\n        <span class=\"n\">step_selection</span><span class=\"p\">,</span> <span class=\"s2\">&quot;step_selection&quot;</span><span class=\"p\">,</span> <span class=\"n\">step_keys_to_execute</span><span class=\"p\">,</span> <span class=\"s2\">&quot;step_keys_to_execute&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;0.10.0&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_list_param</span><span class=\"p\">(</span><span class=\"n\">step_selection</span><span class=\"p\">,</span> <span class=\"s2\">&quot;step_selection&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">parent_run_id</span><span class=\"p\">,</span> <span class=\"s2\">&quot;parent_run_id&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">with</span> <span class=\"n\">_ephemeral_instance_if_missing</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">execute_instance</span><span class=\"p\">:</span>\n        <span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">_check_execute_pipeline_args</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">parent_pipeline_run</span> <span class=\"o\">=</span> <span class=\"n\">execute_instance</span><span class=\"o\">.</span><span class=\"n\">get_run_by_id</span><span class=\"p\">(</span><span class=\"n\">parent_run_id</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n            <span class=\"n\">parent_pipeline_run</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;No parent run with id </span><span class=\"si\">{parent_run_id}</span><span class=\"s2\"> found in instance.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"n\">parent_run_id</span><span class=\"o\">=</span><span class=\"n\">parent_run_id</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"c1\"># resolve step selection DSL queries using parent execution plan snapshot</span>\n        <span class=\"k\">if</span> <span class=\"n\">step_selection</span><span class=\"p\">:</span>\n            <span class=\"n\">parent_execution_plan_snapshot</span> <span class=\"o\">=</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">get_execution_plan_snapshot</span><span class=\"p\">(</span>\n                <span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">execution_plan_snapshot_id</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">step_keys_to_execute</span> <span class=\"o\">=</span> <span class=\"n\">parse_step_selection</span><span class=\"p\">(</span>\n                <span class=\"n\">parent_execution_plan_snapshot</span><span class=\"o\">.</span><span class=\"n\">step_deps</span><span class=\"p\">,</span> <span class=\"n\">step_selection</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">step_keys_to_execute</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"n\">pipeline_run</span> <span class=\"o\">=</span> <span class=\"n\">execute_instance</span><span class=\"o\">.</span><span class=\"n\">create_run_for_pipeline</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline_def</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">(),</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n            <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n            <span class=\"c1\"># convert to frozenset https://github.com/dagster-io/dagster/issues/2914</span>\n            <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">step_keys_to_execute</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">step_keys_to_execute</span> <span class=\"k\">else</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"n\">root_run_id</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">root_run_id</span> <span class=\"ow\">or</span> <span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_id</span><span class=\"p\">,</span>\n            <span class=\"n\">parent_run_id</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_id</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">execute_run</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">execute_instance</span><span class=\"p\">,</span> <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"n\">raise_on_error</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"reexecute_pipeline_iterator\"><a class=\"viewcode-back\" href=\"../../../../../sections/api/apidocs/execution/#dagster.reexecute_pipeline_iterator\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">reexecute_pipeline_iterator</span><span class=\"p\">(</span>\n    <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n    <span class=\"n\">parent_run_id</span><span class=\"p\">,</span>\n    <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">step_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Reexecute a pipeline iteratively.</span>\n\n<span class=\"sd\">    Rather than package up the result of running a pipeline into a single object, like</span>\n<span class=\"sd\">    :py:func:`reexecute_pipeline`, this function yields the stream of events resulting from pipeline</span>\n<span class=\"sd\">    reexecution.</span>\n\n<span class=\"sd\">    This is intended to allow the caller to handle these events on a streaming basis in whatever</span>\n<span class=\"sd\">    way is appropriate.</span>\n\n<span class=\"sd\">    Parameters:</span>\n<span class=\"sd\">        pipeline (Union[IPipeline, PipelineDefinition]): The pipeline to execute.</span>\n<span class=\"sd\">        parent_run_id (str): The id of the previous run to reexecute. The run must exist in the</span>\n<span class=\"sd\">            instance.</span>\n<span class=\"sd\">        run_config (Optional[dict]): The environment configuration that parametrizes this run,</span>\n<span class=\"sd\">            as a dict.</span>\n<span class=\"sd\">        step_selection (Optional[List[str]]): A list of step selection queries (including single</span>\n<span class=\"sd\">            step keys) to execute. For example:</span>\n<span class=\"sd\">            - [&#39;some_solid.compute&#39;]: select the execution step &quot;some_solid.compute&quot; itself.</span>\n<span class=\"sd\">            - [&#39;*some_solid.compute&#39;]: select the step &quot;some_solid.compute&quot; and all its ancestors</span>\n<span class=\"sd\">                (upstream dependencies).</span>\n<span class=\"sd\">            - [&#39;*some_solid.compute+++&#39;]: select the step &quot;some_solid.compute&quot;, all its ancestors,</span>\n<span class=\"sd\">                and its descendants (downstream dependencies) within 3 levels down.</span>\n<span class=\"sd\">            - [&#39;*some_solid.compute&#39;, &#39;other_solid_a.compute&#39;, &#39;other_solid_b.compute+&#39;]: select</span>\n<span class=\"sd\">                &quot;some_solid.compute&quot; and all its ancestors, &quot;other_solid_a.compute&quot; itself, and</span>\n<span class=\"sd\">                &quot;other_solid_b.compute&quot; and its direct child execution steps.</span>\n<span class=\"sd\">        mode (Optional[str]): The name of the pipeline mode to use. You may not set both ``mode``</span>\n<span class=\"sd\">            and ``preset``.</span>\n<span class=\"sd\">        preset (Optional[str]): The name of the pipeline preset to use. You may not set both</span>\n<span class=\"sd\">            ``mode`` and ``preset``.</span>\n<span class=\"sd\">        tags (Optional[Dict[str, Any]]): Arbitrary key-value pairs that will be added to pipeline</span>\n<span class=\"sd\">            logs.</span>\n<span class=\"sd\">        instance (Optional[DagsterInstance]): The instance to execute against. If this is ``None``,</span>\n<span class=\"sd\">            an ephemeral instance will be used, and no artifacts will be persisted from the run.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">      Iterator[DagsterEvent]: The stream of events resulting from pipeline reexecution.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"n\">step_selection</span> <span class=\"o\">=</span> <span class=\"n\">canonicalize_backcompat_args</span><span class=\"p\">(</span>\n        <span class=\"n\">step_selection</span><span class=\"p\">,</span> <span class=\"s2\">&quot;step_selection&quot;</span><span class=\"p\">,</span> <span class=\"n\">step_keys_to_execute</span><span class=\"p\">,</span> <span class=\"s2\">&quot;step_keys_to_execute&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;0.10.0&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_list_param</span><span class=\"p\">(</span><span class=\"n\">step_selection</span><span class=\"p\">,</span> <span class=\"s2\">&quot;step_selection&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">parent_run_id</span><span class=\"p\">,</span> <span class=\"s2\">&quot;parent_run_id&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">with</span> <span class=\"n\">_ephemeral_instance_if_missing</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">execute_instance</span><span class=\"p\">:</span>\n        <span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">_check_execute_pipeline_args</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"p\">,</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">,</span>\n            <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">parent_pipeline_run</span> <span class=\"o\">=</span> <span class=\"n\">execute_instance</span><span class=\"o\">.</span><span class=\"n\">get_run_by_id</span><span class=\"p\">(</span><span class=\"n\">parent_run_id</span><span class=\"p\">)</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n            <span class=\"n\">parent_pipeline_run</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;No parent run with id </span><span class=\"si\">{parent_run_id}</span><span class=\"s2\"> found in instance.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"n\">parent_run_id</span><span class=\"o\">=</span><span class=\"n\">parent_run_id</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"c1\"># resolve step selection DSL queries using parent execution plan snapshot</span>\n        <span class=\"k\">if</span> <span class=\"n\">step_selection</span><span class=\"p\">:</span>\n            <span class=\"n\">parent_execution_plan_snapshot</span> <span class=\"o\">=</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">get_execution_plan_snapshot</span><span class=\"p\">(</span>\n                <span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">execution_plan_snapshot_id</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">step_keys_to_execute</span> <span class=\"o\">=</span> <span class=\"n\">parse_step_selection</span><span class=\"p\">(</span>\n                <span class=\"n\">parent_execution_plan_snapshot</span><span class=\"o\">.</span><span class=\"n\">step_deps</span><span class=\"p\">,</span> <span class=\"n\">step_selection</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">step_keys_to_execute</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"n\">pipeline_run</span> <span class=\"o\">=</span> <span class=\"n\">execute_instance</span><span class=\"o\">.</span><span class=\"n\">create_run_for_pipeline</span><span class=\"p\">(</span>\n            <span class=\"n\">pipeline_def</span><span class=\"o\">=</span><span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">(),</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"n\">tags</span><span class=\"p\">,</span>\n            <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n            <span class=\"n\">solids_to_execute</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n            <span class=\"c1\"># convert to frozenset https://github.com/dagster-io/dagster/issues/2914</span>\n            <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">step_keys_to_execute</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">step_keys_to_execute</span> <span class=\"k\">else</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"n\">root_run_id</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">root_run_id</span> <span class=\"ow\">or</span> <span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_id</span><span class=\"p\">,</span>\n            <span class=\"n\">parent_run_id</span><span class=\"o\">=</span><span class=\"n\">parent_pipeline_run</span><span class=\"o\">.</span><span class=\"n\">run_id</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">execute_run_iterator</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">execute_instance</span><span class=\"p\">)</span></div>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">execute_plan_iterator</span><span class=\"p\">(</span>\n    <span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">retries</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"s2\">&quot;execution_plan&quot;</span><span class=\"p\">,</span> <span class=\"n\">ExecutionPlan</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_run&quot;</span><span class=\"p\">,</span> <span class=\"n\">PipelineRun</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">,</span> <span class=\"n\">DagsterInstance</span><span class=\"p\">)</span>\n    <span class=\"n\">retries</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_inst_param</span><span class=\"p\">(</span><span class=\"n\">retries</span><span class=\"p\">,</span> <span class=\"s2\">&quot;retries&quot;</span><span class=\"p\">,</span> <span class=\"n\">Retries</span><span class=\"p\">,</span> <span class=\"n\">Retries</span><span class=\"o\">.</span><span class=\"n\">disabled_mode</span><span class=\"p\">())</span>\n    <span class=\"n\">run_config</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span><span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"s2\">&quot;run_config&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"nb\">iter</span><span class=\"p\">(</span>\n        <span class=\"n\">_ExecuteRunWithPlanIterable</span><span class=\"p\">(</span>\n            <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n            <span class=\"n\">iterator</span><span class=\"o\">=</span><span class=\"n\">inner_plan_execution_iterator</span><span class=\"p\">,</span>\n            <span class=\"n\">execution_context_manager</span><span class=\"o\">=</span><span class=\"n\">PlanExecutionContextManager</span><span class=\"p\">(</span>\n                <span class=\"n\">retries</span><span class=\"o\">=</span><span class=\"n\">retries</span><span class=\"p\">,</span>\n                <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n                <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n                <span class=\"n\">pipeline_run</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span>\n                <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">,</span>\n                <span class=\"n\">raise_on_error</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">execute_plan</span><span class=\"p\">(</span>\n    <span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">retries</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;This is the entry point of dagster-graphql executions. For the dagster CLI entry point, see</span>\n<span class=\"sd\">    execute_pipeline() above.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"s2\">&quot;execution_plan&quot;</span><span class=\"p\">,</span> <span class=\"n\">ExecutionPlan</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">,</span> <span class=\"n\">DagsterInstance</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_run&quot;</span><span class=\"p\">,</span> <span class=\"n\">PipelineRun</span><span class=\"p\">)</span>\n    <span class=\"n\">run_config</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span><span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"s2\">&quot;run_config&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_inst_param</span><span class=\"p\">(</span><span class=\"n\">retries</span><span class=\"p\">,</span> <span class=\"s2\">&quot;retries&quot;</span><span class=\"p\">,</span> <span class=\"n\">Retries</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"nb\">list</span><span class=\"p\">(</span>\n        <span class=\"n\">execute_plan_iterator</span><span class=\"p\">(</span>\n            <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span>\n            <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"n\">run_config</span><span class=\"p\">,</span>\n            <span class=\"n\">pipeline_run</span><span class=\"o\">=</span><span class=\"n\">pipeline_run</span><span class=\"p\">,</span>\n            <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"n\">retries</span><span class=\"o\">=</span><span class=\"n\">retries</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_check_pipeline</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">):</span>\n    <span class=\"c1\"># backcompat</span>\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">):</span>\n        <span class=\"n\">pipeline</span> <span class=\"o\">=</span> <span class=\"n\">InMemoryPipeline</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">)</span>\n\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline&quot;</span><span class=\"p\">,</span> <span class=\"n\">IPipeline</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">pipeline</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">create_execution_plan</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"n\">pipeline</span> <span class=\"o\">=</span> <span class=\"n\">_check_pipeline</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">)</span>\n    <span class=\"n\">pipeline_def</span> <span class=\"o\">=</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_def</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_def&quot;</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">)</span>\n\n    <span class=\"n\">run_config</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span><span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"s2\">&quot;run_config&quot;</span><span class=\"p\">,</span> <span class=\"n\">key_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n    <span class=\"n\">mode</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"s2\">&quot;mode&quot;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">get_default_mode_name</span><span class=\"p\">())</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_list_param</span><span class=\"p\">(</span><span class=\"n\">step_keys_to_execute</span><span class=\"p\">,</span> <span class=\"s2\">&quot;step_keys_to_execute&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n\n    <span class=\"n\">environment_config</span> <span class=\"o\">=</span> <span class=\"n\">EnvironmentConfig</span><span class=\"o\">.</span><span class=\"n\">build</span><span class=\"p\">(</span><span class=\"n\">pipeline_def</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">ExecutionPlan</span><span class=\"o\">.</span><span class=\"n\">build</span><span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">environment_config</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">step_keys_to_execute</span><span class=\"o\">=</span><span class=\"n\">step_keys_to_execute</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_pipeline_execution_iterator</span><span class=\"p\">(</span><span class=\"n\">pipeline_context</span><span class=\"p\">,</span> <span class=\"n\">execution_plan</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;A complete execution of a pipeline. Yields pipeline start, success,</span>\n<span class=\"sd\">    and failure events.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        pipeline_context (SystemPipelineExecutionContext):</span>\n<span class=\"sd\">        execution_plan (ExecutionPlan):</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_context</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_context&quot;</span><span class=\"p\">,</span> <span class=\"n\">SystemPipelineExecutionContext</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"s2\">&quot;execution_plan&quot;</span><span class=\"p\">,</span> <span class=\"n\">ExecutionPlan</span><span class=\"p\">)</span>\n\n    <span class=\"k\">yield</span> <span class=\"n\">DagsterEvent</span><span class=\"o\">.</span><span class=\"n\">pipeline_start</span><span class=\"p\">(</span><span class=\"n\">pipeline_context</span><span class=\"p\">)</span>\n\n    <span class=\"n\">pipeline_exception_info</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">failed_steps</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">generator_closed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">for</span> <span class=\"n\">event</span> <span class=\"ow\">in</span> <span class=\"n\">pipeline_context</span><span class=\"o\">.</span><span class=\"n\">executor</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"n\">pipeline_context</span><span class=\"p\">,</span> <span class=\"n\">execution_plan</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">is_step_failure</span><span class=\"p\">:</span>\n                <span class=\"n\">failed_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">step_key</span><span class=\"p\">)</span>\n\n            <span class=\"k\">yield</span> <span class=\"n\">event</span>\n    <span class=\"k\">except</span> <span class=\"ne\">GeneratorExit</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Shouldn&#39;t happen, but avoid runtime-exception in case this generator gets GC-ed</span>\n        <span class=\"c1\"># (see https://amir.rachum.com/blog/2017/03/03/generator-cleanup/).</span>\n        <span class=\"n\">generator_closed</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n        <span class=\"n\">pipeline_exception_info</span> <span class=\"o\">=</span> <span class=\"n\">serializable_error_info_from_exc_info</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">exc_info</span><span class=\"p\">())</span>\n        <span class=\"k\">raise</span>\n    <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">,</span> <span class=\"ne\">KeyboardInterrupt</span><span class=\"p\">):</span>  <span class=\"c1\"># pylint: disable=broad-except</span>\n        <span class=\"n\">pipeline_exception_info</span> <span class=\"o\">=</span> <span class=\"n\">serializable_error_info_from_exc_info</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">exc_info</span><span class=\"p\">())</span>\n        <span class=\"k\">raise</span>  <span class=\"c1\"># finally block will run before this is re-raised</span>\n    <span class=\"k\">finally</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">pipeline_exception_info</span><span class=\"p\">:</span>\n            <span class=\"n\">event</span> <span class=\"o\">=</span> <span class=\"n\">DagsterEvent</span><span class=\"o\">.</span><span class=\"n\">pipeline_failure</span><span class=\"p\">(</span>\n                <span class=\"n\">pipeline_context</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;An exception was thrown during execution.&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">pipeline_exception_info</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"n\">failed_steps</span><span class=\"p\">:</span>\n            <span class=\"n\">event</span> <span class=\"o\">=</span> <span class=\"n\">DagsterEvent</span><span class=\"o\">.</span><span class=\"n\">pipeline_failure</span><span class=\"p\">(</span>\n                <span class=\"n\">pipeline_context</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Steps failed: </span><span class=\"si\">{}</span><span class=\"s2\">.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">failed_steps</span><span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">event</span> <span class=\"o\">=</span> <span class=\"n\">DagsterEvent</span><span class=\"o\">.</span><span class=\"n\">pipeline_success</span><span class=\"p\">(</span><span class=\"n\">pipeline_context</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">generator_closed</span><span class=\"p\">:</span>\n            <span class=\"k\">yield</span> <span class=\"n\">event</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">_ExecuteRunWithPlanIterable</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Utility class to consolidate execution logic.</span>\n\n<span class=\"sd\">    This is a class and not a function because, e.g., in constructing a `scoped_pipeline_context`</span>\n<span class=\"sd\">    for `PipelineExecutionResult`, we need to pull out the `pipeline_context` after we&#39;re done</span>\n<span class=\"sd\">    yielding events. This broadly follows a pattern we make use of in other places,</span>\n<span class=\"sd\">    cf. `dagster.utils.EventGenerationManager`.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"n\">iterator</span><span class=\"p\">,</span> <span class=\"n\">execution_context_manager</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">execution_plan</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"s2\">&quot;execution_plan&quot;</span><span class=\"p\">,</span> <span class=\"n\">ExecutionPlan</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">iterator</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">callable_param</span><span class=\"p\">(</span><span class=\"n\">iterator</span><span class=\"p\">,</span> <span class=\"s2\">&quot;iterator&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">execution_context_manager</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span>\n            <span class=\"n\">execution_context_manager</span><span class=\"p\">,</span> <span class=\"s2\">&quot;execution_context_manager&quot;</span><span class=\"p\">,</span> <span class=\"n\">ExecutionContextManager</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_context</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__iter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"c1\"># Since interrupts can&#39;t be raised at arbitrary points safely, delay them until designated</span>\n        <span class=\"c1\"># checkpoints during the execution.</span>\n        <span class=\"c1\"># To be maximally certain that interrupts are always caught during an execution process,</span>\n        <span class=\"c1\"># you can safely add an additional `with delay_interrupts()` at the very beginning of the</span>\n        <span class=\"c1\"># process that performs the execution</span>\n        <span class=\"k\">with</span> <span class=\"n\">delay_interrupts</span><span class=\"p\">():</span>\n            <span class=\"k\">yield from</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">execution_context_manager</span><span class=\"o\">.</span><span class=\"n\">prepare_context</span><span class=\"p\">()</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_context</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">execution_context_manager</span><span class=\"o\">.</span><span class=\"n\">get_context</span><span class=\"p\">()</span>\n            <span class=\"n\">generator_closed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_context</span><span class=\"p\">:</span>  <span class=\"c1\"># False if we had a pipeline init failure</span>\n                    <span class=\"k\">yield from</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">iterator</span><span class=\"p\">(</span>\n                        <span class=\"n\">execution_plan</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">execution_plan</span><span class=\"p\">,</span> <span class=\"n\">pipeline_context</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pipeline_context</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"ne\">GeneratorExit</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Shouldn&#39;t happen, but avoid runtime-exception in case this generator gets GC-ed</span>\n                <span class=\"c1\"># (see https://amir.rachum.com/blog/2017/03/03/generator-cleanup/).</span>\n                <span class=\"n\">generator_closed</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n                <span class=\"k\">raise</span>\n            <span class=\"k\">finally</span><span class=\"p\">:</span>\n                <span class=\"k\">for</span> <span class=\"n\">event</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">execution_context_manager</span><span class=\"o\">.</span><span class=\"n\">shutdown_context</span><span class=\"p\">():</span>\n                    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">generator_closed</span><span class=\"p\">:</span>\n                        <span class=\"k\">yield</span> <span class=\"n\">event</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_check_execute_pipeline_args</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">,</span> <span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">preset</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"n\">pipeline</span> <span class=\"o\">=</span> <span class=\"n\">_check_pipeline</span><span class=\"p\">(</span><span class=\"n\">pipeline</span><span class=\"p\">)</span>\n    <span class=\"n\">pipeline_def</span> <span class=\"o\">=</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">get_definition</span><span class=\"p\">()</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pipeline_def</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pipeline_def&quot;</span><span class=\"p\">,</span> <span class=\"n\">PipelineDefinition</span><span class=\"p\">)</span>\n\n    <span class=\"n\">run_config</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span><span class=\"n\">run_config</span><span class=\"p\">,</span> <span class=\"s2\">&quot;run_config&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"s2\">&quot;mode&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">preset</span><span class=\"p\">,</span> <span class=\"s2\">&quot;preset&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n        <span class=\"ow\">not</span> <span class=\"p\">(</span><span class=\"n\">mode</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"n\">preset</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">),</span>\n        <span class=\"s2\">&quot;You may set only one of `mode` (got </span><span class=\"si\">{mode}</span><span class=\"s2\">) or `preset` (got </span><span class=\"si\">{preset}</span><span class=\"s2\">).&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"n\">tags</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span><span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"s2\">&quot;tags&quot;</span><span class=\"p\">,</span> <span class=\"n\">key_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_list_param</span><span class=\"p\">(</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span> <span class=\"s2\">&quot;solid_selection&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">preset</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">pipeline_preset</span> <span class=\"o\">=</span> <span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">get_preset</span><span class=\"p\">(</span><span class=\"n\">preset</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">run_config</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n                <span class=\"p\">(</span><span class=\"ow\">not</span> <span class=\"n\">run_config</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"p\">(</span><span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">run_config</span> <span class=\"o\">==</span> <span class=\"n\">run_config</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;The environment set in preset &#39;</span><span class=\"si\">{preset}</span><span class=\"s2\">&#39; does not agree with the environment &quot;</span>\n                <span class=\"s2\">&quot;passed in the `run_config` argument.&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"n\">run_config</span> <span class=\"o\">=</span> <span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">run_config</span>\n\n        <span class=\"c1\"># load solid_selection from preset</span>\n        <span class=\"k\">if</span> <span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">solid_selection</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n                <span class=\"n\">solid_selection</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">solid_selection</span> <span class=\"o\">==</span> <span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;The solid_selection set in preset &#39;</span><span class=\"si\">{preset}</span><span class=\"s2\">&#39;, </span><span class=\"si\">{preset_subset}</span><span class=\"s2\">, does not agree with &quot;</span>\n                <span class=\"s2\">&quot;the `solid_selection` argument: </span><span class=\"si\">{solid_selection}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">,</span>\n                    <span class=\"n\">preset_subset</span><span class=\"o\">=</span><span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n                    <span class=\"n\">solid_selection</span><span class=\"o\">=</span><span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n                <span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">solid_selection</span> <span class=\"o\">=</span> <span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">solid_selection</span>\n\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">invariant</span><span class=\"p\">(</span>\n            <span class=\"n\">mode</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">mode</span> <span class=\"o\">==</span> <span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">mode</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;Mode </span><span class=\"si\">{mode}</span><span class=\"s2\"> does not agree with the mode set in preset &#39;</span><span class=\"si\">{preset}</span><span class=\"s2\">&#39;: &quot;</span>\n            <span class=\"s2\">&quot;(&#39;</span><span class=\"si\">{preset_mode}</span><span class=\"s2\">&#39;)&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">preset</span><span class=\"o\">=</span><span class=\"n\">preset</span><span class=\"p\">,</span> <span class=\"n\">preset_mode</span><span class=\"o\">=</span><span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">mode</span> <span class=\"o\">=</span> <span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">mode</span>\n\n        <span class=\"n\">tags</span> <span class=\"o\">=</span> <span class=\"n\">merge_dicts</span><span class=\"p\">(</span><span class=\"n\">pipeline_preset</span><span class=\"o\">.</span><span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">mode</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">has_mode_definition</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n                <span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;You have attempted to execute pipeline </span><span class=\"si\">{name}</span><span class=\"s2\"> with mode </span><span class=\"si\">{mode}</span><span class=\"s2\">. &quot;</span>\n                    <span class=\"s2\">&quot;Available modes: </span><span class=\"si\">{modes}</span><span class=\"s2\">&quot;</span>\n                <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">modes</span><span class=\"o\">=</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">available_modes</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">is_multi_mode</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n                <span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;Pipeline </span><span class=\"si\">{name}</span><span class=\"s2\"> has multiple modes (Available modes: </span><span class=\"si\">{modes}</span><span class=\"s2\">) and you have &quot;</span>\n                    <span class=\"s2\">&quot;attempted to execute it without specifying a mode. Set &quot;</span>\n                    <span class=\"s2\">&quot;mode property on the PipelineRun object.&quot;</span>\n                <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">modes</span><span class=\"o\">=</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">available_modes</span><span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n        <span class=\"n\">mode</span> <span class=\"o\">=</span> <span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">get_default_mode_name</span><span class=\"p\">()</span>\n\n    <span class=\"n\">tags</span> <span class=\"o\">=</span> <span class=\"n\">merge_dicts</span><span class=\"p\">(</span><span class=\"n\">pipeline_def</span><span class=\"o\">.</span><span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># generate pipeline subset from the given solid_selection</span>\n    <span class=\"k\">if</span> <span class=\"n\">solid_selection</span><span class=\"p\">:</span>\n        <span class=\"n\">pipeline</span> <span class=\"o\">=</span> <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">subset_for_execution</span><span class=\"p\">(</span><span class=\"n\">solid_selection</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"p\">(</span>\n        <span class=\"n\">pipeline</span><span class=\"p\">,</span>\n        <span class=\"n\">run_config</span><span class=\"p\">,</span>\n        <span class=\"n\">mode</span><span class=\"p\">,</span>\n        <span class=\"n\">tags</span><span class=\"p\">,</span>\n        <span class=\"n\">pipeline</span><span class=\"o\">.</span><span class=\"n\">solids_to_execute</span><span class=\"p\">,</span>\n        <span class=\"n\">solid_selection</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n</pre></div>", "current_page_name": "_modules/dagster/core/execution/api", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}