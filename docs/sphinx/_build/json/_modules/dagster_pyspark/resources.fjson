{"parents": [{"link": "../../", "title": "Module code"}], "title": "dagster_pyspark.resources", "body": "<h1>Source code for dagster_pyspark.resources</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">check</span><span class=\"p\">,</span> <span class=\"n\">resource</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster_spark.configs_spark</span> <span class=\"kn\">import</span> <span class=\"n\">spark_config</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster_spark.utils</span> <span class=\"kn\">import</span> <span class=\"n\">flatten_dict</span>\n<span class=\"kn\">from</span> <span class=\"nn\">pyspark.sql</span> <span class=\"kn\">import</span> <span class=\"n\">SparkSession</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">spark_session_from_config</span><span class=\"p\">(</span><span class=\"n\">spark_conf</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"n\">spark_conf</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_dict_param</span><span class=\"p\">(</span><span class=\"n\">spark_conf</span><span class=\"p\">,</span> <span class=\"s2\">&quot;spark_conf&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">builder</span> <span class=\"o\">=</span> <span class=\"n\">SparkSession</span><span class=\"o\">.</span><span class=\"n\">builder</span>\n    <span class=\"n\">flat</span> <span class=\"o\">=</span> <span class=\"n\">flatten_dict</span><span class=\"p\">(</span><span class=\"n\">spark_conf</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">flat</span><span class=\"p\">:</span>\n        <span class=\"n\">builder</span> <span class=\"o\">=</span> <span class=\"n\">builder</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">builder</span><span class=\"o\">.</span><span class=\"n\">getOrCreate</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PySparkResource</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">spark_conf</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_spark_session</span> <span class=\"o\">=</span> <span class=\"n\">spark_session_from_config</span><span class=\"p\">(</span><span class=\"n\">spark_conf</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">spark_session</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_spark_session</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">spark_context</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">spark_session</span><span class=\"o\">.</span><span class=\"n\">sparkContext</span>\n\n\n<div class=\"viewcode-block\" id=\"pyspark_resource\"><a class=\"viewcode-back\" href=\"../../../sections/api/apidocs/libraries/dagster_pyspark/#dagster_pyspark.pyspark_resource\">[docs]</a><span class=\"nd\">@resource</span><span class=\"p\">({</span><span class=\"s2\">&quot;spark_conf&quot;</span><span class=\"p\">:</span> <span class=\"n\">spark_config</span><span class=\"p\">()})</span>\n<span class=\"k\">def</span> <span class=\"nf\">pyspark_resource</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;This resource provides access to a PySpark SparkSession for executing PySpark code within</span>\n<span class=\"sd\">    Dagster.</span>\n\n<span class=\"sd\">    Example:</span>\n\n<span class=\"sd\">    .. literalinclude:: ../../../../../examples/basic_pyspark/repo.py</span>\n<span class=\"sd\">       :language: python</span>\n\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">return</span> <span class=\"n\">PySparkResource</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;spark_conf&quot;</span><span class=\"p\">])</span></div>\n</pre></div>", "current_page_name": "_modules/dagster_pyspark/resources", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}