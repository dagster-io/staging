{"parents": [{"link": "../../", "title": "Module code"}], "title": "dagster_pandas.data_frame", "body": "<h1>Source code for dagster_pandas.data_frame</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">pandas</span> <span class=\"k\">as</span> <span class=\"nn\">pd</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">AssetMaterialization</span><span class=\"p\">,</span>\n    <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">,</span>\n    <span class=\"n\">DagsterType</span><span class=\"p\">,</span>\n    <span class=\"n\">EventMetadataEntry</span><span class=\"p\">,</span>\n    <span class=\"n\">Field</span><span class=\"p\">,</span>\n    <span class=\"n\">StringSource</span><span class=\"p\">,</span>\n    <span class=\"n\">TypeCheck</span><span class=\"p\">,</span>\n    <span class=\"n\">check</span><span class=\"p\">,</span>\n    <span class=\"n\">dagster_type_loader</span><span class=\"p\">,</span>\n    <span class=\"n\">dagster_type_materializer</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.config.field_utils</span> <span class=\"kn\">import</span> <span class=\"n\">Selector</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils</span> <span class=\"kn\">import</span> <span class=\"n\">dict_without_keys</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.backcompat</span> <span class=\"kn\">import</span> <span class=\"n\">canonicalize_backcompat_args</span><span class=\"p\">,</span> <span class=\"n\">experimental</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster_pandas.constraints</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">ColumnDTypeFnConstraint</span><span class=\"p\">,</span>\n    <span class=\"n\">ColumnDTypeInSetConstraint</span><span class=\"p\">,</span>\n    <span class=\"n\">ConstraintViolationException</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster_pandas.validation</span> <span class=\"kn\">import</span> <span class=\"n\">PandasColumn</span><span class=\"p\">,</span> <span class=\"n\">validate_constraints</span>\n\n<span class=\"n\">CONSTRAINT_BLACKLIST</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">ColumnDTypeFnConstraint</span><span class=\"p\">,</span> <span class=\"n\">ColumnDTypeInSetConstraint</span><span class=\"p\">}</span>\n\n\n<span class=\"nd\">@dagster_type_materializer</span><span class=\"p\">(</span>\n    <span class=\"n\">Selector</span><span class=\"p\">(</span>\n        <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;csv&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;sep&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"s2\">&quot;,&quot;</span><span class=\"p\">),</span>\n            <span class=\"p\">},</span>\n            <span class=\"s2\">&quot;parquet&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">},</span>\n            <span class=\"s2\">&quot;table&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">},</span>\n            <span class=\"s2\">&quot;pickle&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">},</span>\n        <span class=\"p\">},</span>\n    <span class=\"p\">)</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">dataframe_materializer</span><span class=\"p\">(</span><span class=\"n\">_context</span><span class=\"p\">,</span> <span class=\"n\">config</span><span class=\"p\">,</span> <span class=\"n\">pandas_df</span><span class=\"p\">):</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">inst_param</span><span class=\"p\">(</span><span class=\"n\">pandas_df</span><span class=\"p\">,</span> <span class=\"s2\">&quot;pandas_df&quot;</span><span class=\"p\">,</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"p\">)</span>\n    <span class=\"n\">file_type</span><span class=\"p\">,</span> <span class=\"n\">file_options</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">())[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;csv&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">]</span>\n        <span class=\"n\">pandas_df</span><span class=\"o\">.</span><span class=\"n\">to_csv</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">dict_without_keys</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">,</span> <span class=\"s2\">&quot;path&quot;</span><span class=\"p\">))</span>\n    <span class=\"k\">elif</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;parquet&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">pandas_df</span><span class=\"o\">.</span><span class=\"n\">to_parquet</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">])</span>\n    <span class=\"k\">elif</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;table&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">pandas_df</span><span class=\"o\">.</span><span class=\"n\">to_csv</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">],</span> <span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"se\">\\t</span><span class=\"s2\">&quot;</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;pickle&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">pandas_df</span><span class=\"o\">.</span><span class=\"n\">to_pickle</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">])</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">failed</span><span class=\"p\">(</span><span class=\"s2\">&quot;Unsupported file_type </span><span class=\"si\">{file_type}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">file_type</span><span class=\"o\">=</span><span class=\"n\">file_type</span><span class=\"p\">))</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">AssetMaterialization</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">])</span>\n\n\n<span class=\"nd\">@dagster_type_loader</span><span class=\"p\">(</span>\n    <span class=\"n\">Selector</span><span class=\"p\">(</span>\n        <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;csv&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;sep&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"s2\">&quot;,&quot;</span><span class=\"p\">),</span>\n            <span class=\"p\">},</span>\n            <span class=\"s2\">&quot;parquet&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">},</span>\n            <span class=\"s2\">&quot;table&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">},</span>\n            <span class=\"s2\">&quot;pickle&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"n\">StringSource</span><span class=\"p\">},</span>\n        <span class=\"p\">},</span>\n    <span class=\"p\">)</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">dataframe_loader</span><span class=\"p\">(</span><span class=\"n\">_context</span><span class=\"p\">,</span> <span class=\"n\">config</span><span class=\"p\">):</span>\n    <span class=\"n\">file_type</span><span class=\"p\">,</span> <span class=\"n\">file_options</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">())[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;csv&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">dict_without_keys</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">,</span> <span class=\"s2\">&quot;path&quot;</span><span class=\"p\">))</span>\n    <span class=\"k\">elif</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;parquet&quot;</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_parquet</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">])</span>\n    <span class=\"k\">elif</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;table&quot;</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">],</span> <span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"se\">\\t</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"n\">file_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;pickle&quot;</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_pickle</span><span class=\"p\">(</span><span class=\"n\">file_options</span><span class=\"p\">[</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">])</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;Unsupported file_type </span><span class=\"si\">{file_type}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">file_type</span><span class=\"o\">=</span><span class=\"n\">file_type</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">df_type_check</span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">TypeCheck</span><span class=\"p\">(</span><span class=\"n\">success</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">TypeCheck</span><span class=\"p\">(</span>\n        <span class=\"n\">success</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n        <span class=\"n\">metadata_entries</span><span class=\"o\">=</span><span class=\"p\">[</span>\n            <span class=\"n\">EventMetadataEntry</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)),</span> <span class=\"s2\">&quot;row_count&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Number of rows in DataFrame&quot;</span><span class=\"p\">),</span>\n            <span class=\"c1\"># string cast columns since they may be things like datetime</span>\n            <span class=\"n\">EventMetadataEntry</span><span class=\"o\">.</span><span class=\"n\">json</span><span class=\"p\">({</span><span class=\"s2\">&quot;columns&quot;</span><span class=\"p\">:</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">columns</span><span class=\"p\">))},</span> <span class=\"s2\">&quot;metadata&quot;</span><span class=\"p\">),</span>\n        <span class=\"p\">],</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"n\">DataFrame</span> <span class=\"o\">=</span> <span class=\"n\">DagsterType</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;PandasDataFrame&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;&quot;Two-dimensional size-mutable, potentially heterogeneous</span>\n<span class=\"s2\">    tabular data structure with labeled axes (rows and columns).</span>\n<span class=\"s2\">    See http://pandas.pydata.org/&quot;&quot;&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">loader</span><span class=\"o\">=</span><span class=\"n\">dataframe_loader</span><span class=\"p\">,</span>\n    <span class=\"n\">materializer</span><span class=\"o\">=</span><span class=\"n\">dataframe_materializer</span><span class=\"p\">,</span>\n    <span class=\"n\">type_check_fn</span><span class=\"o\">=</span><span class=\"n\">df_type_check</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_construct_constraint_list</span><span class=\"p\">(</span><span class=\"n\">constraints</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"nf\">add_bullet</span><span class=\"p\">(</span><span class=\"n\">constraint_list</span><span class=\"p\">,</span> <span class=\"n\">constraint_description</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">constraint_list</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;+ </span><span class=\"si\">{constraint_description}</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n            <span class=\"n\">constraint_description</span><span class=\"o\">=</span><span class=\"n\">constraint_description</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">constraint_list</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&quot;</span>\n    <span class=\"k\">for</span> <span class=\"n\">constraint</span> <span class=\"ow\">in</span> <span class=\"n\">constraints</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">constraint</span><span class=\"o\">.</span><span class=\"vm\">__class__</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">CONSTRAINT_BLACKLIST</span><span class=\"p\">:</span>\n            <span class=\"n\">constraint_list</span> <span class=\"o\">=</span> <span class=\"n\">add_bullet</span><span class=\"p\">(</span><span class=\"n\">constraint_list</span><span class=\"p\">,</span> <span class=\"n\">constraint</span><span class=\"o\">.</span><span class=\"n\">markdown_description</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">constraint_list</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_build_column_header</span><span class=\"p\">(</span><span class=\"n\">column_name</span><span class=\"p\">,</span> <span class=\"n\">constraints</span><span class=\"p\">):</span>\n    <span class=\"n\">header</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;**</span><span class=\"si\">{column_name}</span><span class=\"s2\">**&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">column_name</span><span class=\"o\">=</span><span class=\"n\">column_name</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">constraint</span> <span class=\"ow\">in</span> <span class=\"n\">constraints</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">constraint</span><span class=\"p\">,</span> <span class=\"n\">ColumnDTypeInSetConstraint</span><span class=\"p\">):</span>\n            <span class=\"n\">dtypes_tuple</span> <span class=\"o\">=</span> <span class=\"nb\">tuple</span><span class=\"p\">(</span><span class=\"n\">constraint</span><span class=\"o\">.</span><span class=\"n\">expected_dtype_set</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">header</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;: `</span><span class=\"si\">{expected_dtypes}</span><span class=\"s2\">`&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"n\">expected_dtypes</span><span class=\"o\">=</span><span class=\"n\">dtypes_tuple</span> <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">dtypes_tuple</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">1</span> <span class=\"k\">else</span> <span class=\"n\">dtypes_tuple</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">constraint</span><span class=\"p\">,</span> <span class=\"n\">ColumnDTypeFnConstraint</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"n\">header</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;: Validator `</span><span class=\"si\">{expected_dtype_fn}</span><span class=\"s2\">`&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                <span class=\"n\">expected_dtype_fn</span><span class=\"o\">=</span><span class=\"n\">constraint</span><span class=\"o\">.</span><span class=\"n\">type_fn</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n            <span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">header</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">create_dagster_pandas_dataframe_description</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"n\">columns</span><span class=\"p\">):</span>\n    <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">([</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"s2\">&quot;### Columns&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">])</span>\n    <span class=\"n\">buildme</span> <span class=\"o\">=</span> <span class=\"n\">title</span>\n    <span class=\"k\">for</span> <span class=\"n\">column</span> <span class=\"ow\">in</span> <span class=\"n\">columns</span><span class=\"p\">:</span>\n        <span class=\"n\">buildme</span> <span class=\"o\">+=</span> <span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"se\">\\n</span><span class=\"si\">{}</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n            <span class=\"n\">_build_column_header</span><span class=\"p\">(</span><span class=\"n\">column</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">column</span><span class=\"o\">.</span><span class=\"n\">constraints</span><span class=\"p\">),</span>\n            <span class=\"n\">_construct_constraint_list</span><span class=\"p\">(</span><span class=\"n\">column</span><span class=\"o\">.</span><span class=\"n\">constraints</span><span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">buildme</span>\n\n\n<div class=\"viewcode-block\" id=\"create_dagster_pandas_dataframe_type\"><a class=\"viewcode-back\" href=\"../../../sections/api/apidocs/libraries/dagster_pandas/#dagster_pandas.create_dagster_pandas_dataframe_type\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">create_dagster_pandas_dataframe_type</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"p\">,</span>\n    <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">columns</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">event_metadata_fn</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">dataframe_constraints</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">loader</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">materializer</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">input_hydration_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">output_materialization_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Constructs a custom pandas dataframe dagster type.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (str): Name of the dagster pandas type.</span>\n<span class=\"sd\">        description (Optional[str]): A markdown-formatted string, displayed in tooling.</span>\n<span class=\"sd\">        columns (Optional[List[PandasColumn]]): A list of :py:class:`~dagster.PandasColumn` objects</span>\n<span class=\"sd\">            which express dataframe column schemas and constraints.</span>\n<span class=\"sd\">        event_metadata_fn (Optional[func]): A callable which takes your dataframe and returns a list of EventMetadata</span>\n<span class=\"sd\">            which allow you to express things like summary statistics during runtime.</span>\n<span class=\"sd\">        dataframe_constraints (Optional[List[DataFrameConstraint]]): A list of objects that inherit from</span>\n<span class=\"sd\">            :py:class:`~dagster.DataFrameConstraint`. This allows you to express dataframe-level constraints.</span>\n<span class=\"sd\">        loader (Optional[DagsterTypeLoader]): An instance of a class that</span>\n<span class=\"sd\">            inherits from :py:class:`~dagster.DagsterTypeLoader`. If None, we will default</span>\n<span class=\"sd\">            to using `dataframe_loader`.</span>\n<span class=\"sd\">        materializer (Optional[DagsterTypeMaterializer]): An instance of a class</span>\n<span class=\"sd\">            that inherits from :py:class:`~dagster.DagsterTypeMaterializer`. If None, we will</span>\n<span class=\"sd\">            default to using `dataframe_materializer`.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"c1\"># We allow for the plugging in of dagster_type_loaders/materializers so that</span>\n    <span class=\"c1\"># Users can load and matrerialize their custom dataframes via configuration their own way if the default</span>\n    <span class=\"c1\"># configs don&#39;t suffice. This is purely optional.</span>\n    <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">str_param</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">event_metadata_fn</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_callable_param</span><span class=\"p\">(</span><span class=\"n\">event_metadata_fn</span><span class=\"p\">,</span> <span class=\"s2\">&quot;event_metadata_fn&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">description</span> <span class=\"o\">=</span> <span class=\"n\">create_dagster_pandas_dataframe_description</span><span class=\"p\">(</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"s2\">&quot;description&quot;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">),</span>\n        <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_list_param</span><span class=\"p\">(</span><span class=\"n\">columns</span><span class=\"p\">,</span> <span class=\"s2\">&quot;columns&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"n\">PandasColumn</span><span class=\"p\">),</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_dagster_type_check</span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"n\">TypeCheck</span><span class=\"p\">(</span>\n                <span class=\"n\">success</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n                <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Must be a pandas.DataFrame. Got value of type. </span><span class=\"si\">{type_name}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">type_name</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n                <span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">validate_constraints</span><span class=\"p\">(</span>\n                <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">pandas_columns</span><span class=\"o\">=</span><span class=\"n\">columns</span><span class=\"p\">,</span> <span class=\"n\">dataframe_constraints</span><span class=\"o\">=</span><span class=\"n\">dataframe_constraints</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"n\">ConstraintViolationException</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">TypeCheck</span><span class=\"p\">(</span><span class=\"n\">success</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">))</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">TypeCheck</span><span class=\"p\">(</span>\n            <span class=\"n\">success</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n            <span class=\"n\">metadata_entries</span><span class=\"o\">=</span><span class=\"n\">_execute_summary_stats</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">event_metadata_fn</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">event_metadata_fn</span>\n            <span class=\"k\">else</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">loader_</span> <span class=\"o\">=</span> <span class=\"n\">canonicalize_backcompat_args</span><span class=\"p\">(</span>\n        <span class=\"n\">loader</span><span class=\"p\">,</span> <span class=\"s2\">&quot;loader&quot;</span><span class=\"p\">,</span> <span class=\"n\">input_hydration_config</span><span class=\"p\">,</span> <span class=\"s2\">&quot;input_hydration_config&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;0.10.0&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">materializer_</span> <span class=\"o\">=</span> <span class=\"n\">canonicalize_backcompat_args</span><span class=\"p\">(</span>\n        <span class=\"n\">materializer</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;materializer&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">output_materialization_config</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;output_materialization_config&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;0.10.0&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">DagsterType</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n        <span class=\"n\">type_check_fn</span><span class=\"o\">=</span><span class=\"n\">_dagster_type_check</span><span class=\"p\">,</span>\n        <span class=\"n\">loader</span><span class=\"o\">=</span><span class=\"n\">loader_</span> <span class=\"k\">if</span> <span class=\"n\">loader_</span> <span class=\"k\">else</span> <span class=\"n\">dataframe_loader</span><span class=\"p\">,</span>\n        <span class=\"n\">materializer</span><span class=\"o\">=</span><span class=\"n\">materializer_</span> <span class=\"k\">if</span> <span class=\"n\">materializer_</span> <span class=\"k\">else</span> <span class=\"n\">dataframe_materializer</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">description</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@experimental</span>\n<span class=\"k\">def</span> <span class=\"nf\">create_structured_dataframe_type</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"p\">,</span>\n    <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">columns_validator</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">columns_aggregate_validator</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">dataframe_validator</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">loader</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">materializer</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">input_hydration_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">output_materialization_config</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (str): the name of the new type</span>\n<span class=\"sd\">        description (Optional[str]): the description of the new type</span>\n<span class=\"sd\">        columns_validator (Optional[Union[ColumnConstraintWithMetadata, MultiColumnConstraintWithMetadata]]):</span>\n<span class=\"sd\">                    what column-level row by row validation you want to have applied.</span>\n<span class=\"sd\">                    Leave empty for no column-level row by row validation.</span>\n<span class=\"sd\">        columns_aggregate_validator (Optional[Union[ColumnAggregateConstraintWithMetadata,</span>\n<span class=\"sd\">                                    MultiAggregateConstraintWithMetadata]]):</span>\n<span class=\"sd\">                    what column-level aggregate validation you want to have applied,</span>\n<span class=\"sd\">                    Leave empty for no column-level aggregate validation.</span>\n<span class=\"sd\">        dataframe_validator (Optional[Union[ConstraintWithMetadata, MultiConstraintWithMetadata]]):</span>\n<span class=\"sd\">                    what dataframe-wide validation you want to have applied.</span>\n<span class=\"sd\">                    Leave empty for no dataframe-wide validation.</span>\n<span class=\"sd\">        loader (Optional[DagsterTypeLoader]): An instance of a class that</span>\n<span class=\"sd\">            inherits from :py:class:`~dagster.DagsterTypeLoader`. If None, we will default</span>\n<span class=\"sd\">            to using `dataframe_loader`.</span>\n<span class=\"sd\">        materializer (Optional[DagsterTypeMaterializer]): An instance of a class</span>\n<span class=\"sd\">            that inherits from :py:class:`~dagster.DagsterTypeMaterializer`. If None, we will</span>\n<span class=\"sd\">            default to using `dataframe_materializer`.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        a DagsterType with the corresponding name and packaged validation.</span>\n\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_dagster_type_check</span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"n\">TypeCheck</span><span class=\"p\">(</span>\n                <span class=\"n\">success</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n                <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Must be a pandas.DataFrame. Got value of type. </span><span class=\"si\">{type_name}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">type_name</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n                <span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n        <span class=\"n\">individual_result_dict</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">dataframe_validator</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">individual_result_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;dataframe&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">dataframe_validator</span><span class=\"o\">.</span><span class=\"n\">validate</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">columns_validator</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">individual_result_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;columns&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">columns_validator</span><span class=\"o\">.</span><span class=\"n\">validate</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">columns_aggregate_validator</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">individual_result_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;column-aggregates&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">columns_aggregate_validator</span><span class=\"o\">.</span><span class=\"n\">validate</span><span class=\"p\">(</span>\n                <span class=\"n\">value</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"n\">typechecks_succeeded</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n        <span class=\"n\">metadata</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">overall_description</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;Failed Constraints: </span><span class=\"si\">{}</span><span class=\"s2\">&quot;</span>\n        <span class=\"n\">constraint_clauses</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">result</span> <span class=\"ow\">in</span> <span class=\"n\">individual_result_dict</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"n\">result_val</span> <span class=\"o\">=</span> <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">success</span>\n            <span class=\"k\">if</span> <span class=\"n\">result_val</span><span class=\"p\">:</span>\n                <span class=\"k\">continue</span>\n            <span class=\"n\">typechecks_succeeded</span> <span class=\"o\">=</span> <span class=\"n\">typechecks_succeeded</span> <span class=\"ow\">and</span> <span class=\"n\">result_val</span>\n            <span class=\"n\">result_dict</span> <span class=\"o\">=</span> <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">metadata_entries</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">entry_data</span><span class=\"o\">.</span><span class=\"n\">data</span>\n            <span class=\"n\">metadata</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                <span class=\"n\">EventMetadataEntry</span><span class=\"o\">.</span><span class=\"n\">json</span><span class=\"p\">(</span><span class=\"n\">result_dict</span><span class=\"p\">,</span> <span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\">-constraint-metadata&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">),)</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">constraint_clauses</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\"> failing constraints, </span><span class=\"si\">{}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">description</span><span class=\"p\">))</span>\n        <span class=\"c1\"># returns aggregates, then column, then dataframe</span>\n        <span class=\"k\">return</span> <span class=\"n\">TypeCheck</span><span class=\"p\">(</span>\n            <span class=\"n\">success</span><span class=\"o\">=</span><span class=\"n\">typechecks_succeeded</span><span class=\"p\">,</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">overall_description</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">constraint_clauses</span><span class=\"p\">),</span>\n            <span class=\"n\">metadata_entries</span><span class=\"o\">=</span><span class=\"nb\">sorted</span><span class=\"p\">(</span><span class=\"n\">metadata</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">label</span><span class=\"p\">),</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">description</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">opt_str_param</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"p\">,</span> <span class=\"s2\">&quot;description&quot;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">loader_</span> <span class=\"o\">=</span> <span class=\"n\">canonicalize_backcompat_args</span><span class=\"p\">(</span>\n        <span class=\"n\">loader</span><span class=\"p\">,</span> <span class=\"s2\">&quot;loader&quot;</span><span class=\"p\">,</span> <span class=\"n\">input_hydration_config</span><span class=\"p\">,</span> <span class=\"s2\">&quot;input_hydration_config&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;0.10.0&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">materializer_</span> <span class=\"o\">=</span> <span class=\"n\">canonicalize_backcompat_args</span><span class=\"p\">(</span>\n        <span class=\"n\">materializer</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;materializer&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">output_materialization_config</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;output_materialization_config&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;0.10.0&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">DagsterType</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n        <span class=\"n\">type_check_fn</span><span class=\"o\">=</span><span class=\"n\">_dagster_type_check</span><span class=\"p\">,</span>\n        <span class=\"n\">loader</span><span class=\"o\">=</span><span class=\"n\">loader_</span> <span class=\"k\">if</span> <span class=\"n\">loader_</span> <span class=\"k\">else</span> <span class=\"n\">dataframe_loader</span><span class=\"p\">,</span>\n        <span class=\"n\">materializer</span><span class=\"o\">=</span><span class=\"n\">materializer_</span> <span class=\"k\">if</span> <span class=\"n\">materializer_</span> <span class=\"k\">else</span> <span class=\"n\">dataframe_materializer</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">description</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_execute_summary_stats</span><span class=\"p\">(</span><span class=\"n\">type_name</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">event_metadata_fn</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">event_metadata_fn</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"p\">[]</span>\n\n    <span class=\"n\">metadata_entries</span> <span class=\"o\">=</span> <span class=\"n\">event_metadata_fn</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"p\">(</span>\n        <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">metadata_entries</span><span class=\"p\">,</span> <span class=\"nb\">list</span><span class=\"p\">)</span>\n        <span class=\"ow\">and</span> <span class=\"nb\">all</span><span class=\"p\">(</span><span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">EventMetadataEntry</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"n\">metadata_entries</span><span class=\"p\">)</span>\n    <span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">DagsterInvariantViolationError</span><span class=\"p\">(</span>\n            <span class=\"p\">(</span>\n                <span class=\"s2\">&quot;The return value of the user-defined summary_statistics function &quot;</span>\n                <span class=\"s2\">&quot;for pandas data frame type </span><span class=\"si\">{type_name}</span><span class=\"s2\"> returned </span><span class=\"si\">{value}</span><span class=\"s2\">. &quot;</span>\n                <span class=\"s2\">&quot;This function must return List[EventMetadataEntry]&quot;</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">type_name</span><span class=\"o\">=</span><span class=\"n\">type_name</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"nb\">repr</span><span class=\"p\">(</span><span class=\"n\">metadata_entries</span><span class=\"p\">))</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">metadata_entries</span>\n</pre></div>", "current_page_name": "_modules/dagster_pandas/data_frame", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}