{"parents": [{"link": "../../../", "title": "Module code"}], "title": "dagster_aws.s3.resources", "body": "<h1>Source code for dagster_aws.s3.resources</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">Field</span><span class=\"p\">,</span> <span class=\"n\">StringSource</span><span class=\"p\">,</span> <span class=\"n\">resource</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.merger</span> <span class=\"kn\">import</span> <span class=\"n\">merge_dicts</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.file_manager</span> <span class=\"kn\">import</span> <span class=\"n\">S3FileManager</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.utils</span> <span class=\"kn\">import</span> <span class=\"n\">construct_s3_client</span>\n\n<span class=\"n\">S3_SESSION_CONFIG</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&quot;use_unsigned_session&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n        <span class=\"nb\">bool</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Specifies whether to use an unsigned S3 session&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n        <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"p\">),</span>\n    <span class=\"s2\">&quot;region_name&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n        <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Specifies a custom region for the S3 session&quot;</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span>\n    <span class=\"p\">),</span>\n    <span class=\"s2\">&quot;endpoint_url&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n        <span class=\"n\">StringSource</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Specifies a custom endpoint for the S3 session&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"p\">),</span>\n    <span class=\"s2\">&quot;max_attempts&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n        <span class=\"nb\">int</span><span class=\"p\">,</span>\n        <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;This provides Boto3&#39;s retry handler with a value of maximum retry attempts, &quot;</span>\n        <span class=\"s2\">&quot;where the initial call counts toward the max_attempts value that you provide&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n        <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"mi\">5</span><span class=\"p\">,</span>\n    <span class=\"p\">),</span>\n<span class=\"p\">}</span>\n\n\n<div class=\"viewcode-block\" id=\"s3_resource\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_aws/#dagster_aws.s3.s3_resource\">[docs]</a><span class=\"nd\">@resource</span><span class=\"p\">(</span><span class=\"n\">S3_SESSION_CONFIG</span><span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">s3_resource</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Resource that gives solids access to S3.</span>\n\n<span class=\"sd\">    The underlying S3 session is created by calling :py:func:`boto3.resource(&#39;s3&#39;) &lt;boto3:boto3.resource&gt;`.</span>\n\n<span class=\"sd\">    Attach this resource definition to a :py:class:`~dagster.ModeDefinition` in order to make it</span>\n<span class=\"sd\">    available to your solids.</span>\n\n<span class=\"sd\">    Example:</span>\n\n<span class=\"sd\">        .. code-block:: python</span>\n\n<span class=\"sd\">            from dagster import ModeDefinition, execute_solid, solid</span>\n<span class=\"sd\">            from dagster_aws.s3 import s3_resource</span>\n\n<span class=\"sd\">            @solid(required_resource_keys={&#39;s3&#39;})</span>\n<span class=\"sd\">            def example_s3_solid(context):</span>\n<span class=\"sd\">                return context.resources.s3.list_objects_v2(</span>\n<span class=\"sd\">                    Bucket=&#39;my-bucket&#39;,</span>\n<span class=\"sd\">                    Prefix=&#39;some-key&#39;</span>\n<span class=\"sd\">                )</span>\n\n<span class=\"sd\">            result = execute_solid(</span>\n<span class=\"sd\">                example_s3_solid,</span>\n<span class=\"sd\">                run_config={</span>\n<span class=\"sd\">                    &#39;resources&#39;: {</span>\n<span class=\"sd\">                        &#39;s3&#39;: {</span>\n<span class=\"sd\">                            &#39;config&#39;: {</span>\n<span class=\"sd\">                                &#39;region_name&#39;: &#39;us-west-1&#39;,</span>\n<span class=\"sd\">                            }</span>\n<span class=\"sd\">                        }</span>\n<span class=\"sd\">                    }</span>\n<span class=\"sd\">                },</span>\n<span class=\"sd\">                mode_def=ModeDefinition(resource_defs={&#39;s3&#39;: s3_resource}),</span>\n<span class=\"sd\">            )</span>\n\n<span class=\"sd\">    Note that your solids must also declare that they require this resource with</span>\n<span class=\"sd\">    `required_resource_keys`, or it will not be initialized for the execution of their compute</span>\n<span class=\"sd\">    functions.</span>\n\n<span class=\"sd\">    You may configure this resource as follows:</span>\n\n<span class=\"sd\">    .. code-block:: YAML</span>\n\n<span class=\"sd\">        resources:</span>\n<span class=\"sd\">          s3:</span>\n<span class=\"sd\">            config:</span>\n<span class=\"sd\">              region_name: &quot;us-west-1&quot;</span>\n<span class=\"sd\">              # Optional[str]: Specifies a custom region for the S3 session. Default is chosen</span>\n<span class=\"sd\">              # through the ordinary boto credential chain.</span>\n<span class=\"sd\">              use_unsigned_session: false</span>\n<span class=\"sd\">              # Optional[bool]: Specifies whether to use an unsigned S3 session. Default: True</span>\n<span class=\"sd\">              endpoint_url: &quot;http://localhost&quot;</span>\n<span class=\"sd\">              # Optional[str]: Specifies a custom endpoint for the S3 session. Default is None.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">return</span> <span class=\"n\">construct_s3_client</span><span class=\"p\">(</span>\n        <span class=\"n\">max_attempts</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;max_attempts&quot;</span><span class=\"p\">],</span>\n        <span class=\"n\">region_name</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;region_name&quot;</span><span class=\"p\">),</span>\n        <span class=\"n\">endpoint_url</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;endpoint_url&quot;</span><span class=\"p\">),</span>\n        <span class=\"n\">use_unsigned_session</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;use_unsigned_session&quot;</span><span class=\"p\">],</span>\n    <span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@resource</span><span class=\"p\">(</span>\n    <span class=\"n\">merge_dicts</span><span class=\"p\">(</span>\n        <span class=\"n\">S3_SESSION_CONFIG</span><span class=\"p\">,</span>\n        <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;s3_bucket&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;s3_prefix&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"s2\">&quot;dagster&quot;</span><span class=\"p\">),</span>\n        <span class=\"p\">},</span>\n    <span class=\"p\">)</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">s3_file_manager</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">S3FileManager</span><span class=\"p\">(</span>\n        <span class=\"n\">s3_session</span><span class=\"o\">=</span><span class=\"n\">construct_s3_client</span><span class=\"p\">(</span>\n            <span class=\"n\">max_attempts</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;max_attempts&quot;</span><span class=\"p\">],</span>\n            <span class=\"n\">region_name</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;region_name&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">endpoint_url</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;endpoint_url&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">use_unsigned_session</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;use_unsigned_session&quot;</span><span class=\"p\">],</span>\n        <span class=\"p\">),</span>\n        <span class=\"n\">s3_bucket</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;s3_bucket&quot;</span><span class=\"p\">],</span>\n        <span class=\"n\">s3_base_key</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;s3_prefix&quot;</span><span class=\"p\">],</span>\n    <span class=\"p\">)</span>\n</pre></div>", "current_page_name": "_modules/dagster_aws/s3/resources", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}