{"parents": [{"link": "../../../", "title": "Module code"}], "title": "dagster_gcp.gcs.resources", "body": "<h1>Source code for dagster_gcp.gcs.resources</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">Field</span><span class=\"p\">,</span> <span class=\"n\">Noneable</span><span class=\"p\">,</span> <span class=\"n\">StringSource</span><span class=\"p\">,</span> <span class=\"n\">resource</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.utils.merger</span> <span class=\"kn\">import</span> <span class=\"n\">merge_dicts</span>\n<span class=\"kn\">from</span> <span class=\"nn\">google.cloud</span> <span class=\"kn\">import</span> <span class=\"n\">storage</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.file_manager</span> <span class=\"kn\">import</span> <span class=\"n\">GCSFileManager</span>\n\n<span class=\"n\">GCS_CLIENT_CONFIG</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&quot;project&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">Noneable</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">),</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Project name&quot;</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n\n<div class=\"viewcode-block\" id=\"gcs_resource\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.gcs_resource\">[docs]</a><span class=\"nd\">@resource</span><span class=\"p\">(</span>\n    <span class=\"n\">GCS_CLIENT_CONFIG</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;This resource provides a GCS client&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">gcs_resource</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">_gcs_client_from_config</span><span class=\"p\">(</span><span class=\"n\">init_context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@resource</span><span class=\"p\">(</span>\n    <span class=\"n\">merge_dicts</span><span class=\"p\">(</span>\n        <span class=\"n\">GCS_CLIENT_CONFIG</span><span class=\"p\">,</span>\n        <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;gcs_bucket&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;gcs_prefix&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span><span class=\"n\">StringSource</span><span class=\"p\">,</span> <span class=\"n\">is_required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"s2\">&quot;dagster&quot;</span><span class=\"p\">),</span>\n        <span class=\"p\">},</span>\n    <span class=\"p\">)</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">gcs_file_manager</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">):</span>\n    <span class=\"n\">gcs_client</span> <span class=\"o\">=</span> <span class=\"n\">_gcs_client_from_config</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">GCSFileManager</span><span class=\"p\">(</span>\n        <span class=\"n\">client</span><span class=\"o\">=</span><span class=\"n\">gcs_client</span><span class=\"p\">,</span>\n        <span class=\"n\">gcs_bucket</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;gcs_bucket&quot;</span><span class=\"p\">],</span>\n        <span class=\"n\">gcs_base_key</span><span class=\"o\">=</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"p\">[</span><span class=\"s2\">&quot;gcs_prefix&quot;</span><span class=\"p\">],</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_gcs_client_from_config</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        config: A configuration containing the fields in GCS_CLIENT_CONFIG.</span>\n\n<span class=\"sd\">    Returns: A GCS client.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">project</span> <span class=\"o\">=</span> <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;project&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">storage</span><span class=\"o\">.</span><span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">Client</span><span class=\"p\">(</span><span class=\"n\">project</span><span class=\"o\">=</span><span class=\"n\">project</span><span class=\"p\">)</span>\n</pre></div>", "current_page_name": "_modules/dagster_gcp/gcs/resources", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}