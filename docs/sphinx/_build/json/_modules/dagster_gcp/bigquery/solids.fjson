{"parents": [{"link": "../../../", "title": "Module code"}], "title": "dagster_gcp.bigquery.solids", "body": "<h1>Source code for dagster_gcp.bigquery.solids</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">InputDefinition</span><span class=\"p\">,</span> <span class=\"n\">List</span><span class=\"p\">,</span> <span class=\"n\">Nothing</span><span class=\"p\">,</span> <span class=\"n\">OutputDefinition</span><span class=\"p\">,</span> <span class=\"n\">check</span><span class=\"p\">,</span> <span class=\"n\">solid</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster_pandas</span> <span class=\"kn\">import</span> <span class=\"n\">DataFrame</span>\n<span class=\"kn\">from</span> <span class=\"nn\">google.cloud.bigquery.job</span> <span class=\"kn\">import</span> <span class=\"n\">LoadJobConfig</span><span class=\"p\">,</span> <span class=\"n\">QueryJobConfig</span>\n<span class=\"kn\">from</span> <span class=\"nn\">google.cloud.bigquery.table</span> <span class=\"kn\">import</span> <span class=\"n\">EncryptionConfiguration</span><span class=\"p\">,</span> <span class=\"n\">TimePartitioning</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.configs</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">define_bigquery_create_dataset_config</span><span class=\"p\">,</span>\n    <span class=\"n\">define_bigquery_delete_dataset_config</span><span class=\"p\">,</span>\n    <span class=\"n\">define_bigquery_load_config</span><span class=\"p\">,</span>\n    <span class=\"n\">define_bigquery_query_config</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.types</span> <span class=\"kn\">import</span> <span class=\"n\">BigQueryLoadSource</span>\n\n<span class=\"n\">_START</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;start&quot;</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_preprocess_config</span><span class=\"p\">(</span><span class=\"n\">cfg</span><span class=\"p\">):</span>\n    <span class=\"n\">destination_encryption_configuration</span> <span class=\"o\">=</span> <span class=\"n\">cfg</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;destination_encryption_configuration&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">time_partitioning</span> <span class=\"o\">=</span> <span class=\"n\">cfg</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;time_partitioning&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">destination_encryption_configuration</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">cfg</span><span class=\"p\">[</span><span class=\"s2\">&quot;destination_encryption_configuration&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">EncryptionConfiguration</span><span class=\"p\">(</span>\n            <span class=\"n\">kms_key_name</span><span class=\"o\">=</span><span class=\"n\">destination_encryption_configuration</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">time_partitioning</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">cfg</span><span class=\"p\">[</span><span class=\"s2\">&quot;time_partitioning&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">TimePartitioning</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">time_partitioning</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">cfg</span>\n\n\n<div class=\"viewcode-block\" id=\"bq_solid_for_queries\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.bq_solid_for_queries\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">bq_solid_for_queries</span><span class=\"p\">(</span><span class=\"n\">sql_queries</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Executes BigQuery SQL queries.</span>\n\n<span class=\"sd\">    Expects a BQ client to be provisioned in resources as context.resources.bigquery.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"n\">sql_queries</span> <span class=\"o\">=</span> <span class=\"n\">check</span><span class=\"o\">.</span><span class=\"n\">list_param</span><span class=\"p\">(</span><span class=\"n\">sql_queries</span><span class=\"p\">,</span> <span class=\"s2\">&quot;sql queries&quot;</span><span class=\"p\">,</span> <span class=\"n\">of_type</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">)</span>\n\n    <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">query</span> <span class=\"ow\">in</span> <span class=\"n\">sql_queries</span><span class=\"p\">:</span>\n        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">())</span>\n    <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;bq_solid_</span><span class=\"si\">{hash}</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"nb\">hash</span><span class=\"o\">=</span><span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span><span class=\"p\">()[:</span><span class=\"mi\">10</span><span class=\"p\">])</span>\n\n    <span class=\"nd\">@solid</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n        <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">InputDefinition</span><span class=\"p\">(</span><span class=\"n\">_START</span><span class=\"p\">,</span> <span class=\"n\">Nothing</span><span class=\"p\">)],</span>\n        <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">OutputDefinition</span><span class=\"p\">(</span><span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">DataFrame</span><span class=\"p\">])],</span>\n        <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">define_bigquery_query_config</span><span class=\"p\">(),</span>\n        <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;bigquery&quot;</span><span class=\"p\">},</span>\n        <span class=\"n\">tags</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;kind&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;sql&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;sql&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">sql_queries</span><span class=\"p\">)},</span>\n    <span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_solid</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">):</span>  <span class=\"c1\"># pylint: disable=unused-argument</span>\n        <span class=\"n\">query_job_config</span> <span class=\"o\">=</span> <span class=\"n\">_preprocess_config</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">solid_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;query_job_config&quot;</span><span class=\"p\">,</span> <span class=\"p\">{}))</span>\n\n        <span class=\"c1\"># Retrieve results as pandas DataFrames</span>\n        <span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">sql_query</span> <span class=\"ow\">in</span> <span class=\"n\">sql_queries</span><span class=\"p\">:</span>\n            <span class=\"c1\"># We need to construct a new QueryJobConfig for each query.</span>\n            <span class=\"c1\"># See: https://bit.ly/2VjD6sl</span>\n            <span class=\"n\">cfg</span> <span class=\"o\">=</span> <span class=\"n\">QueryJobConfig</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">query_job_config</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">query_job_config</span> <span class=\"k\">else</span> <span class=\"kc\">None</span>\n            <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;executing query </span><span class=\"si\">%s</span><span class=\"s2\"> with config: </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span>\n                <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">sql_query</span><span class=\"p\">,</span> <span class=\"n\">cfg</span><span class=\"o\">.</span><span class=\"n\">to_api_repr</span><span class=\"p\">()</span> <span class=\"k\">if</span> <span class=\"n\">cfg</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;(no config provided)&quot;</span><span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">results</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">bigquery</span><span class=\"o\">.</span><span class=\"n\">query</span><span class=\"p\">(</span><span class=\"n\">sql_query</span><span class=\"p\">,</span> <span class=\"n\">job_config</span><span class=\"o\">=</span><span class=\"n\">cfg</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">to_dataframe</span><span class=\"p\">()</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">results</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">_solid</span></div>\n\n\n<span class=\"n\">BIGQUERY_LOAD_CONFIG</span> <span class=\"o\">=</span> <span class=\"n\">define_bigquery_load_config</span><span class=\"p\">()</span>\n\n\n<div class=\"viewcode-block\" id=\"import_gcs_paths_to_bq\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.import_gcs_paths_to_bq\">[docs]</a><span class=\"nd\">@solid</span><span class=\"p\">(</span>\n    <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">InputDefinition</span><span class=\"p\">(</span><span class=\"s2\">&quot;paths&quot;</span><span class=\"p\">,</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">])],</span>\n    <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">OutputDefinition</span><span class=\"p\">(</span><span class=\"n\">Nothing</span><span class=\"p\">)],</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">BIGQUERY_LOAD_CONFIG</span><span class=\"p\">,</span>\n    <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;bigquery&quot;</span><span class=\"p\">},</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">import_gcs_paths_to_bq</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">paths</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">_execute_load_in_source</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">paths</span><span class=\"p\">,</span> <span class=\"n\">BigQueryLoadSource</span><span class=\"o\">.</span><span class=\"n\">GCS</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"import_df_to_bq\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.import_df_to_bq\">[docs]</a><span class=\"nd\">@solid</span><span class=\"p\">(</span>\n    <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">InputDefinition</span><span class=\"p\">(</span><span class=\"s2\">&quot;df&quot;</span><span class=\"p\">,</span> <span class=\"n\">DataFrame</span><span class=\"p\">)],</span>\n    <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">OutputDefinition</span><span class=\"p\">(</span><span class=\"n\">Nothing</span><span class=\"p\">)],</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">BIGQUERY_LOAD_CONFIG</span><span class=\"p\">,</span>\n    <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;bigquery&quot;</span><span class=\"p\">},</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">import_df_to_bq</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">df</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">_execute_load_in_source</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">df</span><span class=\"p\">,</span> <span class=\"n\">BigQueryLoadSource</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"import_file_to_bq\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.import_file_to_bq\">[docs]</a><span class=\"nd\">@solid</span><span class=\"p\">(</span>\n    <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">InputDefinition</span><span class=\"p\">(</span><span class=\"s2\">&quot;path&quot;</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">)],</span>\n    <span class=\"n\">output_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">OutputDefinition</span><span class=\"p\">(</span><span class=\"n\">Nothing</span><span class=\"p\">)],</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">BIGQUERY_LOAD_CONFIG</span><span class=\"p\">,</span>\n    <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;bigquery&quot;</span><span class=\"p\">},</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">import_file_to_bq</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">_execute_load_in_source</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">BigQueryLoadSource</span><span class=\"o\">.</span><span class=\"n\">File</span><span class=\"p\">)</span></div>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_execute_load_in_source</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">source</span><span class=\"p\">,</span> <span class=\"n\">source_name</span><span class=\"p\">):</span>\n    <span class=\"n\">destination</span> <span class=\"o\">=</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">solid_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;destination&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">load_job_config</span> <span class=\"o\">=</span> <span class=\"n\">_preprocess_config</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">solid_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;load_job_config&quot;</span><span class=\"p\">,</span> <span class=\"p\">{}))</span>\n    <span class=\"n\">cfg</span> <span class=\"o\">=</span> <span class=\"n\">LoadJobConfig</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">load_job_config</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">load_job_config</span> <span class=\"k\">else</span> <span class=\"kc\">None</span>\n\n    <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span>\n        <span class=\"s2\">&quot;executing BQ load with config: </span><span class=\"si\">%s</span><span class=\"s2\"> for source </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span>\n        <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">cfg</span><span class=\"o\">.</span><span class=\"n\">to_api_repr</span><span class=\"p\">()</span> <span class=\"k\">if</span> <span class=\"n\">cfg</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;(no config provided)&quot;</span><span class=\"p\">,</span> <span class=\"n\">source</span><span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">source_name</span> <span class=\"o\">==</span> <span class=\"n\">BigQueryLoadSource</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"p\">:</span>\n        <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">bigquery</span><span class=\"o\">.</span><span class=\"n\">load_table_from_dataframe</span><span class=\"p\">(</span>\n            <span class=\"n\">source</span><span class=\"p\">,</span> <span class=\"n\">destination</span><span class=\"p\">,</span> <span class=\"n\">job_config</span><span class=\"o\">=</span><span class=\"n\">cfg</span>\n        <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"p\">()</span>\n\n    <span class=\"c1\"># Load from file. See: https://cloud.google.com/bigquery/docs/loading-data-local</span>\n    <span class=\"k\">elif</span> <span class=\"n\">source_name</span> <span class=\"o\">==</span> <span class=\"n\">BigQueryLoadSource</span><span class=\"o\">.</span><span class=\"n\">File</span><span class=\"p\">:</span>\n        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">source</span><span class=\"p\">,</span> <span class=\"s2\">&quot;rb&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file_obj</span><span class=\"p\">:</span>\n            <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">bigquery</span><span class=\"o\">.</span><span class=\"n\">load_table_from_file</span><span class=\"p\">(</span>\n                <span class=\"n\">file_obj</span><span class=\"p\">,</span> <span class=\"n\">destination</span><span class=\"p\">,</span> <span class=\"n\">job_config</span><span class=\"o\">=</span><span class=\"n\">cfg</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"p\">()</span>\n\n    <span class=\"c1\"># Load from GCS. See: https://cloud.google.com/bigquery/docs/loading-data-cloud-storage</span>\n    <span class=\"k\">elif</span> <span class=\"n\">source_name</span> <span class=\"o\">==</span> <span class=\"n\">BigQueryLoadSource</span><span class=\"o\">.</span><span class=\"n\">GCS</span><span class=\"p\">:</span>\n        <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">bigquery</span><span class=\"o\">.</span><span class=\"n\">load_table_from_uri</span><span class=\"p\">(</span><span class=\"n\">source</span><span class=\"p\">,</span> <span class=\"n\">destination</span><span class=\"p\">,</span> <span class=\"n\">job_config</span><span class=\"o\">=</span><span class=\"n\">cfg</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"p\">()</span>\n\n\n<div class=\"viewcode-block\" id=\"bq_create_dataset\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.bq_create_dataset\">[docs]</a><span class=\"nd\">@solid</span><span class=\"p\">(</span>\n    <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">InputDefinition</span><span class=\"p\">(</span><span class=\"n\">_START</span><span class=\"p\">,</span> <span class=\"n\">Nothing</span><span class=\"p\">)],</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">define_bigquery_create_dataset_config</span><span class=\"p\">(),</span>\n    <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;bigquery&quot;</span><span class=\"p\">},</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">bq_create_dataset</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;BigQuery Create Dataset.</span>\n\n<span class=\"sd\">    This solid encapsulates creating a BigQuery dataset.</span>\n\n<span class=\"sd\">    Expects a BQ client to be provisioned in resources as context.resources.bigquery.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"p\">(</span><span class=\"n\">dataset</span><span class=\"p\">,</span> <span class=\"n\">exists_ok</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">solid_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s2\">&quot;dataset&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;exists_ok&quot;</span><span class=\"p\">)]</span>\n    <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">&quot;executing BQ create_dataset for dataset </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">dataset</span><span class=\"p\">))</span>\n    <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">bigquery</span><span class=\"o\">.</span><span class=\"n\">create_dataset</span><span class=\"p\">(</span><span class=\"n\">dataset</span><span class=\"p\">,</span> <span class=\"n\">exists_ok</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"bq_delete_dataset\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.bq_delete_dataset\">[docs]</a><span class=\"nd\">@solid</span><span class=\"p\">(</span>\n    <span class=\"n\">input_defs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">InputDefinition</span><span class=\"p\">(</span><span class=\"n\">_START</span><span class=\"p\">,</span> <span class=\"n\">Nothing</span><span class=\"p\">)],</span>\n    <span class=\"n\">config_schema</span><span class=\"o\">=</span><span class=\"n\">define_bigquery_delete_dataset_config</span><span class=\"p\">(),</span>\n    <span class=\"n\">required_resource_keys</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;bigquery&quot;</span><span class=\"p\">},</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">bq_delete_dataset</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;BigQuery Delete Dataset.</span>\n\n<span class=\"sd\">    This solid encapsulates deleting a BigQuery dataset.</span>\n\n<span class=\"sd\">    Expects a BQ client to be provisioned in resources as context.resources.bigquery.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"p\">(</span><span class=\"n\">dataset</span><span class=\"p\">,</span> <span class=\"n\">delete_contents</span><span class=\"p\">,</span> <span class=\"n\">not_found_ok</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n        <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">solid_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s2\">&quot;dataset&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;delete_contents&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;not_found_ok&quot;</span><span class=\"p\">)</span>\n    <span class=\"p\">]</span>\n\n    <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">&quot;executing BQ delete_dataset for dataset </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"n\">dataset</span><span class=\"p\">)</span>\n\n    <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">bigquery</span><span class=\"o\">.</span><span class=\"n\">delete_dataset</span><span class=\"p\">(</span>\n        <span class=\"n\">dataset</span><span class=\"p\">,</span> <span class=\"n\">delete_contents</span><span class=\"o\">=</span><span class=\"n\">delete_contents</span><span class=\"p\">,</span> <span class=\"n\">not_found_ok</span><span class=\"o\">=</span><span class=\"n\">not_found_ok</span>\n    <span class=\"p\">)</span></div>\n</pre></div>", "current_page_name": "_modules/dagster_gcp/bigquery/solids", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}