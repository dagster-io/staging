{"parents": [{"link": "../../../", "title": "Module code"}], "title": "dagster_gcp.bigquery.types", "body": "<h1>Source code for dagster_gcp.bigquery.types</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">re</span>\n<span class=\"kn\">from</span> <span class=\"nn\">enum</span> <span class=\"kn\">import</span> <span class=\"n\">Enum</span> <span class=\"k\">as</span> <span class=\"n\">PyEnum</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">Enum</span><span class=\"p\">,</span> <span class=\"n\">EnumValue</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster.config</span> <span class=\"kn\">import</span> <span class=\"n\">ConfigScalar</span><span class=\"p\">,</span> <span class=\"n\">ConfigScalarKind</span><span class=\"p\">,</span> <span class=\"n\">PostProcessingError</span>\n<span class=\"kn\">from</span> <span class=\"nn\">google.cloud.bigquery.job</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">CreateDisposition</span><span class=\"p\">,</span>\n    <span class=\"n\">Encoding</span><span class=\"p\">,</span>\n    <span class=\"n\">QueryPriority</span><span class=\"p\">,</span>\n    <span class=\"n\">SchemaUpdateOption</span><span class=\"p\">,</span>\n    <span class=\"n\">SourceFormat</span><span class=\"p\">,</span>\n    <span class=\"n\">WriteDisposition</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">BigQueryLoadSource</span><span class=\"p\">(</span><span class=\"n\">PyEnum</span><span class=\"p\">):</span>\n    <span class=\"n\">DataFrame</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;DATA_FRAME&quot;</span>\n    <span class=\"n\">GCS</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;GCS&quot;</span>\n    <span class=\"n\">File</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;FILE&quot;</span>\n\n\n<span class=\"n\">BQCreateDisposition</span> <span class=\"o\">=</span> <span class=\"n\">Enum</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;BQCreateDisposition&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">enum_values</span><span class=\"o\">=</span><span class=\"p\">[</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">CreateDisposition</span><span class=\"o\">.</span><span class=\"n\">CREATE_IF_NEEDED</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">CreateDisposition</span><span class=\"o\">.</span><span class=\"n\">CREATE_NEVER</span><span class=\"p\">),</span>\n    <span class=\"p\">],</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">BQPriority</span> <span class=\"o\">=</span> <span class=\"n\">Enum</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;BQPriority&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">enum_values</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">QueryPriority</span><span class=\"o\">.</span><span class=\"n\">BATCH</span><span class=\"p\">),</span> <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">QueryPriority</span><span class=\"o\">.</span><span class=\"n\">INTERACTIVE</span><span class=\"p\">)],</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">BQSchemaUpdateOption</span> <span class=\"o\">=</span> <span class=\"n\">Enum</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;BQSchemaUpdateOption&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">enum_values</span><span class=\"o\">=</span><span class=\"p\">[</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span>\n            <span class=\"n\">SchemaUpdateOption</span><span class=\"o\">.</span><span class=\"n\">ALLOW_FIELD_ADDITION</span><span class=\"p\">,</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Allow adding a nullable field to the schema.&quot;</span><span class=\"p\">,</span>\n        <span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span>\n            <span class=\"n\">SchemaUpdateOption</span><span class=\"o\">.</span><span class=\"n\">ALLOW_FIELD_RELAXATION</span><span class=\"p\">,</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;Allow relaxing a required field in the original schema to nullable.&quot;</span><span class=\"p\">,</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">],</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">BQWriteDisposition</span> <span class=\"o\">=</span> <span class=\"n\">Enum</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;BQWriteDisposition&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">enum_values</span><span class=\"o\">=</span><span class=\"p\">[</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">WriteDisposition</span><span class=\"o\">.</span><span class=\"n\">WRITE_APPEND</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">WriteDisposition</span><span class=\"o\">.</span><span class=\"n\">WRITE_EMPTY</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">WriteDisposition</span><span class=\"o\">.</span><span class=\"n\">WRITE_TRUNCATE</span><span class=\"p\">),</span>\n    <span class=\"p\">],</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">BQEncoding</span> <span class=\"o\">=</span> <span class=\"n\">Enum</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;BQEncoding&quot;</span><span class=\"p\">,</span> <span class=\"n\">enum_values</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">Encoding</span><span class=\"o\">.</span><span class=\"n\">ISO_8859_1</span><span class=\"p\">),</span> <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">Encoding</span><span class=\"o\">.</span><span class=\"n\">UTF_8</span><span class=\"p\">)]</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">BQSourceFormat</span> <span class=\"o\">=</span> <span class=\"n\">Enum</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;BQSourceFormat&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">enum_values</span><span class=\"o\">=</span><span class=\"p\">[</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">SourceFormat</span><span class=\"o\">.</span><span class=\"n\">AVRO</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">SourceFormat</span><span class=\"o\">.</span><span class=\"n\">CSV</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">SourceFormat</span><span class=\"o\">.</span><span class=\"n\">DATASTORE_BACKUP</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">SourceFormat</span><span class=\"o\">.</span><span class=\"n\">NEWLINE_DELIMITED_JSON</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">SourceFormat</span><span class=\"o\">.</span><span class=\"n\">ORC</span><span class=\"p\">),</span>\n        <span class=\"n\">EnumValue</span><span class=\"p\">(</span><span class=\"n\">SourceFormat</span><span class=\"o\">.</span><span class=\"n\">PARQUET</span><span class=\"p\">),</span>\n    <span class=\"p\">],</span>\n<span class=\"p\">)</span>\n\n\n<span class=\"c1\"># Project names are permitted to have alphanumeric, dashes and underscores, up to 1024 characters.</span>\n<span class=\"n\">RE_PROJECT</span> <span class=\"o\">=</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;[\\w\\d\\-\\_]{1,1024}&quot;</span>\n\n<span class=\"c1\"># Datasets and tables are permitted to have alphanumeric or underscores, no dashes allowed, up to</span>\n<span class=\"c1\"># 1024 characters</span>\n<span class=\"n\">RE_DS_TABLE</span> <span class=\"o\">=</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;[\\w\\d\\_]{1,1024}&quot;</span>\n\n<span class=\"c1\"># BigQuery supports writes directly to date partitions with the syntax foo.bar$20190101</span>\n<span class=\"n\">RE_PARTITION_SUFFIX</span> <span class=\"o\">=</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;(\\$\\d</span><span class=\"si\">{8}</span><span class=\"s2\">)?&quot;</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_is_valid_dataset</span><span class=\"p\">(</span><span class=\"n\">config_value</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Datasets must be of form &quot;project.dataset&quot; or &quot;dataset&quot;</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">return</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">match</span><span class=\"p\">(</span>\n        <span class=\"c1\"># regex matches: project.dataset -- OR -- dataset</span>\n        <span class=\"sa\">r</span><span class=\"s2\">&quot;^&quot;</span> <span class=\"o\">+</span> <span class=\"n\">RE_PROJECT</span> <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;\\.&quot;</span> <span class=\"o\">+</span> <span class=\"n\">RE_DS_TABLE</span> <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;$|^&quot;</span> <span class=\"o\">+</span> <span class=\"n\">RE_DS_TABLE</span> <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;$&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">config_value</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_is_valid_table</span><span class=\"p\">(</span><span class=\"n\">config_value</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Tables must be of form &quot;project.dataset.table&quot; or &quot;dataset.table&quot; with optional</span>\n<span class=\"sd\">    date-partition suffix</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">return</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">match</span><span class=\"p\">(</span>\n        <span class=\"sa\">r</span><span class=\"s2\">&quot;^&quot;</span>\n        <span class=\"o\">+</span> <span class=\"n\">RE_PROJECT</span>  <span class=\"c1\">#          project</span>\n        <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;\\.&quot;</span>  <span class=\"c1\">#               .</span>\n        <span class=\"o\">+</span> <span class=\"n\">RE_DS_TABLE</span>  <span class=\"c1\">#         dataset</span>\n        <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;\\.&quot;</span>  <span class=\"c1\">#               .</span>\n        <span class=\"o\">+</span> <span class=\"n\">RE_DS_TABLE</span>  <span class=\"c1\">#         table</span>\n        <span class=\"o\">+</span> <span class=\"n\">RE_PARTITION_SUFFIX</span>  <span class=\"c1\"># date partition suffix</span>\n        <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;$|^&quot;</span>  <span class=\"c1\">#              -- OR --</span>\n        <span class=\"o\">+</span> <span class=\"n\">RE_DS_TABLE</span>  <span class=\"c1\">#         dataset</span>\n        <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;\\.&quot;</span>  <span class=\"c1\">#               .</span>\n        <span class=\"o\">+</span> <span class=\"n\">RE_DS_TABLE</span>  <span class=\"c1\">#         table</span>\n        <span class=\"o\">+</span> <span class=\"n\">RE_PARTITION_SUFFIX</span>  <span class=\"c1\"># date partition suffix</span>\n        <span class=\"o\">+</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;$&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">config_value</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">_Dataset</span><span class=\"p\">(</span><span class=\"n\">ConfigScalar</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">_Dataset</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span>\n            <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">,</span>\n            <span class=\"n\">given_name</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">,</span>\n            <span class=\"n\">scalar_kind</span><span class=\"o\">=</span><span class=\"n\">ConfigScalarKind</span><span class=\"o\">.</span><span class=\"n\">STRING</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">post_process</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">_is_valid_dataset</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">PostProcessingError</span><span class=\"p\">(</span><span class=\"s1\">&#39;Datasets must be of the form &quot;project.dataset&quot; or &quot;dataset&quot;&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">value</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">_Table</span><span class=\"p\">(</span><span class=\"n\">ConfigScalar</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">_Table</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span>\n            <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">,</span>\n            <span class=\"n\">given_name</span><span class=\"o\">=</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">,</span>\n            <span class=\"n\">scalar_kind</span><span class=\"o\">=</span><span class=\"n\">ConfigScalarKind</span><span class=\"o\">.</span><span class=\"n\">STRING</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">post_process</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">_is_valid_table</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">PostProcessingError</span><span class=\"p\">(</span>\n                <span class=\"p\">(</span>\n                    <span class=\"s1\">&#39;Tables must be of the form &quot;project.dataset.table&quot; or &quot;dataset.table&quot; &#39;</span>\n                    <span class=\"s2\">&quot;with optional date-partition suffix&quot;</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">value</span>\n\n\n<span class=\"c1\"># https://github.com/dagster-io/dagster/issues/1971</span>\n<span class=\"n\">Table</span> <span class=\"o\">=</span> <span class=\"n\">_Table</span><span class=\"p\">()</span>\n<span class=\"n\">Dataset</span> <span class=\"o\">=</span> <span class=\"n\">_Dataset</span><span class=\"p\">()</span>\n\n\n<div class=\"viewcode-block\" id=\"BigQueryError\"><a class=\"viewcode-back\" href=\"../../../../sections/api/apidocs/libraries/dagster_gcp/#dagster_gcp.BigQueryError\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">BigQueryError</span><span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span></div>\n</pre></div>", "current_page_name": "_modules/dagster_gcp/bigquery/types", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}