{"parents": [{"link": "../../", "title": "Module code"}], "title": "dagster_pagerduty.resources", "body": "<h1>Source code for dagster_pagerduty.resources</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">pypd</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">Field</span><span class=\"p\">,</span> <span class=\"n\">resource</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PagerDutyService</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Integrates with PagerDuty via the pypd library.</span>\n\n<span class=\"sd\">    See:</span>\n<span class=\"sd\">        https://v2.developer.pagerduty.com/docs/events-api-v2</span>\n<span class=\"sd\">        https://v2.developer.pagerduty.com/docs/send-an-event-events-api-v2</span>\n<span class=\"sd\">        https://support.pagerduty.com/docs/services-and-integrations#section-events-api-v2</span>\n<span class=\"sd\">        https://github.com/PagerDuty/pagerduty-api-python-client</span>\n\n<span class=\"sd\">    for documentation and more information.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">routing_key</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">routing_key</span> <span class=\"o\">=</span> <span class=\"n\">routing_key</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">EventV2_create</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">summary</span><span class=\"p\">,</span>\n        <span class=\"n\">source</span><span class=\"p\">,</span>\n        <span class=\"n\">severity</span><span class=\"p\">,</span>\n        <span class=\"n\">event_action</span><span class=\"o\">=</span><span class=\"s2\">&quot;trigger&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">dedup_key</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">timestamp</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">component</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">group</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">event_class</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">custom_details</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Events API v2 enables you to add PagerDuty&#39;s advanced event and incident management</span>\n<span class=\"sd\">        functionality to any system that can make an outbound HTTP connection.</span>\n\n<span class=\"sd\">        Arguments:</span>\n<span class=\"sd\">            summary {string} -- A high-level, text summary message of the event. Will be used to</span>\n<span class=\"sd\">                                construct an alert&#39;s description.</span>\n\n<span class=\"sd\">                                Example: &quot;PING OK - Packet loss = 0%, RTA = 1.41 ms&quot; &quot;Host</span>\n<span class=\"sd\">                                         &#39;acme-andromeda-sv1-c40 :: 179.21.24.50&#39; is DOWN&quot;</span>\n\n<span class=\"sd\">            source {string} -- Specific human-readable unique identifier, such as a hostname, for</span>\n<span class=\"sd\">                               the system having the problem.</span>\n\n<span class=\"sd\">                               Examples:</span>\n<span class=\"sd\">                               &quot;prod05.theseus.acme-widgets.com&quot;</span>\n<span class=\"sd\">                               &quot;171.26.23.22&quot;</span>\n<span class=\"sd\">                               &quot;aws:elasticache:us-east-1:852511987:cluster/api-stats-prod-003&quot;</span>\n<span class=\"sd\">                               &quot;9c09acd49a25&quot;</span>\n\n<span class=\"sd\">            severity {string} -- How impacted the affected system is. Displayed to users in lists</span>\n<span class=\"sd\">                                 and influences the priority of any created incidents. Must be one</span>\n<span class=\"sd\">                                 of {info, warning, error, critical}</span>\n\n<span class=\"sd\">        Keyword Arguments:</span>\n<span class=\"sd\">            event_action {str} -- There are three types of events that PagerDuty recognizes, and</span>\n<span class=\"sd\">                                  are used to represent different types of activity in your</span>\n<span class=\"sd\">                                  monitored systems. (default: &#39;trigger&#39;)</span>\n<span class=\"sd\">                * trigger: When PagerDuty receives a trigger event, it will either open a new alert,</span>\n<span class=\"sd\">                           or add a new trigger log entry to an existing alert, depending on the</span>\n<span class=\"sd\">                           provided dedup_key. Your monitoring tools should send PagerDuty a trigger</span>\n<span class=\"sd\">                           when a new problem has been detected. You may send additional triggers</span>\n<span class=\"sd\">                           when a previously detected problem has occurred again.</span>\n\n<span class=\"sd\">                * acknowledge: acknowledge events cause the referenced incident to enter the</span>\n<span class=\"sd\">                               acknowledged state. While an incident is acknowledged, it won&#39;t</span>\n<span class=\"sd\">                               generate any additional notifications, even if it receives new</span>\n<span class=\"sd\">                               trigger events. Your monitoring tools should send PagerDuty an</span>\n<span class=\"sd\">                               acknowledge event when they know someone is presently working on the</span>\n<span class=\"sd\">                               problem.</span>\n\n<span class=\"sd\">                * resolve: resolve events cause the referenced incident to enter the resolved state.</span>\n<span class=\"sd\">                           Once an incident is resolved, it won&#39;t generate any additional</span>\n<span class=\"sd\">                           notifications. New trigger events with the same dedup_key as a resolved</span>\n<span class=\"sd\">                           incident won&#39;t re-open the incident. Instead, a new incident will be</span>\n<span class=\"sd\">                           created. Your monitoring tools should send PagerDuty a resolve event when</span>\n<span class=\"sd\">                           the problem that caused the initial trigger event has been fixed.</span>\n\n<span class=\"sd\">            dedup_key {string} -- Deduplication key for correlating triggers and resolves. The</span>\n<span class=\"sd\">                                  maximum permitted length of this property is 255 characters.</span>\n\n<span class=\"sd\">            timestamp {string} -- Timestamp (ISO 8601). When the upstream system detected / created</span>\n<span class=\"sd\">                                  the event. This is useful if a system batches or holds events</span>\n<span class=\"sd\">                                  before sending them to PagerDuty.</span>\n\n<span class=\"sd\">                                  Optional - Will be auto-generated by PagerDuty if not provided.</span>\n\n<span class=\"sd\">                                  Example:</span>\n<span class=\"sd\">                                  2015-07-17T08:42:58.315+0000</span>\n\n<span class=\"sd\">            component {string} -- The part or component of the affected system that is broken.</span>\n\n<span class=\"sd\">                                  Examples:</span>\n<span class=\"sd\">                                  &quot;keepalive&quot;</span>\n<span class=\"sd\">                                  &quot;webping&quot;</span>\n<span class=\"sd\">                                  &quot;mysql&quot;</span>\n<span class=\"sd\">                                  &quot;wqueue&quot;</span>\n\n<span class=\"sd\">            group {string} -- A cluster or grouping of sources. For example, sources</span>\n<span class=\"sd\">                              &quot;prod-datapipe-02&quot; and &quot;prod-datapipe-03&quot; might both be part of</span>\n<span class=\"sd\">                              &quot;prod-datapipe&quot;</span>\n\n<span class=\"sd\">                              Examples:</span>\n<span class=\"sd\">                              &quot;prod-datapipe&quot;</span>\n<span class=\"sd\">                              &quot;www&quot;</span>\n<span class=\"sd\">                              &quot;web_stack&quot;</span>\n\n<span class=\"sd\">            event_class {string} -- The class/type of the event.</span>\n\n<span class=\"sd\">                                    Examples:</span>\n<span class=\"sd\">                                    &quot;High CPU&quot;</span>\n<span class=\"sd\">                                    &quot;Latency&quot;</span>\n<span class=\"sd\">                                    &quot;500 Error&quot;</span>\n\n<span class=\"sd\">            custom_details {Dict[str, str]} -- Additional details about the event and affected</span>\n<span class=\"sd\">                                               system.</span>\n\n<span class=\"sd\">                                               Example:</span>\n<span class=\"sd\">                                               {&quot;ping time&quot;: &quot;1500ms&quot;, &quot;load avg&quot;: 0.75 }</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;routing_key&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">routing_key</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;event_action&quot;</span><span class=\"p\">:</span> <span class=\"n\">event_action</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;payload&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;summary&quot;</span><span class=\"p\">:</span> <span class=\"n\">summary</span><span class=\"p\">,</span> <span class=\"s2\">&quot;source&quot;</span><span class=\"p\">:</span> <span class=\"n\">source</span><span class=\"p\">,</span> <span class=\"s2\">&quot;severity&quot;</span><span class=\"p\">:</span> <span class=\"n\">severity</span><span class=\"p\">},</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">dedup_key</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">&quot;dedup_key&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">dedup_key</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">timestamp</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">&quot;payload&quot;</span><span class=\"p\">][</span><span class=\"s2\">&quot;timestamp&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">timestamp</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">component</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">&quot;payload&quot;</span><span class=\"p\">][</span><span class=\"s2\">&quot;component&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">component</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">group</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">&quot;payload&quot;</span><span class=\"p\">][</span><span class=\"s2\">&quot;group&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">group</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">event_class</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">&quot;payload&quot;</span><span class=\"p\">][</span><span class=\"s2\">&quot;class&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">event_class</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">custom_details</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"p\">[</span><span class=\"s2\">&quot;payload&quot;</span><span class=\"p\">][</span><span class=\"s2\">&quot;custom_details&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">custom_details</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">pypd</span><span class=\"o\">.</span><span class=\"n\">EventV2</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">data</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"pagerduty_resource\"><a class=\"viewcode-back\" href=\"../../../sections/api/apidocs/libraries/dagster_pagerduty/#dagster_pagerduty.pagerduty_resource\">[docs]</a><span class=\"nd\">@resource</span><span class=\"p\">(</span>\n    <span class=\"p\">{</span>\n        <span class=\"s2\">&quot;routing_key&quot;</span><span class=\"p\">:</span> <span class=\"n\">Field</span><span class=\"p\">(</span>\n            <span class=\"nb\">str</span><span class=\"p\">,</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;&quot;The routing key provisions access to your PagerDuty service. You</span>\n<span class=\"s2\">                    will need to include the integration key for your new integration, as a</span>\n<span class=\"s2\">                    routing_key in the event payload.&quot;&quot;&quot;</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">},</span>\n    <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;&quot;This resource is for posting events to PagerDuty.&quot;&quot;&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"k\">def</span> <span class=\"nf\">pagerduty_resource</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;A resource for posting events (alerts) to PagerDuty.</span>\n\n<span class=\"sd\">    Example:</span>\n\n<span class=\"sd\">    .. code-block:: python</span>\n\n<span class=\"sd\">        @solid(required_resource_keys={&#39;pagerduty&#39;})</span>\n<span class=\"sd\">        def pagerduty_solid(context):</span>\n<span class=\"sd\">            context.resources.pagerduty.EventV2_create(</span>\n<span class=\"sd\">                summary=&#39;alert from dagster&#39;</span>\n<span class=\"sd\">                source=&#39;localhost&#39;,</span>\n<span class=\"sd\">                severity=&#39;error&#39;,</span>\n<span class=\"sd\">                event_action=&#39;trigger&#39;,</span>\n<span class=\"sd\">            )</span>\n\n<span class=\"sd\">        @pipeline(</span>\n<span class=\"sd\">            mode_defs=[ModeDefinition(resource_defs={&#39;pagerduty&#39;: pagerduty_resource})],</span>\n<span class=\"sd\">        )</span>\n<span class=\"sd\">        def pd_pipeline():</span>\n<span class=\"sd\">            pagerduty_solid()</span>\n\n<span class=\"sd\">        execute_pipeline(</span>\n<span class=\"sd\">            pd_pipeline,</span>\n<span class=\"sd\">            {</span>\n<span class=\"sd\">                &#39;resources&#39;: {</span>\n<span class=\"sd\">                    &#39;pagerduty&#39;: {&#39;config&#39;: {&#39;routing_key&#39;: &#39;0123456789abcdef0123456789abcdef&#39;}}</span>\n<span class=\"sd\">                }</span>\n<span class=\"sd\">            },</span>\n<span class=\"sd\">        )</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">return</span> <span class=\"n\">PagerDutyService</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">resource_config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;routing_key&quot;</span><span class=\"p\">))</span></div>\n</pre></div>", "current_page_name": "_modules/dagster_pagerduty/resources", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}