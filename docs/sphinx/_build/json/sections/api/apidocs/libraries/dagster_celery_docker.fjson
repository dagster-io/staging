{"parents": [], "prev": {"link": "../dagster_celery/", "title": "Celery (dagster_celery)"}, "next": {"link": "../dagster_celery_k8s/", "title": "Orchestration on Celery + Kubernetes"}, "title": "Orchestration on Celery + Docker", "meta": null, "body": "<div class=\"section\" id=\"orchestration-on-celery-docker\">\n<h1>Orchestration on Celery + Docker<a class=\"headerlink\" href=\"#orchestration-on-celery-docker\" title=\"Permalink to this headline\">\u00b6</a></h1>\n</div>\n<div class=\"section\" id=\"apis\">\n<h1>APIs<a class=\"headerlink\" href=\"#apis\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<dl class=\"data\">\n<dt id=\"dagster_celery_docker.celery_docker_executor\">\n<code class=\"sig-prename descclassname\">dagster_celery_docker.</code><code class=\"sig-name descname\">celery_docker_executor</code><em class=\"property\"> ExecutorDefinition</em><a class=\"reference internal\" href=\"../../../../../_modules/dagster_celery_docker/executor/#celery_docker_executor\"><span class=\"viewcode-link\">[source]</span></a><a class=\"headerlink\" href=\"#dagster_celery_docker.celery_docker_executor\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Celery-based executor which launches tasks in docker containers.</p>\n<p>The Celery executor exposes config settings for the underlying Celery app under\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">config_source</span></code> key. This config corresponds to the \u201cnew lowercase settings\u201d introduced\nin Celery version 4.0 and the object constructed from config will be passed to the\n<a class=\"reference external\" href=\"http://docs.celeryproject.org/en/latest/reference/celery.html#celery.Celery\" title=\"(in Celery v4.3)\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">celery.Celery</span></code></a> constructor as its <code class=\"docutils literal notranslate\"><span class=\"pre\">config_source</span></code> argument.\n(See <a class=\"reference external\" href=\"https://docs.celeryproject.org/en/latest/userguide/configuration.html\">https://docs.celeryproject.org/en/latest/userguide/configuration.html</a> for details.)</p>\n<p>The executor also exposes the <code class=\"docutils literal notranslate\"><span class=\"pre\">broker</span></code>, <cite>backend</cite>, and <code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code> arguments to the\n<a class=\"reference external\" href=\"http://docs.celeryproject.org/en/latest/reference/celery.html#celery.Celery\" title=\"(in Celery v4.3)\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">celery.Celery</span></code></a> constructor.</p>\n<p>In the most common case, you may want to modify the <code class=\"docutils literal notranslate\"><span class=\"pre\">broker</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">backend</span></code> (e.g., to use\nRedis instead of RabbitMQ). We expect that <code class=\"docutils literal notranslate\"><span class=\"pre\">config_source</span></code> will be less frequently\nmodified, but that when solid executions are especially fast or slow, or when there are\ndifferent requirements around idempotence or retry, it may make sense to execute pipelines\nwith variations on these settings.</p>\n<p>If you\u2019d like to configure a Celery Docker executor in addition to the\n<a class=\"reference internal\" href=\"../../execution/#dagster.default_executors\" title=\"dagster.default_executors\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">default_executors</span></code></a>, you should add it to the <code class=\"docutils literal notranslate\"><span class=\"pre\">executor_defs</span></code> defined on a\n<a class=\"reference internal\" href=\"../../modes-resources/#dagster.ModeDefinition\" title=\"dagster.ModeDefinition\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ModeDefinition</span></code></a> as follows:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">dagster</span> <span class=\"kn\">import</span> <span class=\"n\">ModeDefinition</span><span class=\"p\">,</span> <span class=\"n\">default_executors</span><span class=\"p\">,</span> <span class=\"n\">pipeline</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dagster_celery_docker.executor</span> <span class=\"kn\">import</span> <span class=\"n\">celery_docker_executor</span>\n\n<span class=\"nd\">@pipeline</span><span class=\"p\">(</span><span class=\"n\">mode_defs</span><span class=\"o\">=</span><span class=\"p\">[</span>\n    <span class=\"n\">ModeDefinition</span><span class=\"p\">(</span><span class=\"n\">executor_defs</span><span class=\"o\">=</span><span class=\"n\">default_executors</span> <span class=\"o\">+</span> <span class=\"p\">[</span><span class=\"n\">celery_docker_executor</span><span class=\"p\">])</span>\n<span class=\"p\">])</span>\n<span class=\"k\">def</span> <span class=\"nf\">celery_enabled_pipeline</span><span class=\"p\">():</span>\n    <span class=\"k\">pass</span>\n</pre></div>\n</div>\n<p>Then you can configure the executor as follows:</p>\n<div class=\"highlight-YAML notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nt\">execution</span><span class=\"p\">:</span>\n  <span class=\"nt\">celery-docker</span><span class=\"p\">:</span>\n    <span class=\"nt\">config</span><span class=\"p\">:</span>\n\n      <span class=\"nt\">docker</span><span class=\"p\">:</span>\n        <span class=\"nt\">image</span><span class=\"p\">:</span> <span class=\"s\">&#39;my_repo.com/image_name:latest&#39;</span>\n        <span class=\"nt\">registry</span><span class=\"p\">:</span>\n          <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"s\">&#39;my_repo.com&#39;</span>\n          <span class=\"nt\">username</span><span class=\"p\">:</span> <span class=\"s\">&#39;my_user&#39;</span>\n          <span class=\"nt\">password</span><span class=\"p\">:</span> <span class=\"p p-Indicator\">{</span><span class=\"nt\">env</span><span class=\"p\">:</span> <span class=\"s\">&#39;DOCKER_PASSWORD&#39;</span><span class=\"p p-Indicator\">}</span>\n        <span class=\"nt\">env_vars</span><span class=\"p\">:</span> <span class=\"p p-Indicator\">[</span><span class=\"s\">&quot;DAGSTER_HOME&quot;</span><span class=\"p p-Indicator\">]</span> <span class=\"c1\"># environment vars to pass from celery worker to docker</span>\n\n      <span class=\"nt\">broker</span><span class=\"p\">:</span> <span class=\"s\">&#39;pyamqp://guest@localhost//&#39;</span>  <span class=\"c1\"># Optional[str]: The URL of the Celery broker</span>\n      <span class=\"nt\">backend</span><span class=\"p\">:</span> <span class=\"s\">&#39;rpc://&#39;</span> <span class=\"c1\"># Optional[str]: The URL of the Celery results backend</span>\n      <span class=\"nt\">include</span><span class=\"p\">:</span> <span class=\"p p-Indicator\">[</span><span class=\"s\">&#39;my_module&#39;</span><span class=\"p p-Indicator\">]</span> <span class=\"c1\"># Optional[List[str]]: Modules every worker should import</span>\n      <span class=\"nt\">config_source</span><span class=\"p\">:</span> <span class=\"c1\"># Dict[str, Any]: Any additional parameters to pass to the</span>\n          <span class=\"c1\">#...       # Celery workers. This dict will be passed as the `config_source`</span>\n          <span class=\"c1\">#...       # argument of celery.Celery().</span>\n</pre></div>\n</div>\n<p>Note that the YAML you provide here must align with the configuration with which the Celery\nworkers on which you hope to run were started. If, for example, you point the executor at a\ndifferent broker than the one your workers are listening to, the workers will never be able to\npick up tasks for execution.</p>\n<p>In deployments where the celery_k8s_job_executor is used all appropriate celery and dagster_celery\ncommands must be invoked with the <cite>-A dagster_celery_docker.app</cite> argument.</p>\n</dd></dl>\n\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["sections/api/apidocs/libraries/dagster_celery_k8s", "Orchestration on Celery + Kubernetes", "N", "next"], ["sections/api/apidocs/libraries/dagster_celery", "Celery (dagster_celery)", "P", "previous"]], "sourcename": "sections/api/apidocs/libraries/dagster_celery_docker.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Orchestration on Celery + Docker</a></li>\n<li><a class=\"reference internal\" href=\"#apis\">APIs</a></li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "sections/api/apidocs/libraries/dagster_celery_docker", "sidebars": ["globaltoc.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}